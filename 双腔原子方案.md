Q:中性原子量子计算体系中用DLCZ协议的原子系综作为远距离量子接口更好还是单原子QED腔作为量子接口更好
A:在远距离量子网络或量子接口的构建中，究竟选用基于 DLCZ（Duan–Lukin–Cirac–Zoller）协议的原子系综方案，还是基于单原子强耦合腔 QED 的方案，很大程度上取决于实验实现的难度、所需的可靠性和可扩展性需求。二者在物理实现和技术要求上各有优劣，简单概括如下：

------

## 1. DLCZ 原子系综方案

### 优点

1. **集体增强效应（Collective Enhancement）**
    在原子系综中，通过集体激发态（spin wave）实现对单光子的存储和读出，实验上在一定条件下可以获得相对较高的记忆保真度和可读出效率。
2. **实验实现的门槛较低**
    相较于实现强耦合单原子腔 QED 所需的高品质腔，DLCZ 原子系综往往只需要利用冷原子或热蒸汽室，并结合一定的激光脉冲序列来产生和探测光学场。腔品质和尺寸要求相对宽松，在早期的量子网络实验中应用广泛。
3. **比较容易进行多节点扩展**
    原子系综实验中可以使用多个原子云或蒸汽室，通过 DLCZ 协议的反复尝试（基于探测到“Stokes 光子”/“反Stokes 光子”来 herald 成功事件）来建立多节点纠缠，从而组建初步的量子网络。

### 缺点

1. **成功概率通常是概率性的、速率较低**
    DLCZ 协议依赖于测量到稀有事件（如单个 Stokes 光子的散射），成功建立一个远程纠缠链接往往需要多次重复尝试，速率会被大大限制。
2. **对相干性和存储时间有一定要求**
    尽管原子系综可以提供不错的量子存储时间，但在更长的时间尺度上，去相干效应（自旋相干性的损耗、磁场或温度扰动等）会显著降低保真度。若需要跨长距离、多节点的链路，存储时间成为瓶颈。
3. **单光子输出的确定性不足**
    虽然 DLCZ 协议实现了“可制备并 herald”单光子或纠缠，但并非完全确定性地发射或读取，有时难以对系统进行连续可控的单光子输出。

------

## 2. 单原子腔 QED 方案

### 优点

1. **高度确定性的光子发射与读出**
    当单原子与高品质光学腔达到强耦合（strong coupling）或在高占据因子（high cooperativity）条件下，系统可以实现接近确定性（或高概率）的单光子发射与吸收。这在量子信息处理中能提供更快的操作速率和更高的保真度。
2. **高保真量子接口**
    单原子与单光子之间的耦合可通过腔场增强而实现高效率的状态转换或纠缠，在理论上可以达到非常高的保真和相对较低的噪声。
3. **潜在的可扩展性**
    虽然单原子腔 QED 系统的扩展在实验上尚有较大挑战，但一旦能稳定地制备多个高品质因子（Q 值高、模式体积小）的微腔，且能将单个或少量原子可靠地捕获在腔模中，则可通过光纤或波导彼此耦合，从而在原理上形成网络结构。

### 缺点

1. **实验实现难度较高**
    需要可与原子实现强耦合的高品质腔（往往是小模体积、高反射率分布布拉格反射镜、或者微纳结构谐振器），对准稳定性和振动隔离、对空腔模式的耦合控制都非常苛刻。
2. **对原子的操控要求严格**
    需要将单个原子或极少数原子在腔内定位（例如光学阱或偶极阱），保持较长时间的俘获和量子相干性，这在实验上挑战颇大。
3. **扩展到多节点的工程难度**
    虽然腔 QED 在理论上可以扩展，但每一个节点都需要一套高品质腔和相对复杂的冷却、俘获、操控技术，系统复杂度和成本飙升。

------

## 3. 如何选择？

1. **对远距离量子分发和量子中继而言**
   - 若侧重于 *基于测量触发（heralded）* 的纠缠分发，且对速率要求不是极高，同时更看重实验可行性和相对简单的设备，DLCZ 的原子系综方案依旧是较为成熟的选择。
   - 若想实现确定性更高的单光子发射/吸收及更快的纠缠生成速率，并且有能力搭建高品质腔和稳定单原子俘获，则单原子腔 QED 方案有望带来更高保真和更快的操作速率。
2. **对未来大规模量子网络和量子计算体系集成**
   - DLCZ 方案在一定阶段可能更适合做“中继”和“存储”，特别是在布置大量原子系综、利用集体增强的同时，来实现多节点纠缠的初步分发。
   - 单原子腔 QED 则更接近“确定性光-物质界面”，对需要高通量或者高保真、可编程操作的体系具有更大吸引力。但在短期内，其实验门槛高，装置复杂，尚未像 DLCZ 原子系综那样成为常规化配置。
3. **技术成熟度与学术趋势**
   - 早期许多远距离量子通信实验都是基于 DLCZ 原子系综。而随着微纳光学、固态器件和腔 QED 技术的发展，越来越多的实验室也在探索高效率的单原子腔或人工原子（如量子点、固态自旋等）的强耦合系统。
   - 短期来看，DLCZ 仍可能是相对容易上手的解决方案；长期来看，若要在集成度、确定性和可扩展性上更进一步，单原子或固态自旋强耦合腔 QED 可能是重要方向。

------

### 总结

- **DLCZ 原子系综**：
   优势在于实验实现相对简单、可做概率式（heralded）纠缠分发和量子存储，容易在多节点量子网络中进行初步验证和演示。其主要限制是速率低以及需要多次尝试才能成功。
- **单原子腔 QED**：
   优势在于实现高保真、高确定性（准确定性）光-物质界面，潜在速率更快，但对实验条件（强耦合腔、单原子捕获及保持稳定性）要求很高，短期内扩展到多个节点也更具挑战。

因此，选择何种方案要结合**技术成熟度**与**系统需求**：若需要在相对近的时间尺度内实现远程纠缠分发、对成功率要求不及对可行性要求高，DLCZ 更具吸引力；若研究团队具备搭建高品质腔及其相关控制的强大能力，且需要更高保真、更高速率甚至是确定性操作，则单原子腔 QED 更具潜力。二者并非相互排斥，也存在结合的可能：利用原子系综做长距离中继，再与局域的高保真单原子腔节点对接，形成“混合”型量子网络，这也是很多研究正在探索的方向。


Q:如果真拿DLCZ系统制作的EPR对进行量子隐形传态，那么定量的计算一下（逐步列写并推导latex表达式）激发周期在分束器上对齐（符合计数率接近0）和不对齐（符合计数率为0.5 * p² * η²）得到的隐形传态保真度结果分别是什么样子的

A:下面给出一个基于标准 DLCZ‐型“单光子干涉”产生远程EPR对的简单定量模型，来比较：

1. **两端激发脉冲在分束器上严格对齐（可实现理想的Hong–Ou–Mandel干涉）**时，两光子符合计数率接近 0；
2. **两端激发脉冲在时间上不对齐（两光子相对可分辨）**时，两光子符合计数率约为 $0.5\,p^{2}\,\eta^{2}$。

并进一步计算在这两种极端情形下，**由此EPR对所实现的量子隐形传态保真度**（fidelity）会有怎样的差异。这里的结论是（在不分辨光子数的“桶式探测器”前提下）**不对齐**时虽然损失了部分干涉“压制双光子”的好处，但反而因为“双光子事件”有一半会被检测为“双点击”而被舍弃，从而**提高了所得到的EPR对的纯度和最终的隐形传态保真度**。以下分步骤推导这一结果。

------

## 1. 模型与符号约定

- 每个原子系综节点（记为 A 和 B）在一次激发脉冲中产生（Stokes）单光子激发的概率为 $p$。为保证单光子或单自旋激发近似成立，通常要求 $p \ll 1$。
- 两个节点独立激发，之后将各自产生的光子在一个 50:50 分束器(BS)上相干/不相干地合束，并用两个单光子探测器 $\mathrm{D_1}$ 和 $\mathrm{D_2}$ 记录探测事件。
- 探测效率记为 $\eta$（简化假设两路光纤、探测器的整体效率相同）。探测器本身不能分辨来的是一个光子还是两个光子，只输出“有点击 / 无点击”的结果（“桶式探测器”）。
- 我们只在**恰有一个探测器点击**时，宣称成功制备到远程的“单自旋激发纠缠（EPR对）”，并将其用作后续隐形传态的量子信道。若两个探测器都点击（即“双击”），则判为“坏事件”直接丢弃；若无探测器点击则亦丢弃。

为方便，先忽略“未产生光子”的情形对最后*归一化*后状态保真的影响（因为只在“有点击”时才宣称成功，故真空分量被后选(post-selection)排除）。主要关注的是：**成功 herald 后的有效纠缠状态里，是否混入了多自旋激发（双光子）成分**，这正是决定保真的关键。

------

## 2. 单光子与双光子事件概率

令

$P_{0} = (1-p)^{2} \quad (\text{A、B端都无光子}),  \quad  P_{1} = 2\,p\,(1-p) \quad (\text{恰有一端产生光子}),  \quad  P_{2} = p^{2} \quad (\text{A、B端均产生光子}).$

对一次激发脉冲而言（不考虑探测器效率），可能出现的事件及其概率是：

1. **无光子**：概率 $P_{0}=(1-p)^2$；
2. **单光子**（来自A或B但不是同时）：概率 $P_{1}=2p(1-p)$；
3. **双光子**（A端与B端各出一光子）：概率 $P_{2}=p^2$.

下面分别考虑“分束器上两光子**对齐**”与“**不对齐**”这两种极端情形下，这些光子通过分束器并被探测后，“单击（single click）”与“双击（coincidence）”的条件概率。

------

### 2.1 两端激发脉冲在分束器上**对齐**：理想Hong–Ou–Mandel干涉

- **单光子事件** $(P_{1})$：
   A 或 B 只产生一个光子，进入 50:50 BS 后无论是弹出到 $\mathrm{D_1}$ 还是 $\mathrm{D_2}$，只要探测器效率为 $\eta$，就有概率 $\eta$ 得到一次点击。
   因为分束器是 50:50，且探测器是“桶式”并不区分端口出射多少光子，综合来看（略去路径因子等常数），**发生单击**的总概率（只考虑事件 $P_1$ 的贡献）可以写作

  Pclick(1)  =  P1 η  =  2p(1−p) η.P_{\mathrm{click}}^{(1)} \;=\; P_{1}\,\eta \;=\; 2p(1-p)\,\eta.

- **双光子事件** $(P_{2})$：
   若 A、B 同时各产生一个光子，并在 BS 上相干且完全**不可分辨**（对齐），会出现理想的 Hong–Ou–Mandel “双光子混同”效应：

  - 两光子**绝不会**分别出现在两输出端口（从而被两个探测器同时点到）的**振幅**发生**对称性**与**相消**（$\phi=\pi$ 的量子干涉），故理想情况下**双击概率 = 0**；

  - 两光子会**束缚在一起（bunching）**，一起从同一个输出端口离开。若探测器效率为 $\eta$，则该端口处**至少有一个点击**的概率为

    η2  =  1−(1−η)2  =  2η−η2.\eta_{2} \;=\; 1 - (1-\eta)^{2} \;=\; 2\eta - \eta^{2}.

  故当出现双光子 $(P_{2})$ 时，我们依然可能只收到“单击”——探测器看不出到底是一光子还是两光子进来（因为它不会输出“两次脉冲”）。在理想情形($\eta=1$)下，一旦双光子都进入同一探测器，就一定会输出“单击”信号；有损时则概率是 $\eta_{2}=2\eta-\eta^{2}$。因此

  Pclick(2,matched)  =  P2  η2  =  p2  [ 2η−η2].P_{\mathrm{click}}^{(2,\text{matched})}  \;=\;  P_{2}\;\eta_{2} \;=\; p^{2}\;\bigl[\,2\eta-\eta^{2}\bigr].

- **总的“单击”成功率**（忽略真空事件）：

  Psingle click(matched)  =  Pclick(1)  +  Pclick(2,matched)  =  2 p (1−p) η  +  p2 [ 2η−η2 ].P_{\mathrm{single\,click}}^{(\text{matched})} \;=\; P_{\mathrm{click}}^{(1)} \;+\; P_{\mathrm{click}}^{(2,\text{matched})} \;=\; 2\,p\,(1-p)\,\eta \;+\; p^{2}\,[\,2\eta-\eta^{2}\,].

- **双击概率**：理想 HOM 干涉下（完全对齐且光子全同），双光子“出不同端口”被同时探测的概率在理想情况下为 0，即

  Pdouble click(matched)  =  0(理想).P_{\mathrm{double\,click}}^{(\text{matched})} \;=\; 0\quad(\text{理想}).

------

### 2.2 两端激发脉冲在分束器上**不对齐**：光子彼此可区分

- **单光子事件** $(P_{1})$**：
   仍与上面相同，只要来的是单光子，单击概率约为 $\eta$。因此

  Pclick(1)  =  2 p (1−p) η.P_{\mathrm{click}}^{(1)} \;=\; 2\,p\,(1-p)\,\eta.

- **双光子事件** $(P_{2})$**：
   现在两路光子在到达 BS 的时间/频率等不匹配，彼此可分辨，没有香港–于–曼德尔(HOM)干涉的相消效应。对两个相互独立的单光子进入 50:50 BS 而言：

  - 有一半概率（50%）它们从**不同输出端口**离开，从而被两个探测器同时检测到，于是出现“双击”；
  - 另外 50% 概率它们一起从**同一个端口**离开。若探测器效率为 $\eta$，则与前面相同：端口处至少一次点击的概率是 $2\eta-\eta^{2}$。探测器依旧只会输出“单击”。

  因此当出现双光子事件时：

  Pdouble click(unmatched)  =  P2 (12) η2  =  12 p2 η2,Psingle click(unmatched,2photon)  =  P2 (12) [ 2η−η2]  =  12 p2 [ 2η−η2].\begin{aligned} &P_{\mathrm{double\,click}}^{(\text{unmatched})}  \;=\; P_{2}\,\bigl(\tfrac12\bigr)\,\eta^{2} \;=\; \tfrac12\,p^{2}\,\eta^{2},  \\ &P_{\mathrm{single\,click}}^{(\text{unmatched,2photon})} \;=\; P_{2}\,\bigl(\tfrac12\bigr)\,\bigl[\,2\eta-\eta^{2}\bigr] \;=\; \tfrac12\,p^{2}\,\bigl[\,2\eta-\eta^{2}\bigr]. \end{aligned}

- **总的“单击”成功率**：

  Psingle click(unmatched)  =  2 p (1−p) η  +  12 p2 [ 2η−η2].P_{\mathrm{single\,click}}^{(\text{unmatched})} \;=\; 2\,p\,(1-p)\,\eta  \;+\; \tfrac12\,p^{2}\,\bigl[\,2\eta-\eta^{2}\bigr].

- **双击概率**：

  Pdouble click(unmatched)  =  12 p2 η2.P_{\mathrm{double\,click}}^{(\text{unmatched})}  \;=\; \tfrac12\,p^{2}\,\eta^{2}.

  因此在不对齐情形下，实验上常能直接测出一个**非零**的双击（符合计数）率约为 $0.5\,p^{2}\,\eta^{2}$。这也正是区分“对齐”与“完全不对齐”最直接的观测信号。

------

## 3. 两种情形下的“假单光子”污染与保真度估算

我们只在“**单击**”时认为“成功制备到了EPR对”，并将此远程纠缠用于后续（例如量子隐形传态）操作。理想情况下，只有“确实是单自旋激发（单光子）”才会带来正确的 Bell 状态；若其实是“两端各激发一个自旋，双光子却只点出了一个探测事件”，则会污染到纠缠态——实际是多激发的混合态，从而降低了传态保真度。

下面用最简单的“二分近似”来估算：

- 当探测 herald “单击”时，若它确系由**单光子**( $P_{1}$ ) 贡献，则我们视对应的远程态为一个**完美的单激发纠缠**，隐形传态保真度可视为 1；
- 若它其实是由**双光子**( $P_{2}$ ) 产生但探测没区分出来，则我们视它对纠缠“完全破坏”或大幅拉低保真度（可取近似 0）。

> 更精细的分析可引入多激发成分在远程量子存储中的解纠缠效应，可能得到一个小于1但不为0的值；不过在这类简化估算中，通常将其视为最坏情形记为0。

令

$F = \bigl(\text{成功单激发所占比例}\bigr) \,\times\,1  \;+\; \bigl(\text{双激发所占比例}\bigr)\,\times\,0 \;=\; \text{成功单激发所占比例}.$

也就是**在所有 herald “单击”事件中，有多少比例确实是单光子贡献**。记为

$F  \;=\; \frac{\text{单激发触发单击的概率}}{\text{(单激发触发单击)+(双激发触发单击)}}.$

### 3.1 对齐（HOM 干涉）情形

从上式可得，保真度可近似写作

$F_{\text{matched}} = \frac{ P_{1}\,\eta }{ P_{1}\,\eta\;+\;P_{2}\,[\,2\eta - \eta^{2}\,] } = \frac{ 2\,p\,(1-p)\,\eta }{ 2\,p\,(1-p)\,\eta  \;+\; p^{2}\,[\,2\eta - \eta^{2}\,] }.$

若进一步假设 $\eta\approx 1$ 且 $p\ll 1$（即 $(1-p)\approx 1$），则可将式子简化为（忽略高阶小量）：

$\begin{aligned} P_{1}\,\eta &\approx 2p,\\ P_{2}\,\eta_{2} &\approx p^{2}. \end{aligned} \quad\Longrightarrow\quad F_{\text{matched}} \simeq \frac{2p}{2p + p^{2}} = \frac{2}{2 + p}.$

对小 $p$ 展开即

$F_{\text{matched}} \;\approx\; 1 \;-\;\tfrac{p}{2}  \quad (\text{当 } p\ll 1).$

可见，当激发概率 $p$ 足够小（$\approx 0.01\sim 0.1$ 量级），对齐情况下的保真度依然可以很高，但会因不可避免的双光子污染而逐渐下降。

------

### 3.2 不对齐（光子可分辨）情形

此时，在双光子事件中，只有一半($50\%$)的情形会“同端口”而导致单击，另一半会变成“双击”直接被丢弃；所以混入有效纠缠态的双激发成分相对更少，从而保真度更高。形式上：

$F_{\text{unmatched}} = \frac{ P_{1}\,\eta }{ P_{1}\,\eta \;+\; \bigl(\tfrac12 P_{2}\bigr)\,\bigl(2\eta-\eta^{2}\bigr) } = \frac{ 2\,p\,(1-p)\,\eta }{ 2\,p\,(1-p)\,\eta \;+\;\tfrac12\,p^{2}\,\bigl(2\eta-\eta^{2}\bigr) }.$

同样在 $\eta\approx 1$ 且 $p\ll 1$ 的极简近似下：

$P_{1}\,\eta \approx 2p, \quad \tfrac12\,P_{2}\,\eta_{2} \approx \tfrac12\,p^{2},$

则

$F_{\text{unmatched}} \simeq \frac{2p}{2p + \tfrac12\,p^{2}} = \frac{2}{2 + 0.5\,p} = \frac{4}{4 + p} \;\approx\; 1 - \tfrac{p}{4} \quad (\text{当 } p\ll 1).$

可以看出，不对齐时，二阶小概率 $p^{2}$ 事件有一半会被“双击”剔除掉，因而**单击后“假单光子”混入比例更小**，保真度比完全对齐时更好——在相同 $p$ 下，展开到一阶，$\,1 - p/4 > 1 - p/2$。

------

## 4. 隐形传态保真度的最终比较

如上所示：

- **对齐（HOM）情形**的双击率 $\approx 0$，但双光子束缚会无差别地给同一个探测器“单击”信号，从而污染远程 EPR 对，使得保真度

  Fmatched  ≃  22+p  ≈  1−p2(p≪1).F_{\text{matched}} \;\simeq\; \frac{2}{2+p} \;\approx\; 1 - \tfrac{p}{2} \quad(p\ll 1).

- **不对齐（无干涉）情形**会出现一个明显的“双击”符合计数率 $\tfrac12\,p^{2}\,\eta^{2}$，但这一“双击”事件被直接舍弃，从而减轻了双激发对最终EPR对的污染；对应保真度

  Funmatched  ≃  44+p  ≈  1−p4(p≪1).F_{\text{unmatched}} \;\simeq\; \frac{4}{4 + p} \;\approx\; 1 - \tfrac{p}{4} \quad(p\ll 1).

结论即是：

1. **在不分辨光子数的桶式探测前提下**，若只看“单击”事件所得到的纠缠对，不对齐反而能取得**更高的保真度**；
2. 代价是：不对齐时“双击”事件变多，被舍弃的次数更多，导致**实际成功率（效率）更低**。而在对齐时，“双光子”都跑到一个端口去触发单击，所以看起来“成功率”更高，但**牺牲了纠缠态的纯度**。

在量子隐形传态中，若我们只关心“在一次成功 herald 后，所得到纠缠信道的传态保真度”，则不对齐可达更高$F$；若同时也关心“尝试次数或资源消耗”，则还要综合考虑 p、$\eta$ 的最优调节和探测器本身是否具备**光子数分辨**能力（若能区分“双光子”就可兼得高保真和高成功率）。这也正是实验设计中常见的取舍。

------

## 5. 小结

> **问题回顾：** DLCZ方案在分束器上两光子完全对齐（符合计数率$\approx0$）与不对齐（符合计数率$\approx 0.5\,p^2\,\eta^2$）时，最终可用于隐形传态的EPR对保真度各是多少？

- **对齐（HOM干涉）**：

  Fmatched  ≈  22+p  ≈  1−p2.F_{\text{matched}} \;\approx\; \frac{2}{2+p} \;\approx\; 1 - \frac{p}{2}.

- **不对齐（相互区分）**：

  Funmatched  ≈  44+p  ≈  1−p4.F_{\text{unmatched}} \;\approx\; \frac{4}{4 + p} \;\approx\; 1 - \frac{p}{4}.

在同样的激发概率 $p\ll 1$ 下，不对齐情形的双光子有一半会产生“双击”被直接丢弃，从而减少了“假单光子”对纠缠的污染，使得保真度更高（但成功概率更低）。“对齐”则恰好相反：虽然双击几乎被完全干涉抑制，但双光子会**无可区分地**一起触发单击，降低了所制备EPR对的纯度，进而拉低隐形传态保真度。

这正体现了在无光子数分辨探测器条件下，“Hong–Ou–Mandel 干涉”既有好处（可提高点击触发率），也有坏处（多光子束缚会 ‘冒充’ 单光子触发），实验上往往要在激发概率 $p$、探测效率 $\eta$ 以及光子数分辨能力之间做权衡。

Q:所以只要两个腔连进分束器就可以了嘛？既然对其反而会降低保真度，那是不是完全可以不用对齐？为什么？
A：在阅读前面那组“对齐时保真度更低、不对齐时保真度更高”的公式后，很多人会产生类似疑惑：“**既然对齐还会降低保真度，那我干脆不对齐，不就能得到更高的保真度吗？**”——看起来似乎只要把两个（原子系综或腔 QED）节点的发光脉冲故意错开，让它们在分束器上不发生量子干涉，就能规避掉由多光子束缚（bunching）导致的假单光子污染。

然而，**这并不意味着在实际实验中“可以完全不用对齐”**。要理解原因，需要综合考虑以下几点关键因素：

------

## 1. “对齐”与“产生纠缠”的必要条件

- **DLCZ 协议（或者一般的单光子干涉型纠缠制备）\**的核心在于：当两个远程节点（A、B）\*\*各自\*\*以小概率 $p$ 同步激发，发出\**可能的**单光子，这两个光子在分束器（BS）上实现**不区分来源的量子干涉**，然后**通过特定探测结果来 herald（标记）远程自旋激发之间形成纠缠**。
- 若**完全不对齐**（时间上或频谱上），两个光子彼此“看得出”是来自 A 还是 B，干涉振幅会彻底丧失。**失去干涉，就无法在探测器点击时“投影”到 $\lvert \psi^\pm\rangle$ 这样的 Bell 成分**。换言之：
  - **真正的远程纠缠制备，需要光子彼此“不可分辨”**才能在探测器端产生正确的干涉事件；
  - 如果只是把两个光子简单地在一个 BS 上随意混合，而它们从时域/频率/空间模式上都能区分，那么就**没有**（或极度削弱）“谁的光子导致了探测点击”的相干叠加，也就**无法**由“单次点击事件”来**后选出一个高保真的纠缠状态**。

从这个角度看，**要想真正遵循 DLCZ 协议来“远程制备纠缠”**，就离不开让两个光子**在一定程度上满足干涉“对齐”条件**。否则，“不对齐”便失去了该协议里最关键的“可干涉性”，等于破坏了纠缠制备的核心物理机制。

------

## 2. 保真度只是“单次成功后”的一方面指标

在前述计算中，我们把“完全对齐（HOM 干涉极好）”和“完全不对齐（光子彼此可分辨）”当作**两个极端**来比较“若只后选出单次点击事件时，得到的状态保真度”——这是一种**理想化、对比用**的极端分析。事实上：

1. **“不对齐”那种更高保真度，是以“真正的量子干涉几乎消失”为前提**，所以它更像是说：“如果两路光子不能也不想干涉，双光子有一半情况会产生双击被丢弃，剩下一半才混入单击”。这种情形在很多具体的量子网络协议里，**根本无法产生可用的远程纠缠**，或者产生的纠缠极弱、极低概率、甚至需要其他辅助机制才可恢复相干性。
2. 前述公式只是计算了**在桶式探测器下，“误将双光子事件当作单光子”带来的污染**。但**真正能否制备出纠缠**，还要看干涉条纹（Hong–Ou–Mandel 干涉或者不区分性干涉）是否存在、探测器点击是否与正确的 Bell 项投影相对应。

换句话说，**那组保真度公式并不是在说“DLCZ 完全不需要干涉也能做纠缠”。** 它只是一个“若只从光子数分辨角度，双光子‘碰巧共用一个探测器端口’的比例会怎样影响混合态”的粗略模型。**真正想做远程量子纠缠/隐形传态，必须得在时间/频率等自由度上做精细的对准**（对齐），使得光子在 BS 上“本征不可区分”——这才是**DLCZ 协议最核心**的一步。

------

## 3. 现实中为什么还要“部分对齐”而非“完全对齐”？

既然**完全不对齐不能产生日常所需的纠缠**，那为什么又有实验现象会提到“对齐度过高反而导致保真度下降”呢？其根本原因在于**实验的探测器通常无法分辨光子数**（bucket detector）：

1. 当**光子高度相干重叠**时，香港–于–曼德尔（HOM）干涉会把双光子**束缚(bunching)**到同一输出端口；
2. 探测器看不出“这个端口来的是俩光子还是一个光子”，只输出“有点击”。
3. 这样一来，原本应该“多激发 -> 多光子 -> 不该 herald 纠缠”的情形，也会被错误地认作了“单激发 -> 单光子 -> 纠缠成功”。于是把多激发成分污染进了 herald 后的“纠缠态”，拉低了保真度。

所以在**实际实验**里，研究者往往会选择一个**最优激发概率 $p$**（通常 $p\ll 1$，几乎是1%甚至更小），并对时间/频谱/模式做**高精度匹配**，确保真正需要的“单光子干涉”顺利发生。同时也**认清双光子事件依然会偶尔出现**，想办法进一步**减少或排除这部分多光子杂质**，例如：

- 用更好的探测器（带有限的光子数分辨能力），在探测到“双光子”信号时直接剔除；
- 在激发概率上做微调，让 $p$ 足够小，以降低 $p^2$ 带来的双光子污染；
- 在协议层面使用更多次的“分级中继”、更多轮的纠缠纯化 (entanglement purification) 技术等。

也就是说，**让光子真正地“对齐干涉”仍是不可或缺的步骤**；至于文献里说的“对齐后保真度下降”，是因为我们的探测器不给力，不能区分多光子，就被这些束缚在同一端口的“双光子”事件给坑了。它并不是说“那我们干脆完全不用对齐”，因为那样你基本上就得不到可用的纠缠了。

------

## 4. 小结

- **“把两个腔连进分束器，完全不用对齐”并不能完成 DLCZ 协议中要求的远程纠缠制备**。在量子网络中，“不对齐”意味着两个光子从各种自由度都可被区分，量子干涉消失，也就**无法产生**我们需要的远程量子纠缠。
- 前面提到的不对齐导致**“双击率 = 0.5,p^2,\eta^2”**以及由此带来**保真度数值较高**，指的是*在纯粹光子数概率模型*下，“双光子有一半会走向双击而自动被丢弃，剩下那一半才会带来单击污染”。这种**不区分事件**本身**不等同于“成功生成高保真纠缠”**——真正的纠缠生成依赖于光子不可分辨干涉。
- 故而在真实实验中，研究者“想对齐又不想太大概率地产生多光子束缚事件”，往往会**把激发概率 $p$ 调得非常低**，并尽量使用更好的探测器或后续纠缠纯化等来**提升保真度**。若有可分辨光子数的探测器，则能把多光子事件直接滤除，在“对齐”情况下同时保持**较高成功率**和**较高保真度**。

简而言之：

> **想要通过量子干涉来产生纠缠，就必须保证光子在时频等自由度上“不可区分”也就是要“对齐”。**
>  “不对齐”虽然在纯光子数分析中看似可以降低多光子污染，但它同时破坏了“可干涉性”，从根本上让你拿不到想要的远程纠缠，因而**不能简单地“完全不用对齐”**。

这就是为什么在实际的远程量子通信/量子网络实验里，还需要做繁琐的模式匹配、稳定控制、激光时序同步等：**没有对齐，就没有可用的远程纠缠**。

Q:除非你可以定量的计算出我一点也“拿不到想要的纠缠”否则我还是会不理解对齐的必要性
A:下面给出一个**定量**的、相对简化的推导示例，用来说明：

- 当两个远程节点（A、B）各自以单光子方式耦合到同一个分束器(BS)时，若这两个光子在时间/频率/空间等自由度上**不可区分（“对齐”）**，则可以在探测到“有一个光子点击”时，**后选出远程自旋(或原子系综)的纠缠态**；
- 若这两个光子**完全可区分（“不对齐”到重叠积分为0）**，则**不会**形成任何远程纠缠，量子干涉效果完全消失，最终只能得到“古典混合态”，无量子纠缠。

这就定量解释了：**若想通过干涉来制备远程纠缠，就必须对齐；若完全不对齐($\gamma=0$)，则从理论上可严格推导“纠缠度=0”，什么也得不到**。

------

## 1. 两节点单光子激发的理想化模型

假设有两个远程原子（或原子系综）节点 A、B。每次脉冲只考虑到“一阶近似”：每个节点要么不产生光子、要么产生**至多一个**光子，且产生的概率很小($p\ll 1$)。这里我们先忽略多光子(二阶及以上)的情形，只关注**如何用单光子的干涉来“后选”远程纠缠**。

1. A 节点处的“单光子”波包记为 $\lvert \psi_A \rangle$。
2. B 节点处的“单光子”波包记为 $\lvert \psi_B \rangle$。

若它们在时间、频率、空间等自由度上是完全相同(仅路径不同)，则称其**不可区分**；若它们彼此正交，则称**完全可区分**。

为刻画这种“部分区分/重叠”的程度，引入一个重叠积分(归一化内积)

$\gamma  \;=\; \langle \psi_A \,\vert\, \psi_B \rangle,$

其中 $\gamma=1$ 表示两光子态在所有自由度上完美重叠(理想对齐、不可区分)，$\gamma=0$ 则表示它们完全正交(完全不对齐、可区分)。

------

### 1.1 光场态的初始超级叠加

在一次激发脉冲结束后，假设（只考虑单光子分量）系统光场的量子态可写成

$\lvert \Psi_\text{in} \rangle \;=\; \frac{1}{\sqrt{2}} \Bigl( \lvert \psi_A \rangle \;+\; e^{i\phi}\,\lvert \psi_B \rangle \Bigr).$

- 这里的 $\frac{1}{\sqrt{2}}$ 只是表明：节点 A 或 B 产生光子的幅度各占一半；
- $e^{i\phi}$ 表示可能存在的相位差；
- $\langle\psi_A|\psi_A\rangle = \langle\psi_B|\psi_B\rangle = 1$，且二者内积为 $\gamma=\langle\psi_A|\psi_B\rangle$。当 $\gamma\neq1$ 时，这两个单光子态并不完全相同。

在 DLCZ 协议或许多“单光子干涉制备纠缠”的实验中，只有当 $\gamma$ 足够接近 1 时，才能保证光子在分束器上发生**高可见度的量子干涉**。

------

## 2. 分束器(BS)测量如何“后选”远程纠缠

通常做法是：把这两个光子($\lvert \psi_A\rangle$ 和 $\lvert \psi_B\rangle$)分别从两个输入端口(两条光纤)送入一个 50:50 BS，然后在 BS 的两个输出端口(记为 $\mathrm{D_1}$ 和 $\mathrm{D_2}$)上各放一个单光子探测器。**若探测到恰有一次单光子“点击”**，则宣称成功制备远程节点 A、B 之间的**单自旋(单原子激发)纠缠**。

> **关键点**：只有当两光子“不可区分”地进入同一个 BS，探测到一次单击才可能在远程节点中留下一个**相干叠加**的自旋激发态（即纠缠）。若两光子完全可区分，就无法在探测器点击时得到“究竟来自 A 还是 B”的不确定性叠加。

下面用一个最简化的描述来展示这一点。

------

### 2.1 完全不可区分 ($\gamma=1$) 时：得到最大纠缠

- 若 $\gamma=1$，则 $\lvert \psi_A \rangle = \lvert \psi_B\rangle$ (仅路径不同，时间/频率/偏振模式相同)。此时两路光子在 BS 上发生**Hong–Ou–Mandel(HOM)** 等量子干涉。
- 探测到“D1 有单次点击”或“D2 有单次点击”时，无法区分“光子源自 A 还是 B”，对应着把远程节点的自旋(原子)态投影到近似 Bell 态$\,\frac{1}{\sqrt{2}}(\lvert W_A\rangle + e^{i\phi}\lvert W_B\rangle)$。这是一个**纯的远程纠缠态**。

量子力学的更完整推导会告诉你：若 $\gamma=1$，在忽略多光子分量的情况下，每次“单击”herald 后节点 A 和 B 所处的自旋激发就是**最大度纠缠**(忽略损耗、相位抖动等实验不理想因素)。

------

### 2.2 完全可区分 ($\gamma=0$) 时：无法产生纠缠

- 若 $\gamma=0$，则 $\lvert \psi_A\rangle$ 与 $\lvert \psi_B\rangle$ 在时域/频域/偏振/空间模式上是**正交**的，就像来自两个完全不同时间窗口或不同频率信道。

- 它们在 BS 上不会发生相干叠加(干涉项消失)。换言之，光子检测到时，**可以(哪怕只是在量子力学层面)“区分”它是来自 A 还是 B**。这会破坏“谁的光子触发了点击”的量子不确定性，也就无法在 A、B 两处原子之间留下任何相干叠加。

- 结果：当探测器单击时，要么说明“A 发的那个波包被探测到”，要么说明“B 发的那个波包被探测到”，二者以 50:50 经典混合出现。这个混合态在节点 A、B 的自旋空间对应：

  ρ=12 ∣WA⟩⟨WA∣  +  12 ∣WB⟩⟨WB∣,\rho = \tfrac12\,\lvert W_A\rangle\langle W_A\rvert \;+\; \tfrac12\,\lvert W_B\rangle\langle W_B\rvert,

  这是一个**无任何量子相干项**的**经典概率混合**，不具备纠缠。利用标准纠缠度量（如 concurrence、negativity 等）去计算，都得到零。

也就是说，$\gamma=0$ 时，“单次点击”并不包含任何量子干涉成分，因此**无法**产生 EPR 式的远程纠缠。

------

## 3. 带部分重叠 ($0<\gamma<1$) 时的纠缠度

更一般地，若 $\gamma$ 处于 0 与 1 之间，表示两个光子波包“部分重叠、部分可区分”。此时经过 BS 干涉和探测后，在 A、B 节点上剩下的自旋态是一种“部分相干、部分混合”的状态。简略地写，它可表示为

$\rho(\gamma) = \tfrac{1}{2} \Bigl( \lvert W_A\rangle\langle W_A\rvert + \lvert W_B\rangle\langle W_B\rvert \Bigr) \;+\; \tfrac{\gamma}{2} \Bigl( e^{i\phi}\,\lvert W_A\rangle\langle W_B\rvert + e^{-i\phi}\,\lvert W_B\rangle\langle W_A\rvert \Bigr).$

其中，“对角项”是经典混合，“非对角项”受限于 $\gamma$。当 $\gamma\to 1$，非对角项与对角项同样大，得到纯态的最大纠缠；而当 $\gamma\to 0$，非对角项消失，变成不纠缠的完全混合态。

若计算其**纠缠度量**(比如 concurrence $C$)，可得

$C(\rho(\gamma)) = \max\{\,0,\;|\gamma|\}\,.$

因此：

- $\gamma=1$ 时，$C=1$，达到最大纠缠；
- $\gamma=0$ 时，$C=0$，完全无纠缠。

> 这正是**定量**说明了：**若两个光子完全不对齐($\gamma=0$)，则最终远程节点的状态中没有任何纠缠；而只有当二者足够对齐($\gamma\approx1$)才能得到显著纠缠。**

------

## 4. 回答“为什么一定要对齐”

综上所示，DLCZ 协议(及各种基于“单光子探测式”来制备纠缠的方案)的根本机理是：

1. 同步激发两个可能的单光子；
2. 在 BS 上让它们的量子振幅**相干叠加**，从而在“测到一个探测事件”时无法区分光子来自 A 还是 B；
3. 这种不区分性让 A、B 的自旋(或原子激发)坍缩到一个非对角的叠加态，即**纠缠态**。

如果两光子在时间/频率/极化/空间模式等方面**完全对不齐**（$\gamma=0$)，则从根本上就没有量子干涉可谈——探测器端可以(在量子幅度层面)“区分”光子出处，产生的只能是一个经典混合态，**无纠缠**。这在数学上体现在非对角项(相干项)被彻底压制、纠缠度为零。

因此，**想“拿到”远程纠缠，就必须让两路光子在 relevant 模式(时间、带宽、偏振等)上彼此高度重合，从而满足 $\gamma\approx 1$**。任何宏观的错位(不对齐)都会削弱或摧毁干涉，可用的纠缠产率随之急剧下降。也正是因为要保持 $\gamma\approx 1$，实验上才需要复杂的激光时序同步、频谱滤波、稳相稳温等“模式匹配”技术。

**结论**：

> - 从**定量计算**看，“完全不对齐($\gamma=0$)”时，后选结果中**纠缠度=0**，你“真的什么也拿不到”；
> - 只有“高度对齐($\gamma\approx1$)”才能获得“高保真远程纠缠”，这正是 DLCZ 等基于单光子干涉协议的**必要物理条件**。

这便回答了为什么要“对齐”。在先前讨论里提到的“不对齐时，光子双击率增大、单击保真度模型似乎变好”那种说法，仅是一个**“光子数桶式探测”下多光子污染的**概率性分析，与“真正能否制备远程量子纠缠”是两件事。**若彻底不对齐($\gamma=0$)，则干涉根本不存在，纠缠自然也就无从谈起。**

Q:但为什么完全不对齐时保真度不为0，反而会比纠缠时候高？
A:在先前的讨论里，我们常常看到这样的结论（**在不具备光子数分辨的“桶式”探测器前提下**）：

- **“对齐”时（HOM 干涉好），双光子更容易**“抱团”同时跑到同一个探测器端口**，从而被误认为是“单光子事件”，这会**拉低**我们“宣称成功”时得到的单激发（或单光子）**纯度**，最终导致**保真度下降**。
- **“不对齐”时，双光子有一半会被探测到“双击”而直接舍弃（不会误判为单光子）**，因此在那些**只出现“单击”**的后选事件中，**实际单光子**所占比重较大，故而看到“保真度更高”的数值。

这常常被写成类似：

$F_{\text{matched}}\approx 1 - \tfrac{p}{2},  \quad  F_{\text{unmatched}}\approx 1 - \tfrac{p}{4},$

（其中 $p\ll1$ 为原子激发概率），因此“不对齐”时表面上**保真度还**比“对齐”时**更高**。

然而，这个“保真度”实际上指的是**在光学层面/探测事件层面**，后选出来的那次“单击”到底有多大概率真的是“单光子”的**纯度**(或称**“假单光子”污染率**的补值)。它并**不是**指**“远程节点上制备的纠缠态保真度”**。一旦我们关心的目标是“远程纠缠”或者“隐形传态”的**量子保真度**，情况就截然不同了：

------

## 一、区分两种“保真度”：

1. **“单击”光子事件的单光子纯度**
   - 这是前面那些概率公式推导出来的：“当我只收集那些探测器只点了一下（single click）的事件时，它里面有多少比例确实是‘只有一份光子、没有多光子成分’？”
   - 由于不对齐会自动把一半双光子事件踢到“双击”里去（被丢弃），剩下那一半才“污染”单击，因此这个“单击后光子仍是单光子”的纯度要比对齐时更高。
2. **远程节点（原子或自旋）上实际形成的“纠缠态保真度”**
   - 如果你要通过“单光子干涉探测”来制备远程纠缠(比如 DLCZ 协议中要在分束器上叠加 A、B 两端来的光子，然后测到一个探测器点击时宣称“节点 A、B 已被投影到某个纠缠态”)，**那么光子必须彼此“不可区分”地干涉**，也就是要“对齐”。
   - **如果完全不对齐**（光子彼此在时间/频率/空间上正交），那么在量子力学层面，“探测到一个点击”时也能（哪怕仅仅在振幅上）**区分出光子来自 A 还是 B**，从而**不会在 A、B 处留下任何相干叠加**——也就**没有纠缠**。那时的“远程态”只是一个经典混合态，对应纠缠度=0。

换句话说：

- **“不对齐”所带来的“更高保真度”指的是“所探测到的单击事件里，确实只有一个光子”的比例更高**，亦即**光学层面**的单光子纯度。
- **但若目标是“通过干涉获得远程纠缠”**，就要求光子彼此在模式上“不可区分”($\gamma\approx1$)；此时才有**量子相干**，并在“单击”时把节点态投影到EPR对。如果**完全不对齐**，那就**无法制备到纠缠**，远程量子态保真度为0，根本谈不上“隐形传态”。

------

## 二、为什么“完全不对齐”时远程纠缠为零，却又看到“保真度更高”？

**这是两个不同的“保真度”在作比较。** 在许多基础文献或讲解中，用“保真度”一词既可以指：

1. **光学单击事件中，单光子成分的纯度**（无多光子污染的比例）；
2. **远程原子或自旋态的纠缠保真度**。

这两者**概念不同**。前者只是在光子数意义上“是否真的是一个光子”，后者关注的是“在节点上有没有形成量子相干纠缠”。

- “不对齐”确实能自动把一部分双光子事件分流到“双击”，从而“单击”里假单光子污染较少，所以测量得到的**“单光子纯度”**看起来更好；
- 可是**没有光子干涉**就不能在远程节点间创建量子纠缠，因而真正用于“隐形传态”的**纠缠保真度**等于**零**。

也就解释了“为什么看到不对齐时(光子彼此可分辨)那条公式‘保真度’比对齐时还高”——它其实并**不**代表“远程纠缠态更好”，而是**代表**“后选事件中单光子成分比例更高”。在 DLCZ 协议或任何需要“光-物质纠缠/接口”的方案里，若我们真正关心“远程量子纠缠/传态”的保真度，那就**必须做对齐**。

------

## 三、小结

- **在前面提到的那种“F = (单光子占比)/(单击事件占比)”的公式分析中，F 只是一种刻画“多光子污染”对“单光子后选”的影响的指标**，与是否产生**远程纠缠**不是一回事。
- **如果要利用单光子干涉来制备远程纠缠**（例如 DLCZ 协议），光子必须模式重叠$\gamma\approx1$。一旦**完全不对齐**($\gamma=0$)，远程纠缠度就会**严格为零**。
- 那个“看起来不对齐时得到的保真度更高”的结论，只是说明：在“不对齐”的光学实验里，用“单击事件”后选时，光子确实更接近单光子态（因为双光子会更容易被“双击”检测到）。但这并**不能**带来远程量子纠缠，故对“隐形传态”的目标而言，毫无用处。

正因如此，**要想“拿到想要的纠缠”或“进行量子隐形传态”**，就**必须对齐**。否则虽然在光子探测层面看似“单光子纯度”高，但那只是纯粹的“一个光子来自A或B”的古典混合，不含任何可用于量子传态的纠缠资源。

Q:所以我想看看远程量子态如何做到保真度为0以及完全相干时候保真度的有关P的理论最大值
A:下面给出一个较为“从头到尾”的定量模型，来说明：

1. **若两个远程节点各产生的光子在分束器上完全不对齐(可区分)**，即使只后选出“单击”探测事件，其“光子纯度”貌似很高，但**远程原子/自旋态却根本没有量子干涉**，只能得到一个对目标 Bell 态(或EPR对)**保真度不超过 1/2**的经典混合态（无纠缠）。对两量子比特而言，F≤1/2 即意味着**与真 EPR 对的纠缠度为零**。
2. **若两光子在分束器上对齐(不可区分、发生量子干涉)**，则只要激发概率足够小，就能在“单击”事件中获得很高的远程纠缠保真度，理想极限下可达 **F=1**。实际在有限小概率 $p$ 时，保真度仍然能显著大于 1/2，从而确实产生了量子纠缠。

这就回答了常见疑惑：“为什么有时看到‘不对齐’时单光子纯度或某个‘F’值还更高，但却说它根本没有纠缠？”——因为那里讨论的“F”通常只是“后选单击事件中，单光子所占比例”的一种**光子数纯度**指标，而不是**远程节点对理想 EPR 态的量子保真度**。要真正获得远程纠缠(可用于量子隐形传态)，必须让光子在分束器上实现“不可区分”的量子干涉，彻底“不对齐”($\gamma=0$)时最终对EPR态的保真度反而锁死在 1/2 或以下，意味着**没有生成任何纠缠**。

------

# 目录

1. [DLCZ 式“单击”制备纠缠的简化假设](https://chatgpt.com/c/67fa6070-b78c-8012-917a-9ed3218fe19c#sec1)
2. [完全不对齐时：远程状态是经典混合，保真度$\le 1/2$](https://chatgpt.com/c/67fa6070-b78c-8012-917a-9ed3218fe19c#sec2)
3. [完全对齐时：远程可得高保真纠缠，$F>1/2$](https://chatgpt.com/c/67fa6070-b78c-8012-917a-9ed3218fe19c#sec3)
4. [总结：不对齐“假纯净”，对齐才能有真纠缠](https://chatgpt.com/c/67fa6070-b78c-8012-917a-9ed3218fe19c#sec4)

------



## 1. DLCZ 式“单击”制备纠缠的简化假设

为聚焦说明原理，先做几个常见“最低阶”近似(亦是最基本的 DLCZ 模型要点)：

1. **每个节点只考虑 0 或 1 个光子激发**，产生光子的概率为 $p \ll 1$。忽略多于 1 个光子的更高阶小量($p^2,\,p^3,\dots$)所带来的次级影响——后面会把 $p^2$ 也纳入，但只当它对应“双端各出 1 光子”的事件。
2. 在分束器(BS)的两路输入端放置节点 A 与节点 B 发出的光子；探测器是“桶式”(无法区分光子数)，只输出“有点击/无点击”。我们只在“恰有一个探测器点击”时，宣称在远程节点的自旋(或原子)上制备到了某种“单激发纠缠态”。
3. 不同情况下，“双光子”成分要么被测到“双击”(则丢弃)，要么同时跑向同一个探测器端口(则会假装成“单击”)，从而污染远程态。

下文分别分析：**(a) 光子完全不对齐(可分辨)** 和 **(b) 光子完全对齐(不可分辨,有HOM干涉)** 两种极端情形下，最后“远程节点所得到的量子态”与“它对理想 EPR 对的保真度”各是多少。

------



## 2. **完全不对齐时**：远程是经典混合，$F \le 1/2$ 无纠缠

所谓“完全不对齐”即两路光子在时间/频率/空间模式等任意一个自由度上**严格正交**，从而在分束器上没有量子干涉。可以想象成：

- 来自节点 A 的光子脉冲是波包 $\lvert \psi_A\rangle$，
- 来自节点 B 的光子脉冲是 $\lvert \psi_B\rangle$，
   并满足$\langle \psi_A \mid \psi_B \rangle = 0$。

### 2.1 单次激发/双次激发的概率

记节点 A 或 B 产生(最多)一个光子的概率分别为 $p$。则：

- **只有 A 出光子，B 不出**：概率约为 $p(1-p)$
- **只有 B 出光子，A 不出**：同理 $p(1-p)$
- **A、B 同时各出一光子**：概率 $p^2$.
- **都不出光子**：概率 $(1-p)^2$，但那时不会触发探测点击(真空)，也不在我们后选的“单击成功”事件之内。

### 2.2 不对齐下的探测分支

1. 若只有 A 或只有 B 出了光子，送到 50:50 BS 后，无论它走向哪一端探测器，都只会触发**一次单击**。
2. 若 A 和 B **同时**各出一光子，由于它们彼此**可区分**，在分束器上不会发生“Hong–Ou–Mandel 干涉相消”——所以有 **50%** 概率两光子分别去往两个探测器端口，从而出现**双击**；另 **50%** 概率它们同向一个端口(被桶式探测器误看成一次点击)。

因此，当探测器最终只出现**单击**(Single Click)时，可能来源于：

- (单光子) A 或 B 独自产生 ($\sim 2\,p(1-p)$)；
- (双光子) A、B 同时产生但碰巧一起走同一端口($\sim \tfrac12\,p^2$)。

令我们只关心那些“单击成功”事件，并将其归一化后形成远程节点的量子态 $\rho_{\text{unmatched}}$。则该态是一个混合：

- 以某个概率 $\alpha$ 是“真正的单自旋激发(对应光子只来自 A 或 B)”，
- 以某个概率 $1-\alpha$ 是“双自旋激发(两个节点都激发了)”，但光子都跑向一个端口让探测器误报“单击”。

而**在DLCZ最简单的单激发编码里**，“双自旋激发”态与“单自旋激发”态属于**正交**(不同激发数)的子空间——它对单激发的Bell态(EPR对)的“重叠”可以看作 0。于是它完全破坏了纠缠保真度。

计算中，忽略探测效率 $\eta$ 或设 $\eta=1$ 只为简洁，不影响结论；保留主要依赖量 $p$。

#### 2.2.1 归一化系数与 $\alpha$

- 单光子事件总概率：$2\,p(1-p)$.

- 双光子事件中能被误判为“单击”的概率：$\tfrac12\,p^2$.

- 整体“单击”几率(归一化之前)是

  Psingle click  =  2 p(1−p)  +  12 p2.P_{\text{single\,click}}  \;=\; 2\,p(1-p) \;+\; \tfrac12\,p^2.

- 因此，“真正单激发”所占比例（在单击条件下）为

  α  =  2 p(1−p) 2 p(1−p)  +  12 p2   =  2p(1−p)2p(1−p)+12p2 .\alpha  \;=\; \frac{2\,p(1-p)}{\,2\,p(1-p)\;+\;\tfrac12\,p^2\,} \;=\; \frac{2 p(1-p)}{2 p(1-p) + \tfrac12 p^2}\,.

将分母作一些代数化简，可得

$\alpha  =  \frac{2 p(1-p)}{2 p(1-p) + \tfrac12 p^2} = \frac{p(1-p)}{\,p(1-p) + \tfrac14 p^2\,} = \frac{1-p}{\, (1-p) + \tfrac14 p\,} = \frac{1-p}{1-p + \tfrac14 p} = \frac{1-p}{1 - \tfrac34 p}.$

(也可保持原状，无碍。)

#### 2.2.2 “单激发”那部分仍是 **无相干的 50:50** 混合

即使在那 $\alpha$ 部分真正源自“只有 A(或 B) 发了一个光子”，但是——因为光子是“可区分”地来自 A 或 B，**并没有在分束器上形成量子相干叠加**。当我们看到单击，就**能(在振幅层面)区分**“是 A 的光子”还是 “是 B 的光子”，这就破坏了“谁发出光子”的量子不确定性。故而在节点空间只得到一个**经典混合**：

$\rho_{\text{single-excitation}}  \;=\; \tfrac12\,|W_A\rangle\langle W_A| \;+\; \tfrac12\,|W_B\rangle\langle W_B|.$

这里 $|W_A\rangle$ 表示节点 A 有 1 个自旋(原子)激发，B 处在基态；$|W_B\rangle$ 则相反。两者无相干项，即无 $|W_A\rangle\langle W_B|$ 或 $|W_B\rangle\langle W_A|$ 项。

#### 2.2.3 合并形成“远程态”并计算对 Bell 态的保真度

故单击后远程态可写为

$\rho_{\text{unmatched}} = \alpha \Bigl[ \tfrac12\,|W_A\rangle\langle W_A| + \tfrac12\,|W_B\rangle\langle W_B| \Bigr] \;+\; (1-\alpha)\,\underbrace{|\text{double-excitation}\rangle\langle\text{double-excitation}|}_{\text{与单激发态正交}}$

其中“double-excitation”态对单激发的 Bell 态完全无重叠；因此该部分对 $\rho_{\text{unmatched}}$ 与 $\lvert\Phi^+\rangle$ 的内积贡献为 0。(这里 $\lvert\Phi^+\rangle$ 可视为 $\frac1{\sqrt2}(\lvert W_A\rangle + \lvert W_B\rangle)$ 在单激发子空间的一种 EPR 对。)

于是 $\rho_{\text{unmatched}}$ 与 $\lvert\Phi^+\rangle$ 的保真度就是前半部分的 overlap。我们知道

$\Bigl\langle \Phi^+ \Bigl\vert  \tfrac12\,|W_A\rangle\langle W_A| + \tfrac12\,|W_B\rangle\langle W_B| \Bigr\vert \Phi^+ \Bigr\rangle = \tfrac12$

因为
 $\langle \Phi^+|W_A\rangle = \tfrac1{\sqrt2}$, $\langle \Phi^+|W_B\rangle = \tfrac1{\sqrt2}$。故

$F_{\text{unmatched}} \;=\; \langle \Phi^+ |\, \rho_{\text{unmatched}} \,| \Phi^+ \rangle = \alpha \times \tfrac12 \;+\; (1-\alpha)\times 0 = \tfrac{\alpha}{2}.$

把 $\alpha$ 带入后，得到

$F_{\text{unmatched}} = \frac{1}{2}\,\frac{2\,p(1-p)}{2\,p(1-p)+\tfrac12\,p^2} = \frac{2\,p(1-p)}{\,4\,p(1-p)+p^2\,} = \frac{2(1-p)}{4 - 3p}.$

（可直接从分子分母同时乘个 2 即得此形式。）这就是“不对齐时，在桶式探测仅出现 single click 事件”的情形下，远程节点态对理想 Bell 态 $\lvert\Phi^+\rangle$ 的保真度(最大重叠)。

- 当 $p \to 0$ 时，$F_{\text{unmatched}} \to \tfrac{2}{4} = 0.5$。
- 对任意 $0，仔细计算可发现 $F_{\text{unmatched}}\le 0.5$，而且 $F_{\text{unmatched}}<0.5$ 一般更低。
- 在两比特系统中，$\;F \le 1/2$ 正好意味着无纠缠(“可分离状态”与 Bell 态的最大保真度就是1/2)。换句话说，此时远程节点**根本没有生成 EPR 式纠缠**，量子隐形传态也不可能高于古典极限。

> **结论**：
>  **完全不对齐($\gamma=0$) 只能得到$F_{\text{unmatched}}\le0.5$，无纠缠。**
>  这就是定量地说明了：哪怕在光子数上“误筛掉”了不少双光子事件，让“单击”里好像更“纯”，也改变不了**没有干涉就没有纠缠**的事实。

------



## 3. **完全对齐时**：远程可得高保真纠缠，$F>1/2$

现在看另一个极端：**两光子在时空/频谱/偏振等自由度上几乎完美重叠($\gamma\simeq1$)**，它们在 50:50 BS 上发生理想化的 Hong–Ou–Mandel(HOM) 干涉。那就有：

- 双光子不会分别跑向两端探测器 (**双击概率近乎 0**)，而会**束缚在一起**(bunching) 同向一个端口；
- 因此，如果**两端都产生了光子**，往往会被桶式探测器错看成“单光子点击”，在后选远程态里导致多激发污染。

然而，只要激发概率 $p$ 够小，这种“双激发污染”在总的“单击”事件中所占比例也依然是 $O(p)$ 或 $O(p^2)$ 的小量，故可以得到大于 1/2 的保真度(意味着确实有纠缠)。下面做同样的计算。

### 3.1 单击事件的概率分解

- **只有 A 或只有 B 出光子**：概率约 $2\,p(1-p)$。
   一旦有 1 光子进入分束器就肯定会被探测到(理想化 $\eta=1$)，给出 single click。
- **A、B 同时出光子**：概率 $p^2$。在理想 HOM 干涉下，它们绝不会跑向不同端口 (双击=0)，而是一起束缚到同一端口，被桶式探测器误报成“单击”。

因此，此时“单击”出现的总概率为

$P_{\text{single\,click}}  =  2\,p(1-p) + p^2 =  p\,\bigl[2\,(1-p) + p\bigr] = p\,(2 - p).$

而其中真正源自“单自旋激发”的占比

$\beta = \frac{\,2\,p(1-p)\,}{\,2\,p(1-p) \;+\; p^2\,} = \frac{2p(1-p)}{\,2p(1-p)+p^2\,} = \frac{2(1-p)}{2 - p}.$

另一部分 $(1-\beta)$ 则是“双自旋激发”误判成了“单击”。

### 3.2 对远程 EPR 对的保真度

1. **单激发那部分**(概率 $\beta$)：
    如 DLCZ 协议所要求，由于两光子在 BS 上不可区分地干涉，单点击测会将节点态投影到一个(近似)Bell 态 $\frac{1}{\sqrt2}(|W_A\rangle \pm |W_B\rangle)$。其与理想 EPR 对的保真度可视为 1（在此忽略腔或原子的额外相位噪声等）。
2. **双激发那部分**(概率 $(1-\beta)$)：
    对应节点 A、B 都有一个自旋激发，属于双激发态，与单激发的 Bell 态正交，故重叠为 0。

于是，单击后远程态对 $\lvert \Phi^+\rangle$ 的保真度就是

$F_{\text{matched}} = \beta \times 1 + (1 - \beta) \times 0 = \beta = \frac{2(1-p)}{\,2 - p\,}.$

- 当 $p \to 0$，$\;F_{\text{matched}} \to 1$，得到理想的最大纠缠；

- 对任意 $0，$\;F_{\text{matched}} > 1/2$，体现了量子纠缠的存在(对两维单激发子空间来说，$\,F>0.5$ 即为纠缠)。并可用小 $p$ 展开：

  Fmatched=2(1−p)2−p  ≈  1−p2(p≪1),F_{\text{matched}} = \frac{2(1-p)}{2 - p} \;\approx\; 1 - \frac{p}{2} \quad (p \ll 1),

  说明只要激发概率很小，保真度就非常接近 1。

------



## 4. **总结：不对齐“假纯净”，对齐才能有真纠缰**

上面两节给出了**完全不对齐**($\gamma=0$)与**完全对齐**($\gamma=1$)这两个极端时，“只在探测到 single click 后选远程原子/自旋态”的详细概率与保真度计算。结果可以浓缩在下表：

| 光子状态 | “单击”来源                                 | 远程节点态                | 对Bell态保真度 $\,F$                        |
| -------- | ------------------------------------------ | ------------------------- | ------------------------------------------- |
| 不对齐   | ① 单光子(A或B) ② 双光子($\frac12$概率单击) | 经典混合+双激发污染       | $\displaystyle \frac{2(1-p)}{4 - 3p}\le0.5$ |
| 对齐     | ① 单光子 ② 双光子(全都bunch到同端口)       | **有**量子相干+双激发污染 | $\displaystyle \frac{2(1-p)}{2 - p}>0.5$    |

- **不对齐($\gamma=0$)**：探测“单击”后，远程态要么是“$|W_A\rangle$或|W_B\rangle)的古典混合”，要么是“双自旋激发”(与单激发态正交)。整体对 EPR 对的最大重叠 $\le 1/2$，表示**无纠缠**。
- **对齐($\gamma=1$)**：单击事件中若真正是单光子(A或B)，则会在远程节点之间留下(近似) Bell 态纠缠；双光子束缚所带来的污染份额随 $p$ 增大而增加，但只要 $p$ 足够小，整体保真度仍明显大于 1/2，从而确有远程纠缠。理想 $p\to0$ 时可达 $F=1$。

这正是**定量**地说明：

1. **“完全不对齐”时，看似单击事件里“双光子污染少一些”，但那只是光子数意义上的“更纯”**；实际在远程节点并没有留下可用于量子隐形传态的纠缠(保真度$\le0.5$)。
2. **要想“真的拿到EPR纠缠”**，光子必须在分束器上有较高的空间/时间/频率/偏振模式重叠($\gamma\approx1$)，即“对齐”。此时才有量子干涉去制造远程叠加态，而不是古典混合。
3. 之所以人们有时会说“对齐使得双光子 bunching 增加了假单光子触发，从而降低保真度”，那是相对于“同样对齐条件下、如果能光子数分辨检测(区分双光子)”所作的比较。**并不是**和“彻底不对齐($\gamma=0$)”去比谁纠缠更好：后者根本没有纠缠。

**换句话说**：完全不对齐($\gamma=0$)情形下，“保真度变高”只指“在光子数视角中，单击时确实更常只有一个光子”。可是一旦牵扯到“远程量子态”，**没有干涉就没有相干性**，只能得到一个与 EPR 对重叠不超过 1/2 的经典混合态，**其纠缠度为 0**。

> **最终结论**：
>
> 不对齐：Funmatched  =  2(1−p) 4−3p   ≤  0.5,    无纠缠.对齐：Fmatched  =  2(1−p) 2−p   >  0.5,    确有纠缠.\boxed{ \begin{aligned} &\text{不对齐：} \quad F_{\text{unmatched}} \;=\; \frac{2(1-p)}{\,4-3p\,}\;\le\;0.5,\;\;\text{无纠缠}.\\[6pt] &\text{对齐：} \quad F_{\text{matched}} \;=\; \frac{2(1-p)}{\,2 - p\,}\;>\;0.5,\;\;\text{确有纠缠}. \end{aligned} }
>
> 也可以看出对齐情形中，随着 $p$ 增大，多激发污染让保真度下降，但依然大于 1/2；而 $p\to0$ 时趋近 1，是制备高保真远程纠缠的理想极限。



Q:那对于介于纠缠度介于完全不纠缠与最大纠缠之间的某种对齐程度，严格的计算隐形传态保真度的过程是什么样的？
A:下面给出一个带“部分对齐程度”($\gamma$)的**严格计算示例**，说明在介于“完全不对齐($\gamma=0$)”与“完美对齐($\gamma=1$)”之间时，通过“单光子探测式”DLCZ 协议所制备的远程量子态，其**隐形传态保真度**（或等价地，对理想 Bell 对的态保真度）如何随 $\gamma$ 和激发概率 $p$ 演化。

------

# 总体思路

1. **两个远程节点**(A、B)各以小概率 $p$ 激发产生至多一个光子。光子脉冲记为 $\lvert \psi_A\rangle$ 与 $\lvert \psi_B\rangle$，它们在时间/频率/空间模式上有一个**重叠因子**

   γ  =  ⟨ψA∣ψB⟩,0  ≤  ∣γ∣  ≤  1.\gamma \;=\;\langle \psi_A \mid \psi_B\rangle,\quad 0 \;\le\;|\gamma|\;\le\; 1.

   - $\gamma=0$ 表示二者完全正交(“不对齐”)，可被区分；
   - $\gamma=1$ 表示二者完全同态(“完美对齐”)，不可区分。

2. 将这两路光子输入同一个 50:50 分束器(BS)，再用**桶式探测器**(无法区分光子数)监测输出端口，**只在恰有“单击”(Single Click)**时宣称“制备到了远程纠缠”。

3. 由于还存在“双光子”($p^2$)情形以及部分对齐下的“双光子干涉不完全”，会有一部分“多激发”误被当作“单击”事件，污染远程态。

4. 我们最后关心的是真正投影到**单激发子空间(对应理想的 Bell 对)**的那部分“纯度”或“保真度”——它决定了量子隐形传态能否优于经典极限($\tfrac23$ 或保真度$>1/2$)。

下文分步给出计算：先看“单光子”与“双光子”的干涉及触发概率，再得到远程节点上所形成的混合态 $\rho(\gamma)$，最后计算其与理想 Bell 对的保真度 $F(\gamma)$，以及相应的**隐形传态保真度**。

------

## 1. 部分对齐时的“单光子”与“双光子”干涉

### 1.1 单光子情形

假设节点 A、B 中只有**一端**产生了一个光子(“单光子事件”概率约为 $P_{1}=2\,p\,(1-p)$)。若我们在分析光子进入 BS 的量子态，则可写成（忽略全局相位、总归一化）：

$\lvert \Psi_1\rangle \;=\; \sqrt{\frac12}\,\lvert \psi_A\rangle \;+\; e^{i\phi}\sqrt{\frac12}\,\lvert \psi_B\rangle,$

其中 $\langle\psi_A|\psi_B\rangle = \gamma$。当只有这一个光子进入分束器时，“双击”不可能出现(因为只有一份光子)。探测器**一旦**检测到“有点击”，就只说明“确有一个光子来了”，**但并未(也无法)区分它来自 A 还是 B**。

- 若 $\gamma=1$，两个波包**完全相同**，“谁发的光子”不可区分；
- 若 $\gamma=0$，则两个波包正交，从探测器振幅角度可以区分“是 A 的光子”还是“B 的光子”。

尽管此时系统里**只有一份光子**，依然可能因为 $\gamma<1$ 而保留部分“可区分信息”。这会体现在远程节点(原子)的最终投影态中：若测得单击但光子可区分，就难以在 A、B 上形成真正的相干叠加(纠缠)。

> $\textbf{要点}$：当只有一份光子，$\gamma\neq1$ 并不会改变“单击”必然发生（若忽略损耗），但**会改变**“远程态中 A、B 的相干项”是否保留。

------

### 1.2 双光子情形

若节点 A、B **同时**各产生一个光子(概率 $p^2$)，则需要考虑**两光子在 BS 上的干涉**。对于入射自两个正交输入端口的单光子态 $\lvert \psi_A\rangle\otimes \lvert \psi_B\rangle$，其在 50:50 BS 上的散射通常给出两种走向：

- **同一个输出端口**(bunching)，探测器只会看到“单次点击”(桶式探测下看不出是两个光子叠加)；
- **不同输出端口**，探测到“双击”(两个探测器各点一次)。

若这两个入射光子完全不可分辨($\gamma=1$)，便出现理想 Hong–Ou–Mandel (HOM) 效应：它们**总是**同时跑向同一端口，双击概率=0。而若两光子彼此可区分($\gamma=0$)，则**各有一半概率**分往两个端口，导致 50% 的双击。

对于**部分对齐**，两光子波包的“同端口”与“分端口”概率介于二者之间。经过详细的两光子干涉计算(见量子光学教科书或相关文献)可知：

- **同端口**(bunching)概率 $\;\propto\; \tfrac12\,\bigl[1 + |\gamma|^2\bigr]$.
- **不同端口**(分开)概率 $\;\propto\; \tfrac12\,\bigl[1 - |\gamma|^2\bigr]$.

对于桶式探测器(不能区分来的是一光子还是两光子)，**只要两光子一起跑到同一个端口**，就会被“误判”为“单击”。而若它们跑向不同端口，则显现为“双击”同时点击 —— 在我们的协议中这会被**丢弃**，不算“成功”事件。

------

## 2. “单击”事件及其在远程节点上的后选态

令：

- $P_{1} = 2\,p(1-p)$ 为单光子(只 A 或 B 出光子)的总概率；
- $P_{2} = p^2$ 为双光子( A、B 同时各出一光子 )的总概率。

在忽略探测器损耗($\eta=1$)的简化下：

1. **单光子事件**总会导致“有且仅有一次点击”($\mathrm{Single\,Click}$)，**但**量子态中保留的**A、B 相干程度**取决于 $\gamma$。
2. **双光子事件**下，只有当两光子“束缚”到同一个端口($\tfrac12\,[1 + |\gamma|^2]$)时才出现“单击”，否则出现“双击”被丢弃。

因此，“$\mathrm{Single\,Click}$成功”发生的概率为

$P_{\mathrm{SC}}(\gamma) = \underbrace{P_{1}}_{\text{单光子}} \;+\; \underbrace{P_{2}\,\tfrac12\,[1 + |\gamma|^2]}_{\text{双光子跑同端口}}.$

具体数值即

$P_{\mathrm{SC}}(\gamma) = 2\,p(1-p) \;+\; p^2\,\frac{1 + |\gamma|^2}{2}.$

同时，我们定义

$\alpha(\gamma) \;=\; \frac{\;P_{1}}{\,P_{\mathrm{SC}}(\gamma)\,} = \frac{\;2\,p(1-p)\;}{\,2\,p(1-p)\;+\;\tfrac12\,p^2\,[1+|\gamma|^2]\,}.$

它表示：**在所有“单击”事件里，有多大比例源于“真正的单光子”**(而非双光子误判)。显然 $\alpha(\gamma)$ 随 $p$ 增大而减小，随 $|\gamma|$ 增大也减小（因为$|\gamma|$ 越大，双光子越倾向跑同一端口）。

------

### 2.1 来自“单光子”那部分的远程态

当确实只有 A 或 B 发出一个光子，而它们在模式上部分重叠($\gamma\neq0$)，探测器得到一次单击却不揭示“光子来自哪边”。由此会将远程节点(原子)的状态投影到**(近似)一个相干叠加** $\lvert W_A\rangle + \gamma e^{i\phi}\lvert W_B\rangle$。

更加严格的量子光学推导（参见 DLCZ 协议原始文献或后续教程）表明：

- 在忽略额外相移的理想下，**单激发子空间**可写为

  ∣Ψsingle-excitation⟩  ∝  ∣WA⟩  +  γ eiϕ ∣WB⟩,\lvert \Psi_{\text{single-excitation}}\rangle \;\propto\; |W_A\rangle \;+\; \gamma\,e^{i\phi}\,|W_B\rangle,

  其中 $\gamma=\langle \psi_A|\psi_B\rangle$ 体现了光子波包重叠在探测模式上的相干系数。

- 该态若正好与 $|W_A\rangle + e^{i\phi} |W_B\rangle$ 有充分重叠，则表明我们无法区分光子究竟来源 A 还是 B，因而在 A、B 间遗留下了量子相干。若 $|\gamma|\ll 1$，相干项几乎消失，远程态更接近一个**经典混合** $\tfrac12|W_A\rangle\langle W_A| + \tfrac12|W_B\rangle\langle W_B|$。

这一单激发态在“单击触发”后归一化可写为

$\rho_{\text{1ph}}(\gamma) = \lvert \Psi_{\text{1ph}}(\gamma)\rangle\langle \Psi_{\text{1ph}}(\gamma)\rvert ,\quad \lvert \Psi_{\text{1ph}}(\gamma)\rangle = \frac{\,|W_A\rangle + \gamma e^{i\phi} |W_B\rangle\,}{\sqrt{1+|\gamma|^2}} .$

它与理想 Bell 态 $\lvert \Phi^+\rangle \equiv \tfrac1{\sqrt2}(|W_A\rangle + e^{i\phi}|W_B\rangle)$ 的重叠(保真度)为

$F_{\text{1ph}}(\gamma) = \bigl|\langle \Phi^+ \mid \Psi_{\text{1ph}}(\gamma)\rangle\bigr|^2 = \frac{ \bigl|\,1 + |\gamma|\,\bigr|^2 }{ 2\,\bigl(1+|\gamma|^2\bigr) } = \frac{1 \,+\,2|\gamma| \,+\,|\gamma|^2}{2\,(1+|\gamma|^2)} = \frac{(1+|\gamma|)^2}{\,2\,(1+|\gamma|^2)\,}.$

可见：

- 当 $\gamma=1$ 时，$F_{\text{1ph}}=1$，即完美单激发 Bell 态；
- 当 $\gamma=0$ 时，$F_{\text{1ph}}=\tfrac12$，退化为纯粹的“等概率混合”对角态，与 Bell 态最大重叠只有 1/2。

------

### 2.2 来自“双光子”那部分的远程态

若 A、B 同时各有一个自旋激发(两光子), 对应节点态 $\lvert W_A,\,W_B\rangle$。这是一个**双激发**态，和单激发态($\lvert W_A\rangle \pm \lvert W_B\rangle$)完全正交。

只要双光子一起跑到同一端口，就会被桶式探测器“误报”为一次单击。但这种事件对于远程节点而言并非“单激发纠缠”，而是**真正的双激发** $\lvert W_A\rangle\otimes|W_B\rangle$。它与单激发 Bell 态**无重叠**(正交空间)，对后续隐形传态也不提供任何纠缠。所以在计算保真度时，它的贡献为 0。

------

## 3. 远程态与对 Bell 对的保真度

把上面两种来源(单光子 vs 双光子)混合在一起：当探测器上只出现“单击”时，远程节点的(非归一化)密度矩阵可写作

$\rho_{\text{raw}}(\gamma) = \underbrace{P_{1}\,\rho_{\text{1ph}}(\gamma)}_{\text{真正单光子}} \;+\; \underbrace{\Bigl[\tfrac12\,p^2\,(1+|\gamma|^2)\Bigr]\,|W_A,W_B\rangle\langle W_A,W_B|}_{\text{双激发误报}} .$

归一化因子即总单击成功率 $P_{\mathrm{SC}}(\gamma)$。因此，条件化后的正规化态是

$\rho_{\text{SC}}(\gamma) = \frac{\rho_{\text{raw}}(\gamma)}{P_{\mathrm{SC}}(\gamma)} = \alpha(\gamma)\,\rho_{\text{1ph}}(\gamma) \;+\; \bigl[1-\alpha(\gamma)\bigr] |W_{AB}\rangle\langle W_{AB}|,$

其中

$|W_{AB}\rangle \;=\; |W_A\rangle\otimes|W_B\rangle \quad (\text{双激发态}),$

且

$\alpha(\gamma) \;=\; \frac{\,P_{1}\,}{\,P_{\mathrm{SC}}(\gamma)\,} = \frac{\,2\,p(1-p)\,}{\,2\,p(1-p)\;+\;\tfrac12\,p^2\,[1+|\gamma|^2]\,}.$

### 3.1 与理想 Bell 对的保真度

令 $\lvert\Phi^+\rangle = \tfrac1{\sqrt2}(\lvert W_A\rangle + e^{i\phi}\lvert W_B\rangle)$ 表示我们想要的那一支(或其它等价的 Bell 基底)。则可得该混合态的保真度

$F(\gamma) \;=\; \langle \Phi^+\rvert\,\rho_{\text{SC}}(\gamma)\,\lvert \Phi^+\rangle = \alpha(\gamma) \;\underbrace{\langle \Phi^+\rvert\,\rho_{\text{1ph}}(\gamma)\,\lvert \Phi^+\rangle}_{F_{\text{1ph}}(\gamma)} \;+\; \bigl[1-\alpha(\gamma)\bigr]\times 0$

（因为$\langle\Phi^+|W_{AB}\rangle=0$）。故

$F(\gamma) = \alpha(\gamma)\,F_{\text{1ph}}(\gamma) = \alpha(\gamma) \;\frac{(1+|\gamma|)^2}{\,2\,(1+|\gamma|^2)\,}.$

再把 $\alpha(\gamma)$ 的明细表达式代入，即

$F(\gamma) = \frac{\,2\,p(1-p)\,}{\,2\,p(1-p)\;+\;\tfrac12\,p^2\,[1+|\gamma|^2]\,} \;\times\; \frac{(1+|\gamma|)^2}{\,2\,[1+|\gamma|^2]\,}.$

这是一个随 $p$ 和 $\gamma$ 共同决定的函数，表示“部分对齐(\gamma\neq0,1)”时，**在单击事件条件下，远程节点的量子态对理想 Bell 对的保真度**。可以看到：

- 当 $\gamma=0$（完全不对齐）时，

  α(0)= 2 p(1−p)  2 p(1−p)  +  12 p2 ,F1ph(0)=12    ⟹    F(0)=12 α(0)  ≤  12,\alpha(0) = \frac{\,2\,p(1-p)\,}{\,2\,p(1-p)\;+\;\tfrac12\,p^2\,} \quad,\quad F_{\text{1ph}}(0)=\tfrac12 \;\;\Longrightarrow\;\; F(0) = \tfrac12 \,\alpha(0) \;\le\; \tfrac12,

  这与前面完全不对齐的结果一致($\le 0.5$)，无纠缠。

- 当 $\gamma=1$（完美对齐）时，

  α(1)= 2 p(1−p)  2 p(1−p)  +  12 p2 [1+1] = 2p(1−p)  2p(1−p)+p2 ,F1ph(1)=1,\alpha(1) = \frac{\,2\,p(1-p)\,}{\,2\,p(1-p)\;+\;\tfrac12\,p^2\,[1+1]\,} = \frac{\,2p(1-p)\,}{\,2p(1-p)+p^2\,} ,\quad F_{\text{1ph}}(1)=1,

  F(1)=α(1)=2(1−p)2−p,F(1) = \alpha(1) = \frac{2(1-p)}{2-p},

  与我们先前的“理想对齐(HOM)情形”推导吻合，且对于 $p\to0$ 趋近 1，大于 1/2。

对于**任意** $0<|\gamma|<1$，$F(\gamma)$ 介于 0.5 与 1 之间（当 $p$ 小时），表明可以得到一定程度的纠缠，但越小的 $|\gamma|$（越不对齐），可用纠缠就越弱。

------

### 3.2 量子隐形传态保真度

在标准两比特维度下，若我们用 $\rho_{AB}$ 作为量子隐形传态的纠缠资源，则其对未知单比特态的平均传态保真度可以用公式（见 [Popescu(1994)、Horodecki(1999)] 等）表示为

$F_{\text{tele}}  \;=\; \frac{\,2\,F(\rho_{AB},\lvert\Phi^+\rangle)\;+\;1\,}{3}$

其中 $F(\rho_{AB},\lvert\Phi^+\rangle)$ 是 $\rho_{AB}$ 与最佳 Bell 态的最大重叠。因而在我们这里，

$F_{\text{tele}}(\gamma) = \frac{\,2\,F(\gamma)\;+\;1\,}{3} = \frac{2\,\alpha(\gamma)\,F_{\text{1ph}}(\gamma)\;+\;1}{3}.$

只有当 $F(\gamma)>1/2$ 时，$F_{\text{tele}}(\gamma)$ 才能**超过经典极限** $\tfrac23$，从而说明远程量子态确实蕴含可用于隐形传态的纠缠资源。

------

## 4. 结论与图示

- **当 $\gamma=0$ (完全不对齐)**，最终对 Bell 对的保真度恒**不大于 0.5**，隐形传态保真度不超过 $\tfrac23\cdot\tfrac12+\tfrac13=\tfrac23$。这是“无纠缠”的临界值，也就是说**无法借助这种状态做出超过经典极限的量子隐形传态**。
- **当 $\gamma=1$ (完美对齐)**，随 $p$ 的大小可在 $\bigl(0.5,\,1\bigr]$ 区间内得到远程纠缠，$p\to 0$ 时保真度趋近 1。此即之前所谓“HOM 干涉制备纠缠”的情形。
- **一般 $0<\gamma<1$ 时**，$F(\gamma)$ 介于 $\bigl(0.5,\,\alpha(1)\bigr)$之间，表示在分束器上“部分重叠”的两光子确能产生**一定**的相干纠缠，但**越不对齐(\gamma\to 0)**，纠缠保真度就越接近 0.5，无实质量子优势；越对齐(\gamma\to1)，则保真度越接近 1，量子隐形传态保真度也相应更高。

这便是**从头到尾“严格”地在单光子+双光子干涉模型下**，求解出“单击触发后”远程节点态的量子保真度(以及对应传态保真度)随 $\gamma$ 和 $p$ 变化的过程。由此可以清晰看出：

> **只有当光子在分束器上具备足够的不可区分性($\gamma\approx1$)时**，后选得到的远程态才会对理想 Bell 对有大于 1/2 的保真度，从而**真正具有纠缠并可用于高保真量子隐形传态**。
>  若$\gamma$很小(严重不对齐)，则即使光子数意义上的“单击”里“假单光子污染”看似较低，远程量子态依然是**经典混合态**，保真度$\le 0.5$ 表明无纠缠、无量子传态增益。

------

### 最终简要公式汇总

1. **“单击”成功率**：

   PSC(γ)  =  2 p(1−p)  +  1+∣γ∣22  p2.P_{\mathrm{SC}}(\gamma) \;=\; 2\,p(1-p) \;+\; \frac{1+|\gamma|^2}{2}\;p^2.

2. **单击后远程态对 Bell 对的保真度**：

   F(γ)  =  α(γ) (1+∣γ∣)2 2 (1+∣γ∣2) ,α(γ)= 2 p(1−p)  2 p(1−p)  +  12 p2 [1+∣γ∣2] .F(\gamma) \;=\; \alpha(\gamma)\,\frac{(1+|\gamma|)^2}{\,2\,(1+|\gamma|^2)\,}, \quad \alpha(\gamma) = \frac{\,2\,p(1-p)\,}{\,2\,p(1-p)\;+\;\tfrac12\,p^2\,[1+|\gamma|^2]\,}.

3. **隐形传态保真度**($d=2$时)：

   Ftele(γ)  =   2 F(γ)  +  1 3.F_{\text{tele}}(\gamma) \;=\; \frac{\,2\,F(\gamma)\;+\;1\,}{3}.

   当且仅当 $F(\gamma)>1/2$ 才能超过经典传态极限 $\tfrac23$。

把 $\gamma=0$ 和 $\gamma=1$ 代入上式，即可复现前面“完全不对齐”与“完美对齐”两个极端的结果。

------

## 参考备注

- 以上推导集中在“最低阶”近似($p\ll1$)，只包含“单光子事件”与“双光子事件”对量子干涉和探测计数的贡献。真实实验中还需考虑探测器效率($\eta<1$)、光纤/光路损耗、原子自旋去相干等多方面因素，但基本的**“部分对齐”导致“部分可区分性，从而削弱远程相干”**的物理图像保持不变。
- 更为细致的文献中，也会在双光子干涉里引入额外**相对时延**、**频率失配**等，引起 $\gamma$ 的复数相位乃至时间卷积。对本质结论无大碍：$\gamma\approx1$ 才能保证高可见度量子干涉，从而制备高保真纠缠。

------

# 小结

> **对于介于完全不纠缠($\gamma=0$)与最大纠缠($\gamma=1$)之间的“部分对齐”场景，可以用如上分步的严格模型来计算：**
>
> 1. 单光子事件与双光子事件各自进入分束器时的“单击”概率；
> 2. 单击后投影到远程节点的态包含“(部分)相干的单激发成分”与“(正交)双激发成分”混合；
> 3. 对应于与理想 Bell 对的保真度 $F(\gamma)$，以及隐形传态保真度 $F_{\text{tele}}(\gamma)$。
>
> **结果表明**：只有当 $\gamma$ 足够大(近似对齐)时，$\rho_{AB}$ 对 Bell 态的重叠才会显著大于 1/2，从而真正具备可观的量子纠缠和隐形传态优越性；若 $\gamma$ 很小，保真度锁死在 0.5 以下，无法产生纠缠。

Q: 2.1开头这一部分，单激发子空间形式的推导过程可以再详细展示一下嘛？
A: 下面给出一个**更加详细**的推导过程，展示在**单激发（单光子）\**情形下，如何从“原子+光子”的总初始态出发，通过探测到\**恰有一个光子**（单击事件）这一测量，最后在远程节点（原子/自旋）上得到一个**带有$\gamma$的相干叠加态**。这正是“部分对齐($\gamma\neq 1$)”时，单激发子空间所留下的后选（post-selection）态的由来。

> **注意**：这一过程对应的是 DLCZ 协议等“单激发”编码中“$\lvert W_A\rangle \leftrightarrow \lvert \psi_A\rangle$”与“$\lvert W_B\rangle \leftrightarrow \lvert \psi_B\rangle$”之间的一一对应关系：
>
> - “若节点 A 里产生了自旋激发，那么它就会伴随发射一个光子波包 $\lvert \psi_A\rangle$”，
> - “若节点 B 里产生了自旋激发，就会伴随发射一个光子波包 $\lvert \psi_B\rangle$”。
>
> 当只有一个光子存在($p\ll1$并忽略双光子)，我们只关心**那份光子**如何在分束器（或探测端）被检测，以及对应地**远程原子态**会塌缩到什么叠加形式。

------

# 1. 初始的原子+光子联合态

假设在一次激发脉冲后，**只有一个节点**产生了一个自旋激发（并且对应产生一个光子）。若把节点 A、B 产生激发的**幅度**分别记为 $\tfrac1{\sqrt2}$ 和 $\tfrac1{\sqrt2} e^{i\phi}$，则**忽略多光子**情形下，系统(原子+光子)的联合态可以写成

$\lvert \Psi_{\text{total}}\rangle  \;=\; \frac{1}{\sqrt{2}} \Bigl( \lvert W_A\rangle \,\otimes\, \lvert \psi_A\rangle \;+\; e^{i\phi}\,\lvert W_B\rangle \,\otimes\, \lvert \psi_B\rangle \Bigr). \tag{1}$

- $\lvert W_A\rangle$ 表示“节点 A 处有 1 个自旋激发（原子激发），B 处无激发”；

- $\lvert \psi_A\rangle$ 表示“1 个光子在 A 模式”——也可理解为“与节点 A 对应的光场波包”。

- 同理 $\lvert W_B\rangle\otimes \lvert \psi_B\rangle$ 则表示激发发生在 B，光子在 B 模式；

- $\phi$ 为可能存在的相对相位；

- 这里的 $\lvert \psi_A\rangle$ 与 $\lvert \psi_B\rangle$ 在时间、频率、偏振、空间模式上的归一化内积为

  γ  =  ⟨ψA ∣ ψB⟩,0  ≤  ∣γ∣  ≤  1.\gamma \;=\;\langle \psi_A \,\vert\, \psi_B \rangle,  \quad 0 \;\le\;|\gamma|\;\le\;1.

  当 $\gamma=1$ 它们**不可区分**；当 $\gamma=0$ 表示两种光子模式正交，可被区分（“不对齐”）。

> 这一步体现了**“谁发射了光子，就在原子态和光子态之间建立一对一对应”**。由于在“单激发”近似下，不存在同时 A、B 都发射光子的可能（这里先忽略双光子）。

------

# 2. 探测器测量：只关心“恰有一个光子被探测到”

现在，把这两个光子模式 $\lvert \psi_A\rangle$ 和 $\lvert \psi_B\rangle$ 引入同一个**测量装置**（例如分束器后的探测器），并进行**单光子测量**。实验上常见的情形是：

1. 光子从两条光纤或两路输入端口进入一个干涉光路（可能是 50:50 BS 或更复杂的光学元件）；
2. 最终汇聚到若干个“桶式探测器”(只能输出“有点击/无点击”)；
3. 我们只保留**出现恰好一次单击**的情况（single click），并丢弃“无点击”的真空事件。

从量子力学角度，“只出现一次单击”可以被视为对光子做了一个**投影测量**，把光子态投影到“**有且仅有 1 个光子在探测模式**”对应的子空间。若我们**不区分**究竟是哪一个探测器端口点击(只关心“有没有单击”)，或者把多个探测器的“有点击”结果统一起来看，也可以把它抽象成一个测量算符 $\hat{M}$：

$\hat{M} \;=\; \text{(投影到‘恰好1个光子在探测通道’的算符)}.$

对单光子而言，该测量“成功”($\mathrm{SC}$)就是“在输出端找到1个光子”。

------

## 2.1 部分对齐下如何出现相干叠加

若 $\gamma\neq 0$，则在振幅层面，测到“单击”时，无法(在量子层面)区分究竟“这光子来自 A”还是“来自 B”。也就是说，$\lvert \psi_A\rangle$ 与 $\lvert \psi_B\rangle$ 在探测模式上有一定重叠，测量算符不会去区分这两者。

- 于是系统有一定幅度会“投影到 A 发射光子 + 探测到1光子”，还有一定幅度会“投影到 B 发射光子 + 探测到1光子”；
- 这两个幅度在测量后可保留**相干相加**，从而在“远程原子态”那里留下$\lvert W_A\rangle + \gamma e^{i\phi}\lvert W_B\rangle$之类的**叠加**。

相反，若 $\gamma=0$，则测量可以(在振幅层面)区分是“波包 $\psi_A$”还是“波包 $\psi_B$”。这样最终在原子态里就只剩“\lvert W_A\rangle)或\lvert W_B\rangle)”的**经典混合**，无相干项。

------

## 2.2 形式化的投影操作

更微观一点，如果将探测器模式记为一组正交基 $\{\lvert d_i\rangle\}$，其中“有且仅有1个光子被探测”对应 $\lvert d_{\text{click}}\rangle$. 那么测量“单击”可以用投影算符

$\hat{\Pi}_{\text{1-photon}} = \sum_{i} \lvert d_i\rangle\langle d_i\rvert \quad(\text{其中 } \lvert d_i\rangle \text{满足‘单光子在探测输出端口} i \text{’}).$

当作用到光子态 $\lvert \psi_A\rangle$ 与 $\lvert \psi_B\rangle$时，若二者有非零重叠，就会产生干涉交叉项。

------

# 3. 测量后远程原子态的塌缩

量子力学的测量公设告诉我们：测量到“单击”后，系统塌缩到

$\lvert \Psi_{\mathrm{post}}\rangle \;=\; \frac{\hat{M}\,\lvert \Psi_{\text{total}}\rangle} {\sqrt{\bigl\langle \Psi_{\text{total}}\bigr\vert \hat{M}^\dagger \hat{M}\bigr\vert \Psi_{\text{total}}\bigr\rangle}} \;\;,$

其中 $\hat{M}$ 可以理解为对应“单光子探测到 1 个点击”的测量运算。对我们当前只含单光子的模型而言，可以等价于“把光子态投影到非空子空间”，得到归一化后的**原子+光子**态。随后若我们只关心“光子被检测走了”后，留下的**远程原子态**，就要再对光子做“部分迹”($\mathrm{Tr}_\text{photon}$)。

在最简化的讨论中（单光子加桶式探测器），这一步往往直接写成“只要检测到一个光子，就意味着光子走了，留给原子的后选态是 $\lvert W_A\rangle + \gamma e^{i\phi}\lvert W_B\rangle$”。下面是更**显式**的推导：

------

### 3.1 将 (1) 式展开

$\lvert \Psi_{\text{total}}\rangle = \frac{1}{\sqrt{2}} \bigl( \lvert W_A\rangle\otimes\lvert \psi_A\rangle \;+\; e^{i\phi}\,\lvert W_B\rangle\otimes\lvert \psi_B\rangle \bigr).$

测得一次“单击”的非归一化态可写为（示意）：

$\lvert \Psi_{\mathrm{post}}^{(\mathrm{n.r.})}\rangle = \Bigl(\hat{M}\otimes\mathbf{1}_\text{atom}\Bigr) \,\lvert \Psi_{\text{total}}\rangle.$

若 $\hat{M}$ 将$\lvert \psi_A\rangle\mapsto \lvert \text{click}\rangle$ (某个“1光子的检测态”)，同理 $\lvert \psi_B\rangle\mapsto \lvert \text{click}\rangle$，并且在振幅上会有内积 $\langle \psi_A|\psi_B\rangle$ 出现，就可以得到

$\lvert \Psi_{\mathrm{post}}^{(\mathrm{n.r.})}\rangle \;\propto\; \frac{1}{\sqrt{2}} \Bigl[ \lvert W_A\rangle\otimes\lvert \text{click}\rangle \;+\; e^{i\phi}\,\lvert W_B\rangle\otimes (\gamma\,\lvert \text{click}\rangle) \Bigr] \;=\; \frac{1}{\sqrt{2}} \Bigl[ \lvert W_A\rangle + \gamma e^{i\phi}\,\lvert W_B\rangle \Bigr] \otimes \lvert \text{click}\rangle.$

这里的 $\gamma = \langle \psi_A|\psi_B\rangle$ 出现在 “B 光子变成$\lvert \text{click}\rangle$的振幅” 中。

> 注意这只是象征性写法，忽略了探测器可能有多个模式端口的细节，但核心是：当 $\gamma\neq0$ 时，**“B 发射光子 + 检测点击”** 与 **“A 发射光子 + 检测点击”** 在测量后会**相干相加**。

------

### 3.2 部分迹掉光子，“剩下原子态”即单激发叠加

最后，我们只关心远程节点(原子)处的状态，就把光子子空间“迹”掉(因为光子已被探测吸收或消失)。因此得到一个(归一化后)的**原子态**：

$\lvert \Psi_{\mathrm{post}}^\text{(atom)}\rangle = \frac{ \lvert W_A\rangle  \;+\; \gamma\,e^{i\phi}\,\lvert W_B\rangle }{ \sqrt{\,1+|\gamma|^2\,} } . \tag{2}$

这就是通常文献中所说的：“若单击只说明‘有光子来了’却无法区分来自 A 还是 B，节点 A、B 的单激发态因而变成相干叠加 $\lvert W_A\rangle + \gamma e^{i\phi}\lvert W_B\rangle$。” 若 $\gamma=1$，则是完美$\tfrac{1}{\sqrt2}(\lvert W_A\rangle + e^{i\phi}\lvert W_B\rangle)$；若 $\gamma=0$，则两个态正交，检测到光子时就能区分它来自 A 还是 B，导致完全丧失相干（只剩经典混合）。

------

## 3.3 与理想 Bell 对的重叠

若我们把理想 Bell 对写成

$\lvert \Phi^+\rangle = \frac1{\sqrt2}\bigl(\lvert W_A\rangle + e^{i\phi}\lvert W_B\rangle\bigr),$

则 (2) 式态与 $\lvert \Phi^+\rangle$ 的内积为

$\langle \Phi^+\vert \Psi_{\mathrm{post}}^\text{(atom)}\rangle = \frac{1 + |\gamma|}{\sqrt{2\,(1+|\gamma|^2)}} ,$

从而保真度(模方)为

$F_{\text{1ph}}(\gamma) = \bigl|\langle \Phi^+|\Psi_{\mathrm{post}}^\text{(atom)}\rangle\bigr|^2 = \frac{(1+|\gamma|)^2}{\,2\,(1+|\gamma|^2)\,}.$

这正是常见的结果：

- 当 $\gamma=1$，$F_{\text{1ph}}(1)=1$；
- 当 $\gamma=0$，$F_{\text{1ph}}(0)=\tfrac12$，表示单激发态退化成 $\tfrac12|W_A\rangle\langle W_A|+\tfrac12|W_B\rangle\langle W_B|$ 的等概率混合，与任意 Bell 对最大重叠不超过 1/2，故无纠缠。

------

# 4. 小结

以上过程详述了**“单光子”情形下**，因**模式重叠 $\gamma\neq0$** 而产生的量子相干投影：

1. **初始态**：$\tfrac{1}{\sqrt2}\bigl(\lvert W_A\rangle\otimes \lvert \psi_A\rangle + e^{i\phi}\lvert W_B\rangle\otimes \lvert \psi_B\rangle \bigr)$。
2. **测量(单击)后**：对光子子空间执行“恰有1光子被检测到”的投影，若 $\gamma \neq 0$，则这两条“光子来自 A / 来自 B”的振幅会**相干相加**。
3. **部分迹掉光子**：得到远程原子态为 $\lvert W_A\rangle + \gamma e^{i\phi}\lvert W_B\rangle$ 的叠加。若 $\gamma=1$，即是理想 Bell 态；若 $\gamma=0$，则无相干(只剩混合)。

这就是**2.1 开头“单激发子空间形式”**的由来：在部分对齐($\gamma$)下，**单击**并不能区分光子源头，于是保留了幅度 $\gamma$ 的相干项。该态与理想 Bell 态的保真度随 $\gamma$ 单调变化：

$F_{\text{1ph}}(\gamma) = \frac{(1+|\gamma|)^2}{\,2\,\bigl(1+|\gamma|^2\bigr)}.$

> **再加上“双光子”事件**（若 $p^2$ 不可忽略）也会参与“单击”或“双击”，就能得出更完整的混合态以及总保真度(参见之前给出的总公式)。但**单激发子空间**的这一推导，是理解“部分对齐如何在单光子干涉中留下相干叠加”的关键。

Q:我能不能用半经典的方法假设两个光子在光纤里按照波包传播，但是波包峰值在到达分束器的时间上有一个微小差异，把这两个波包当成波函数，算出一个相对物理的，在实验上有一定合理性的γ值
A:可以的，**在实际量子光学和量子信息实验中，常常就会用“波包在时域上的重叠积分”来定量计算两个光脉冲（单光子或弱光）在分束器上干涉时的“不可区分性”系数 $\gamma$**。这是一种非常直观、近似半经典的做法：

1. 将每个光子的包络函数当作一个**规范化**的时域波函数 $\psi_A(t)$ 和 $\psi_B(t)$；

2. 它们在到达分束器前的光纤或光路中，可能有少量群速度差、路径长短差或主动时序调节，导致峰值抵达时间存在一个微小偏移 $\Delta t$；

3. 那么光子在分束器上的**重叠因子**(overlap) $\gamma$ 就可以用**波函数的内积**来计算：

   γ  =  ∫−∞+∞ψA∗(t) ψB(t) dt.\gamma \;=\; \int_{-\infty}^{+\infty} \psi_A^{*}(t)\, \psi_B(t)\,\mathrm{d}t.

   若要考虑幅度、相位、频谱等更多自由度，也可以在多维空间上做相应的积分。

下面给出一个常见的示例——**两个时域高斯波包**仅在到达时间上有微小差异，如何得到一个“在实验上合理”的 $\gamma$ 值。

------

## 1. 用时域高斯波包示例来计算 $\gamma$

### 1.1 两个高斯波包

假设单光子 A、B 在分束器前分别具有（归一化后）相同宽度 $\sigma$ 的高斯包络，但中心到达时间差为 $\Delta t$。则可将它们的时域波函数写成

$\psi_A(t) = \bigl(\tfrac1{2\pi\sigma^2}\bigr)^{\!\!1/4} \exp\!\Bigl[\!-\tfrac{(t - t_0)^2}{4\,\sigma^2}\Bigr],$$\psi_B(t) = \bigl(\tfrac1{2\pi\sigma^2}\bigr)^{\!\!1/4} \exp\!\Bigl[\!-\tfrac{(t - t_0 - \Delta t)^2}{4\,\sigma^2}\Bigr].$

这里，为简洁起见，我们只考虑**纯粹的时间延迟**；不考虑额外的频率失配、相位失配等。如果还要更精细地描述中心频率差、带宽不同或色散效应，也可以把高斯函数扩展到时-频二维形态再做积分。

- 两者都经过**归一化**，满足
   $\;\int |\psi_A(t)|^2 \,\mathrm{d}t = \int |\psi_B(t)|^2 \,\mathrm{d}t = 1.$

### 1.2 重叠积分

根据定义

$\gamma = \int_{-\infty}^{\infty} \psi_A^{*}(t)\,\psi_B(t)\,\mathrm{d}t.$

由于 $\psi_A, \psi_B$ 都是实函数(纯相位为0)，我们直接写作

$\gamma = \int_{-\infty}^{\infty} \psi_A(t)\,\psi_B(t)\,\mathrm{d}t.$

把上面高斯的具体形式代入，就得到一个标准的高斯卷积，结果是

$\gamma = \exp\!\biggl[\!-\frac{(\Delta t)^2}{4\,\sigma^2}\biggr].$

这是一个非常常见、简洁的公式：**两个相同宽度的高斯脉冲在仅有一个时间偏移 $\Delta t$ 时，它们的归一化重叠因子就是 $\exp[-(\Delta t)^2/(4\sigma^2)]$。**

- 当 $\Delta t=0$ 时，$\gamma=1$，表示完美重叠；
- 当 $|\Delta t|\gg \sigma$ 时，$\gamma\approx 0$，说明几乎完全不重叠、可区分；
- 在实验里，如果要求 $\gamma>0.9$ 之类的较高不可区分度，就需将**相对延迟**控制在 $\Delta t \lesssim 1\,(\text{或 }1.5)\,\times \sigma$。

------

## 2. 物理意义与实验合理性

1. **实验合理性**：

   - 在量子光学实验中，尤其是基于单光子干涉或 Hong–Ou–Mandel (HOM) 效应的实验，研究者通常会测量当两个光子波包在时间上逐渐扫描其相对延迟 $\Delta t$ 时，双点击率如何变化，从而提取出一个**干涉可见度**或“波包相对重叠度”$\gamma$。
   - 若波包形状大体是近似高斯(如某些短脉冲激光通过滤波后的形态)，就能用上述计算给出一个非常直观的量化指标：$\gamma \approx e^{-(\Delta t)^2/(4\sigma^2)}$。也可以用实验测得的**HOM干涉曲线**来拟合得到 $\sigma$ 和 $\Delta t$ 的关系。

2. **半经典+量子**：

   - 将波函数“看作经典场包络”在时间轴上做卷积积分，这看起来很“半经典”，但是**对计算两光子干涉和光子不可区分性而言是足够的**。真正的量子描述里，这些包络函数依然是**光场的模式函数**，光子态是 $\lvert 1_{\psi}\rangle = \int \mathrm{d}t\,\psi(t)\,\hat{a}^\dagger(t)\,\lvert 0\rangle$ 这样的形式——归根到底，模式正交性就是靠时空积分来衡量。
   - 因此，这种“把波包当作时域波函数”再求重叠的做法，是实验中最常见、最直观也最简单的近似方法。

3. **进一步拓展**：

   - 若还要考虑**频率失配** $\Delta \omega$、谱宽不等、或者偏振不同等情况，也能将时域高斯乘以一个频率相位因子 $\exp(i\omega t)$ 等，转到频域后进行多维卷积/内积，最终得到一个综合的 $\gamma$。

   - 在量子网络或 DLCZ 协议中，除了时间同步($\Delta t\approx0$)外，还需匹配**中心频率**、**带宽**、**偏振**、**空间模式**等等，总体上都是在算这个多维模式的正交程度：

     γ=∭ψA∗(r,t,ω) ψB(r,t,ω) dr dt dω.\gamma = \iiint  \psi_A^*(\mathbf{r}, t, \omega)\, \psi_B(\mathbf{r}, t, \omega)\, \mathrm{d}\mathbf{r}\,\mathrm{d}t\,\mathrm{d}\omega.

------

## 3. 小结

> - **是的，您完全可以用这种“半经典”/“波包”方法，假设两个光子在各自光纤里经历不同的群延迟，以得到一个定量、对实验很直观的 $\gamma$ 值**。
> - 做法：分别写下两个脉冲的时域波函数 $\psi_A(t)$ 和 $\psi_B(t)$，对它们作**内积**即得重叠度 $\gamma$。比如在最简单的高斯假设下，有 $\gamma = e^{-(\Delta t)^2/(4\sigma^2)}$。
> - 这正是实验里常用来估计“两个光子到达分束器时的时间对准精度”“频率匹配程度”等的基本思路，也非常符合实际操作。

因此，通过这样计算到的 $\gamma$，就能进一步代入量子干涉或 DLCZ 协议的公式，来评估当分束器上部分对齐($\gamma<1$)时的**远程纠缠保真度**、**干涉可见度**等关键量。

Q:既然高斯波包可以，我在想，有没有可能我能做得更仿真一点，把到达分束器的光场描绘得更真实（比如说考虑一些温度，光纤吸收甚至于腔的振动等因素对光学波形的影响）把这个模型建到能够指导实验的程度

A:**完全可以。\**在实验前进行更仿真、更精细的理论建模，综合考虑温度、振动、光纤吸收、腔失配等各种“真实世界”因素对光脉冲形状和相位的影响，是许多量子光学/量子信息实验非常常见且必要的工作。下面给出一些可行思路，说明如何把简单的高斯波包模型\**扩展**到一个能更好“指导实验”的模拟框架。

------

## 1. 思路概览

1. **从最简单的高斯近似出发**：

   - 先写下两个理想高斯脉冲 $\psi_A(t)$、$\psi_B(t)$，并且只考虑一个固定的中心延迟 $\Delta t$。
   - 计算它们的时域重叠 $\gamma = \int \psi_A^*(t)\,\psi_B(t)\,\mathrm{d}t$ 来得到理想情况下的不可区分性。

2. **引入各种扰动/损耗/随机量**：

   - 光纤的长度和色散导致脉冲的**群延迟、啁啾**(chirp)；
   - 温度和振动引起**光程抖动**(path length fluctuation)，使$\Delta t$在时间上慢慢飘移或快速抖动；
   - 腔镜面(或微腔)的热漂移、机械振动导致**腔共振频率漂移**或**耦合效率波动**；
   - 光纤吸收、镜面损耗等造成脉冲**幅度衰减、相位额外因子**；
   - 多个随机因素可能还带宽度的展宽、中心频率的漂移……

   通过在波包的时域/频域表达式中，**显式地纳入这些效应**，或者把它们作为**随机变量**(蒙特卡洛模拟)叠加起来，就能得到一个更真实的光场波形。

3. **数值模拟或解析近似**：

   - 若扰动项很多、相互耦合比较复杂，可采用**数值积分**或**蒙特卡洛(MC)抽样**；
   - 若某些效应比较小，可以做**微扰展开**或用“以一定方差分布的随机$\Delta t$”来对重叠因子 $\gamma$ 进行平均；
   - 最终得到的是一个**有效的或平均的 $\gamma_\mathrm{eff}$**，用来评估在这些扰动下，实验上光子干涉可见度或纠缠保真度大概是多少；
   - 同时，你还能在模拟结果中看出对**某些实验参数(如温度稳定度、振动频率、光纤长度等)**的敏感度，指导哪些环节需要更严格的稳相/稳温/减振措施。

------

## 2. 具体如何把扰动带进波包模型

### 2.1 随机时延/相位抖动

- **时延抖动**：把$\Delta t$视为一个**随机变量**(可能服从正态分布 $\Delta t \sim \mathcal{N}(\mu,\sigma_{\Delta})$，或有某种噪声谱)，那么

  γ(Δt)  =  ∫ψA∗(t) ψB(t−Δt) dt\gamma(\Delta t)  \;=\;  \int \psi_A^*(t)\,\psi_B(t-\Delta t)\,\mathrm{d}t

  不再是一个固定值，而是随$\Delta t$变化。

- 可以用**蒙特卡洛**方式对很多个$\Delta t$样本进行重复计算，或者解析地对 $\Delta t$ 做**平均**：

  ⟨γ⟩  =  ∫ ⁣ ⁣P(Δt) γ(Δt) d(Δt).\langle \gamma \rangle  \;=\;  \int \!\! P(\Delta t)\,\gamma(\Delta t)\,\mathrm{d}(\Delta t).

  这样就能得出一个**有效不可区分度** $\gamma_\mathrm{eff}$，反映了平均情况下的干涉效果。

- **相位噪声**：若脉冲在通过光纤或腔后多了一个随机相位 $\varphi$，可把 $\psi_B(t)$ 在积分中替换为 $\psi_B(t)\,e^{i\varphi}$，同样对 $\varphi$ 分布做平均。对某些极端情况(大范围均匀分布)可能把平均后的$\gamma$直接压到 0。

### 2.2 幅度衰减/色散展宽

- **幅度衰减**：若 B 路比 A 路多一段光纤或有更大损耗，可令

  ψB(t)  →  T ψB(t),\psi_B(t)  \;\to\;  \sqrt{T}\,\psi_B(t),

  其中 $T\le1$为传输透过率(可能是 $T=e^{-\alpha L}$ 形式)。这样两个波包幅度不再相同，计算重叠时还要归一化(或者直接接受$\gamma$并不再是完美地“\le1\”的量，而要区分正交模式投影与整体振幅的影响；通常我们还是关心归一化后时域形状的 overlap)。

- **色散展宽**：如果光纤/腔有群速度色散 $\mathrm{GVD}$，脉冲会在传输后由原本的高斯 $\psi_B(t)$ 变成一个**更宽**的高斯或啁啾脉冲 $\psi_{B,\mathrm{disp}}(t)$。可以用标准脉冲传输方程(如一阶$\mathrm{GVD}$近似)或已有的光纤脉冲传播软件来获得波包变形，再做内积。

### 2.3 腔(或谐振器)的振动与模式失配

- 若你的系统包括一个高 finesse 腔，镜面振动/热漂移会让腔的**共振频率随时间变动**，从而对进入腔内的光子造成不同的反射/透射相移；也可能让腔模与外部耦合模式不匹配；
- 可以把这种**腔频率漂移**用一个随机量 $\delta \omega_\mathrm{cav}(t)$ 表示，并在**传输函数**(如 Lorentzian 的中心频率偏移)里带入该漂移，再对光场进行**频域卷积**。
- 最终得到在探测端口出现的光场包络 $\psi_B(t)$ 会带有额外的**时间/相位失配**或变形，再同 $\psi_A(t)$ 做重叠积分。

------

## 3. 模拟策略

**1. 解析近似/微扰法**

- 当扰动小(例如 $\Delta t$ 的随机抖动量 $\sigma_{\Delta}$ 远小于脉冲宽度 $\sigma$)、或腔频率漂移 $\delta\omega$ 很小，可以用**泰勒展开**或**展开到一阶**近似，得到一个简单的$\gamma(\Delta t)\approx 1 - \frac12(\Delta t)^2/\sigma^2$之类的形式，再把它同概率分布做平均。
- 能快速得到一个**平均重叠**，衡量实验上对准误差对干涉可见度的影响。

**2. 数值积分**

- 直接在程序里对每一种效应(时间延迟、幅度衰减、频率漂移、群延迟色散)进行建模，把最终得到的波包函数 $\tilde{\psi}_A(t)$、$\tilde{\psi}_B(t)$ 离散化后做数值积分

  γ=∑kψ~A∗(tk) ψ~B(tk) Δt.\gamma  =  \sum_{k}  \tilde{\psi}_A^*(t_k)\, \tilde{\psi}_B(t_k)\,\Delta t.

- 这样对复杂失配(不一定高斯形状)也可以算得足够精确。

**3. 蒙特卡洛(MC)模拟**

- 把“温度、振动、镜面抖动”等当成一些**随机变量**(或者随机过程)，对每一次模拟都先“抽取”一组扰动参数(比如一个$\Delta t$值、衰减$T$值、相移$\varphi$等)，再计算一次$\gamma$。
- 重复成百上千次，得到一个分布 $\gamma_i$。最后取均值或中位数，就得到 “在这些实验波动下，我们大概能维持 $\overline{\gamma} \approx 0.8\pm 0.1$” 的结论。
- 同时也能看出在某些极端噪声较大时，$\gamma$跌破 0.5 的概率多高，这对实验容差评估非常有用。

------

## 4. 如何“指导实验”

1. **得出对稳定度的需求**
   - 通过数值或 MC 模拟，你可以发现：要把 $\gamma$ 维持在 0.9 以上，需要 $\Delta t$ 的标准差 $\sigma_{\Delta}$不超过多少、相位抖动不超过多少弧度……由此提出**对锁相、对准、稳温**的量化指标。
2. **分析不同噪声源贡献**
   - 你可以分别开启/关闭某个噪声源(例如只考虑热噪声、只考虑振动)看看它单独造成的影响，从而知道实验中优先抑制哪种噪声最有效。
3. **评估对测量速率、成功率的影响**
   - 在长距离量子网络或 DLCZ 协议里，还有探测效率、光子损耗引发的成功率下降。你可以在模拟里加上“每次波包衰减到$\sqrt{T}\psi$或0” 以随机事件表示“丢光子”。
   - 最后得到 “实际预期的纠缠生成速率是理想值的 30%” 之类，对实验排期或可行性评估有帮助。

------

## 5. 小结

> - **从高斯波包出发做时域/频域重叠积分**，是最基础的做法。
> - **要让模型更“仿真”**，就需要把各种现实因素(温度漂移、振动、色散、吸收、腔频率漂移等)逐一写进波包的传播与探测过程，然后对**最终的有效重叠 $\gamma_\mathrm{eff}$**或干涉可见度进行数值或统计求平均。
> - 这些方法——**解析近似、数值积分、蒙特卡洛**——都已在量子光学与量子通信社区广泛使用，可以做到对实验较强的指导意义：它不仅能给出一个量化的“看起来$\gamma$会掉到多少”，还可帮助你发现“主要瓶颈在哪”以及“若要提升$\gamma$，在哪些硬件或环境控制上应下更大功夫”。

因此，**完全可以**在“半经典”单光子(或弱相干)波包框架下，把各种真实环境扰动都纳入进去，使得模拟结果足够细致、足够接近实验情形，从而指导实验设计和误差预算。

Q:在这个角度上，QED腔里面，原子自发辐射所放出的光子在波形上最有可能是什么样的？我觉得可能不是高斯光，但我不确定用什么来表达一个原子在腔里放出的一个斯托克斯光子更好
A:在典型的单原子腔 QED 场景下，一个原子在腔模中自发辐射所放出的**单光子**，其时域波包往往**并非简单的高斯**。最常见的情况是它呈现**指数或“近指数”衰减**的形状，或者在特定的激光驱动与耦合条件下，能被**主动整形**成对称的上升—下降脉冲。下面从几个角度来说明为什么通常不是高斯，以及在不同腔 QED 配置下如何得到光子的具体“波形表达”。

------

# 1. 为什么往往不是高斯？

1. **自发辐射的自然退相干**
    在自由空间中，一个简单二能级原子自发辐射时，Weisskopf-Wigner 理论告诉我们其光场振幅常呈“指数衰减”随时间衰减（忽略多普勒、碰撞等复杂因素）。这源于原子—电磁场的耦合以及原子激发态的**Markovian**退相干过程。
   - 虽然在实验中探测到的光强可能看起来“接近高斯”，但在理想极限下**振幅**通常更接近**单指数**衰减。
2. **腔衰减与原子跃迁共同决定**
    当把原子放进高 finesse 腔中，系统总的辐射模式会受到“腔衰减速率 $\kappa$”、“原子自发辐射速率 $\gamma$”、“耦合强度 $g$”等多个参数的影响。
   - 在“强耦合”极限($g \gg \kappa,\,\gamma$)下，体系会产生真空 Rabi 震荡，单光子的发射过程可能展示**振荡衰减**或更复杂时域形状。
   - 在“Purcell 区域”或“坏腔极限”($\kappa > g \gg \gamma$)下，腔模式会加速原子的辐射($\Gamma_{\mathrm{eff}}>\gamma$)，使得单光子振幅在一个较短时间内迅速发射，形状通常也偏**单指数或倍指数**衰减。
      总之，**腔衰减本身**往往就是一个简单指数过程，而自发辐射也可视作单指数或振荡衰减，最终耦合到输出镜所形成的**输出光子包络**也就多是指数或叠加指数型。
3. **Raman/斯托克斯光子通常是“Raman 散射脉冲”所决定**
    在包含“$\Lambda$ 型三能级”(如 DLCZ 协议里典型的光学跃迁+自旋储存)的体系中，斯托克斯光子往往由**Raman 散射过程**产生。
   - 那个散射过程在时间上会有一个耦合脉冲(泵浦)与原子(或原子系综)状态的相互作用决定，通常也不是高斯，而是由“泵浦脉冲包络 $\Omega(t)$”以及“腔/自发衰减速率”综合决定，常见结果是**指数或近指数**、或在特定驱动下做成**对称时域整形**。

因此，**在不额外整形的天然情况下**，“单原子在腔中自发发出的光子”多半会是**类指数衰减**或带少量振荡的指数衰减，而非高斯。

------

# 2. 多种典型的波包表达式

为说明时域波形可以有哪些典型形式，以下举出几种常见的腔 QED 场景及其单光子脉冲解析解(或近似解)。

------

## 2.1 纯粹的“坏腔极限”——简单指数

在所谓的 **“Purcell 区域”** ($\kappa \gg g \gg \gamma$) 中，腔的衰减是主导过程。若原子被激发后，**最可能**的出路是先把能量转移到腔场，然后腔场再通过一面半透镜快速泄露成输出光子。

- 在该模型下，如果我们忽略了真空 Rabi 振荡等复杂过程，可以得到光场近似满足一个简单的“单指数衰减”形状：

  ψ(t)  ∼  Γeff e−12 Γeff t(t≥0),\psi(t) \;\sim\; \sqrt{\Gamma_{\mathrm{eff}}}\, e^{-\tfrac12\,\Gamma_{\mathrm{eff}}\,t} \quad (t \ge 0),

  其中 $\Gamma_{\mathrm{eff}} \approx \tfrac{4g^2}{\kappa}$ 表征 Purcell 增强后的有效辐射率；这是**衰减常数**。在时间 $t<0$ 可以视为 0（还没开始发射）。

- 此时输出镜口耦合出的单光子脉冲振幅与**腔场衰减**一起构成**单指数**，并非高斯。

------

## 2.2 强耦合下的“真空 Rabi 震荡”——振荡或双指数

当腔与原子达到**强耦合**($g$ 很大, $\kappa,\gamma$ 相对小)，原子与腔场相互交换激子(光子)。如果原子最初处于激发态 $\lvert e\rangle$ 而腔无光子，那么演化会出现**Rabi 震荡**：能量在“原子激发—腔光子”之间来回振荡，然后逐渐被腔损耗(或原子自发辐射)带走。输出端口测量到的单光子脉冲可能在时域上带有一些振荡上升、再衰减的特征，也可以分析成**双指数**的形式，或者更复杂的解析解：

$\psi(t) \;\sim\; \bigl[ A\,e^{-\lambda_+\,t} \;+\; B\,e^{-\lambda_-\,t} \bigr] \sin(\Omega\,t+\dots) \quad (\text{举例})$

其中 $\lambda_{\pm},\;\Omega$ 等由 $\{g,\,\kappa,\,\gamma\}$ 组合而成。实验中若$\kappa$不算太小，可以看到一两个明显的“振荡峰”后快速衰减。

------

## 2.3 受控 Raman 散射——可以做时间对称或自定义形状

在很多**腔辅助的拉曼(斯托克斯)光子发射**方案中(例如“腔增强型 DLCZ”或者“单原子 $\Lambda$ 系统用驱动脉冲产生单光子”)，我们往往有一个**经典驱动脉冲** $\Omega(t)$ 施加在另一个跃迁上，并让“信号光子”与原子-腔模式的拉曼过程产生单光子。若$\Omega(t)$ 可以自由设计，就能在一定程度上**塑造**输出单光子的时域包络。

- 比较著名的例子：**时间对称**或者**非对称**单光子脉冲都能通过特定的驱动脉冲整形实现，从而利于和量子存储介质的模式匹配。

- 在具体理论模型中，会得到类似微分方程：

  c˙atom(t)  =  −(some rates) catom(t)  −  Ω(t) cphoton(t),\dot{c}_\text{atom}(t)  \;=\;  - (\text{some rates})\,c_\text{atom}(t) \;-\; \Omega(t)\,c_\text{photon}(t),

  c˙photon(t)  =  …\dot{c}_\text{photon}(t)  \;=\;  \dots

  最后解出的 $c_\text{photon}(t)$ (即单光子振幅)可以是**接近高斯、指数、甚至严格时间对称**，取决于具体设计。

- 尤其在离共振较远、文献常称“Raman 独立于腔频移”情况下，很多人会选一个**稍微平顶的驱动**来得到近似**单指数**，或将驱动做“阶梯-反阶梯”以得到“上升-下降对称”波形。

------

# 3. 小结与建议

1. **一般情况下**，一个单原子在腔里“自然”地放出光子的**时域波包典型是指数或近似双指数衰减**，并不呈高斯；除非进行**特殊的脉冲驱动和模式整形**，否则高斯波包并不是最常见的自然形状。
2. **Raman (斯托克斯)光子**情况下，波形由**泵浦脉冲形状**与**腔衰减/原子动力学**共同决定，可通过合理设计来得到(几乎)任意想要的波包形状，包括高斯、方形脉冲、时间对称脉冲等——但那是额外的**技术手段**在“塑形”。
3. **在实验或数值模拟中**，若你只想要“单原子腔 QED 自发辐射”的最基础形状，一般可从“二能级原子+单模腔+损耗(\kappa,\gamma)$”的主方程或光场海森堡方程(或者用输入-输出理论)去求解，结果大都体现**指数衰减**或“衰减叠加振荡”的特征。

因此，如果你在模拟或分析“腔里的原子自发放出一个斯托克斯光子”，**最稳妥**的做法就是**从具体的主方程(主方程/海森堡方程)出发**，写出含有拉比耦合 $g$、腔衰减 $\kappa$、原子衰减 $\gamma$、以及驱动脉冲 $\Omega(t)$ 的系统演化方程，数值解出输出场的时域振幅——那才是**最准确**、也最常用的方法。常见结果确实不会简简单单是高斯，而更接近**指数**或**可控整形**后的“自定义”形状。

Q:那对于图中这个特定的系统呢？Rb发出两种波长的斯托克斯光子

[图片]

图1. 实验装置与量子比特读出。(A)光镊中的原子被加载至法布里-珀罗光纤腔（FPFC）上方并输运至腔模内。该FPFC具有单 模输入端口和多模输出端口，透射光通过输出端口被收集。腔长通过810nm激光器实现稳定，原子被囚禁在腔的850nm模式中。 780nm模式与铷原子的D2线耦合。磁场方向沿腔轴对齐。(B)铷-87的原子能级图。读出过程将腔共振于2↔3′跃迁，而纠缠产生 时腔则调谐至1↔1′跃迁。(C)裸腔（灰色）、单原子（蓝色）和双原子（红色）与腔耦合时的共振透射谱。曲线为联合拟合结果， 得到参数g=100.0(8) MHz与κ = 65(1) MHz，对应协作度C = 101(2)。(D) 光子计数直方图显示原子处于F=1态（灰色）和F=2态 （蓝色）时10µs内收集的光子数，量子比特态读出保真度达99.960+14 −24%。所有误差条均为标准误差均值。

A:下面结合图中这套具体的$\mathrm{^{87}Rb}$ 原子与光纤腔(Fabry‐Perot Fiber Cavity)耦合的实验系统，谈一下**为什么会同时观测到两种(乃至多种)不同波长的斯托克斯光子**，以及它们在时域波形上通常是什么样子。

------

## 1. 实验系统概览

如图所示，该实验将少数(甚至单个)冷铷原子加载到光纤腔模中，并用不同激光(780 nm/810 nm/850 nm)来实现原子的冷却、捕获、光学泵浦、以及腔‐QED 读出/纠缠等过程。

- **780 nm** 通常对应铷原子D2线($5S_{1/2}\to5P_{3/2}$)的主跃迁，用于探测或读出(cavity resonance)；
- **810 nm、850 nm** 等则可能是离共振一定量的拉曼激发/斯托克斯散射所对应的**斯托克斯/反斯托克斯光子**，或者是给定激光耦合到另一条超精细跃迁中所产生的 Raman 侧频。

在典型的$\Lambda$型或多能级方案里，“斯托克斯光子”往往并不严格与 780 nm 主跃迁同波长，而是由**拉曼散射**决定(如 $5S_{1/2},F=1 \leftrightarrow 5P_{3/2},F'$ 经过不同路径下行到 $5S_{1/2},F=2$ 或反之)，从而在 810–850 nm 区段产生。该实验利用这些光子去做**原子态测量(读出)\**或\**纠缠光子的制备**。

------

## 2. 为什么会有“不止一种”斯托克斯波长？

1. **多个可能的拉曼/自发跃迁通道**
    Rb 的D2线包含 $F=1,2$ (基态) 与 $F'=0,1,2,3$ (激发态) 等多条超精细结构。若给定的驱动(泵浦)频率并不与其中某条跃迁完全共振，就会激发**拉曼散射**：光子从泵浦频率经过“虚跃迁”到另一个超精细态，散射出“斯托克斯(或反斯托克斯)光子”。
   - 每一种“初态$F$$\to$终态$F'$”通道对应一个特定能量差($\Delta E$)，辐射出的光子频率也随之改变。这样就可能得到两种乃至更多波长的斯托克斯光子。
2. **腔模对不同波长的选择性或增强**
    如果腔模本身对 780 nm 做了共振增强(用于读出)，又在 810 nm、850 nm 处有较弱的腔增益(或腔透射)窗口，则当原子通过拉曼过程产生这些波长的光子时，仍有一定概率耦合到输出口。因而在探测器端就能观测到两种不同波长的“斯托克斯光子”事件。

------

## 3. 它们的时域波包形状通常如何？

### 3.1 纯自发(坏腔极限)时：近似单指数衰减

若处于“坏腔极限”($\kappa\gg g,\gamma$)并且光子的产生是近似**自发辐射**加上腔的快速泄漏，那么发射到输出口的光子波包常呈**单指数**或倍指数衰减的时域形状。它由“原子自发跃迁速率”和“腔的衰减$\kappa$”共同决定，常被写作

$\psi(t)\sim e^{-\tfrac12(\Gamma_\mathrm{eff})t},\quad t>0,$

其中$\Gamma_\mathrm{eff}$是有效增强或修饰后的辐射率。

### 3.2 强耦合(真空Rabi振荡)时：有振荡或双指数特征

若腔与原子强耦合($g\gg \kappa,\gamma$)，原子激发与腔光子之间会发生Rabi振荡，导致输出光子具有**振荡衰减**或双(多)指数的混合行为，有时还能看到一两个峰值的时域结构。

### 3.3 Raman散射(受控驱动)时：可整形成对称或自定义脉冲

许多实验为提高与其他量子器件的模式匹配，或实现**时间反演**操作，会对拉曼驱动激光做**脉冲整形**($\Omega(t)$可编程)。这样可使斯托克斯光子变成**近似高斯、对称上升–下降**或更复杂的时域包络。其具体形式要从耦合方程(包含腔衰减、原子跃迁、驱动脉冲)数值解才能得到。

> 因此若该图中的系统是“Rb原子+光纤腔+微波/射频/泵浦激光”联合驱动产生两种斯托克斯光子，那么各波长光子**具体时域形状**大概率是**带有拉曼散射和腔衰减特征的(双)指数衰减**，或者若做了特殊整形，也可能是更平滑的脉冲形态。但**纯天然情况下**，一般并不是简单的高斯。

------

## 4. 实验上如何区分或探测这两种波长？

该系统的“多模输出端口”可以用色散光栅、滤波器、单光子计数器等手段，把不同时长/不同频率的斯托克斯光子分别记录下来。从图 1(D) 也能看出他们对光子计数做了直方图统计来区分原子处于 $F=1$ 与 $F=2$ 时的读出差异。若再结合光谱或滤波，就可以把“780nm”和“810nm、850nm”等通道区分开。

------

### 小结

- **在图中这个特定高合作率($C>100$)的$\mathrm{^{87}Rb}$+光纤腔实验里，Rb原子确实会放出几种不同波长的斯托克斯光子**，对应着不同的拉曼或自发跃迁通道。
- **时域波形方面**，若不专门整形，则多半表现为**指数衰减(坏腔)\**或\**振荡叠加衰减(强耦合)**；若实验中对拉曼脉冲做了精细控制，也能得到近似高斯或双边对称的脉冲形状。
- 换言之，并不天然是高斯光，而通常更接近腔衰减/原子跃迁相结合形成的“类指数”或“指数叠加振荡”波包。这一点和前面所说的“一般腔QED自发辐射不会简单是高斯”相符。



Q:根据这个腔的形状以及光子要实现的应用来看，波包形状最有可能是3.1，3.2，3.3中的哪一种

A:从论文给出的参数来看（尤其是对空腔的同时拟合得到 $g\approx100\,\mathrm{MHz}$ 、$\kappa\approx65\,\mathrm{MHz}$ 且合作率 $C\approx 100$），可以判定他们处在**强耦合**区（至少不是“坏腔”极限）。这意味着原子与腔之间会有明显的真空拉比劈裂或拉比振荡特征。若并未专门对拉曼泵浦脉冲做“整形”（比如做 STIRAP 波形设计，得到时间上对称或高斯的单光子脉冲），则**更可能**出现的是“*带有拉比振荡或多指数特征*”的出射光子包络，也就是你列举的 **3.2** 那一类。

简言之：

- **3.1 单指数衰减** 典型于“坏腔极限”（$\kappa\gg g$），此处显然 $\kappa\approx 65$$<2g\approx200$\，并不成立；
- **3.2 强耦合振荡** 适用于本实验参量：合作率 $C>100$，$\,g>\kappa,\gamma$；若只做简单读出而不做时间整形，光子波包会表现为某种“拉比交换+衰减”的双指数或振荡衰减形状；
- **3.3 受控拉曼脉冲整形** 要看实验是否特意设计了驱动脉冲的时间包络；文中若无此描述，一般就不会得到纯高斯或对称波包，而是保持强耦合系统固有的“振荡/衰减”特征。

因此，对于图中这个具体的纤芯腔系统以及他们的读出/纠缠方案，最可能的波包形状就是**3.2** 所述的“*带有部分拉比振荡或双（多）指数衰减的强耦合辐射*”。

Q:带指数衰减，但我觉得指数衰减在描述后半段比较有效，但是从无波形（光子还没到达）到波形开始（光子强度达到指数衰减t=0时的强度）的这一段怎么描述比较好？直接跳变嘛？

A:在许多量子光学教材或文献里，当我们写出一个“指数衰减波包”

$\psi(t) \;=\; \sqrt{\Gamma}\,\Theta(t)\,\mathrm{e}^{-\tfrac12\,\Gamma t},$

（其中 $\Theta(t)$ 是 Heaviside 步进函数，保证 $t<0$ 时波包为零），表面上看确实会在 $t=0$ 处出现一个“从 0 到 $\sqrt{\Gamma}$”的突变。**这是一个常见的理想化处理**，以下从几个角度解释为什么这并不真的造成物理上的矛盾，以及实验中更精细的情况如何描述。

------

## 1. 理想化的“自发辐射 + 马尔可夫近似”导致的简化

在最经典的 Weisskopf-Wigner 模型或其类似的腔 QED 马尔可夫近似分析中，我们往往这样设定边界条件：

- $t<0$ 时，原子（或体系）尚未进入“辐射阶段”，或者说我们把“系统开始辐射的瞬间”定义为时间原点 $t=0$；
- $t \ge 0$ 时，系统以一个固定的衰减率 $\Gamma$ 连续演化，光场的振幅满足一阶线性方程，解是指数衰减。

这样就产生了**分段函数**：在 $t<0$ 没有辐射，在 $t\ge 0$ 是一个严格的指数衰减。**数学上**就会出现 “在 $t=0$ 处从 0 跳到某个有限振幅” 的不连续，这正是 $\Theta(t)$ 函数乘上指数所带来的。

> - **物理含义**：我们将“最初激发的时刻”或“触发辐射的时刻”定为 $t=0$。之前并不关心(或不记录)光子场，因为系统还处在“未放光”或“耦合尚未开启”的状态；之后则是指数衰减。
> - **是否真的“瞬间跳”**：严格来说，这个模型假设了一个“在马尔可夫近似下，辐射一旦开始，就满足这个简单指数律”的边界条件；它是一个“零时间尺度”切换的理想化。

在实验可分辨的时间尺度上（通常是 $1/\Gamma$、$1/g$、$1/\kappa$ 量级，纳秒或微秒不等），**这类“在$t=0$处分段”并不会导致可观测问题**。因为只要你把“$t=0$”定义成“已开始发射光子”的那一瞬，后面的实际强度(或概率幅)随时间变化基本就近似“指数衰减”。

------

## 2. 更完整的理论：不会真的出现无穷斜率

如果从**更完整的系统动力学**出发（例如在腔 QED 中解耦合方程、或在 Weisskopf-Wigner 模型中考虑原子与场的微分方程），那么在 $t=0$ 附近，光场是**连续**地从 0 增长到一个峰值，然后再衰减的。并不会真的出现“无限斜率的跳变”。只不过：

1. 这个“上升过程”通常在一个非常短的时间尺度内完成（可能是 Rabi 震荡周期的一小部分，或腔内光场建立时间 $\sim 1/\kappa$）。

2. 在**纯粹的二能级+无损耗+无失谐**等简单情况下，用马尔可夫近似做解析解时，会把这段极短的建立过程简化为“一瞬间”并设置为边界条件：

   ψ(t)={0,t<0,Γ e−12 Γt,t≥0.\psi(t)= \begin{cases} 0,& t<0,\\ \sqrt{\Gamma}\,\mathrm{e}^{-\tfrac12\,\Gamma t}, & t\ge0. \end{cases}

所以在真实的**数值求解**中，你若去解“原子(或三能级体系)+腔+初始激发”那组耦合动力学的微分方程，会看到在 $t=0$ 附近有一个**平滑的上升**，然后在后面的主导阶段近似指数衰减。**理论上并无真正的不可连续**。

------

## 3. 实验上通常只关心主要衰减区间

在实际测量里，我们常把“光子计数随时间的分布”做成一个时间直方图（binning，分辨率通常是纳秒量级或更粗）。对大多数原子发射或腔 QED 信号，这个**建立时间**通常要么非常短（小于探测分辨率），要么都被包含在“第一个时间 bin”里，几乎看不出所谓“突变”。图像上就是从某个瞬间开始衰减曲线。

因此，**从实验可见度**来说，“指数衰减的开始”看起来就像在某个时间 bin 后幅度很快达到一个相对最大值，随后随 $e^{-\Gamma t}$ 下降。大家往往干脆用一个 step $\Theta(t)$ 来表示这个过程，而不会构成冲突。

------

## 4. 若需要更精细的描述

1. **Rabi 震荡 + 腔建立时间**
   - 在强耦合腔 QED 场景中，如果 $\kappa$ 不算大，腔模要先建立/衰减，原子激发与腔光子之间还会振荡交换一段时间。这样就能看见实际的**上升与振荡**过程，而不再是“一步到位”。
   - 具体波包可通过输入-输出理论或主方程数值解来查看，常见到一个平滑的起始(甚至有第一个峰)、再衰减。
2. **脉冲驱动**
   - 若光子是通过拉曼脉冲产生，那么光子的振幅 $\psi(t)$ 会反映“泵浦脉冲$\Omega(t)$”和“体系耦合”的卷积。通常可以得到一个平滑的上升与下降，或者特意做成时间对称高斯等。
   - 这时更不会出现“瞬间起跳”，因为驱动$\Omega(t)$自身就是一个平滑函数。
3. **超短时间尺度下的非马尔可夫效应**
   - 真正极短时($\ll 1/\Gamma$)，可能存在场回馈、原子能级展宽、甚至真空场的非平坦谱密度等“非马尔可夫行为”，导致发射率在 $t=0$ 附近偏离单纯指数。只是在通常纳秒或更长尺度的实验里，这段偏离极小、极短，可忽略不计。

------

## 5. 小结

- **指数衰减中“t=0瞬间跳变”** 是马尔可夫近似或简化边界条件下的一种理想化表达，真实物理过程里会有一个非常短暂的平滑上升；但只要这个建立时间比主要衰减周期 $\sim 1/\Gamma$ 短得多，就足以近似为“从 0 到 指数衰减峰值 的瞬间过渡”。
- **实验上**因为时间分辨率有限，常把 $t=0$ 选为“发射开始”的时刻，对后续主衰减过程做测量，等效于看到了 $\Theta(t)\,e^{-\Gamma t/2}$。
- 若**想更精确**，则应回到完整的耦合动力学（如“原子+腔场+边界条件”的微分方程）或全量子输入-输出理论，会得到一个平滑且连续的起始过程，没有真正的无限斜率。

因此，并不是“真的一下子跳变”，而是**理论模型中把极短的上升阶段简化为一个边界条件**来写成“阶跃 $\Theta(t)$$\times$ 指数”，在时间分辨度有限的实验里非常好用，并不会导致矛盾。

Q:还有两个问题，第一个就是单激发子空间写成W_A + γexp(iϕ)W_B 这种写法给我的感觉就像是W_A和W_B不对称，但理论上二者应该保持对称的吧。 第二个就是，W_B可能有0和1两种取值不是嘛，如果W_B是0态，也就是腔里没有激发光子，那在分束器里貌似就变成了“有光子”和“没光子”的干涉，而且咱也是主要取一端有光子一端无光子只不过不知道是哪端是有光子的情况的，两端都有光子的情况由于正比于p方，所以这个值过小，几乎可以忽略。 但我们所说的γ好像是假设两端都有光子，然后用两个光子的波函数直接内积来计算出来的。我有点怀疑这个γ是否能用于“一腔有光子，一腔没光子”的主要的有效情况，这两种情况下的γ的值一样吗？但是为什么？

A:先把两个问题列出来，再逐条回答。

------

# 问题概述

1. **关于$\lvert W_A\rangle + \gamma e^{i\phi}\lvert W_B\rangle$中看起来“不对称”**
    “为什么会出现一个$\gamma$只乘在$\lvert W_B\rangle$上？这样看起来 $\lvert W_A\rangle$ 和 $\lvert W_B\rangle$ 好像不对等，是否破坏了二者对称性？”
2. **关于“B 可能是 0 或 1 光子激发”的疑惑**
   - 如果 B 没产生光子，就等于“真空态”跟 “有光子”在分束器里干涉吗？
   - 我们经常说 “$\gamma$ 来自‘两个光子波包的重叠积分’”，可在主要情形下，往往是“一边有光子、一边无光子”的单光子态，为什么还要用“两个波包的内积”来定义 $\gamma$ 呢？
   - “$\gamma$ 不是针对‘双光子事件’吗？若主要情形是一端出光子、另一端没出光子($p^2$ 太小就忽略)，那这个 $\gamma$ 还能用吗？”

简要回答在前：**(1)** 并不真的破坏对称性，$\gamma$ 体现的是“来自节点 A 的光子态”与“来自节点 B 的光子态”在探测/干涉时是否“难以区分”，如果 $\gamma=1$ 就完全对称、完全不可区分；如果 $\gamma<1$，则是部分重叠，不是说对 A、B 本身就不对等。
 **(2)** 在“单激发子空间”中，真正的干涉出现在“‘A 产生了1个光子’与 ‘B 产生了1个光子’”之间的量子叠加。而“B 没产生光子”($= \text{真空}$)并不和“A 出光子”产生什么量子干涉。“$\gamma$”正是衡量这两种单光子态(来自 A / 来自 B)在空间、时间、频率等模式上的**波包重叠**，并非一定要两端“都出光子”才计算的那个重叠。下面逐条详细解释。

------

# 1. $\lvert W_A\rangle + \gamma e^{i\phi}\lvert W_B\rangle$ 为什么“看起来不对称”？

在最简单的 DLCZ 或单激发编码中：

- $\lvert W_A\rangle$ 表示“节点 A 上有 1 个自旋(或原子)激发，B 没有”；
- $\lvert W_B\rangle$ 表示“节点 B 上有 1 个自旋激发，A 没有”。

如果两个节点在空间、驱动等所有条件都**完全相同**，我们期望 A、B *对称*。那为什么最后出现一个“$\gamma e^{i\phi}$”乘在 $\lvert W_B\rangle$ 上，似乎对 A、B 处理不一样？

### 1.1 其实是“光子波包”重叠系数在作祟

当我们说“$\lvert W_A\rangle + \gamma e^{i\phi}\lvert W_B\rangle$”，背后其实是把“原子激发”与“光子场激发”做了**一一对应**：

- “若节点 A 被激发”，则**放出光子**的形状是 $\lvert \psi_A\rangle$；
- “若节点 B 被激发”，则放出的光子形状是 $\lvert \psi_B\rangle$。

当这唯一的光子到达分束器后被“桶式探测(单击)”，我们无法区分究竟是哪个节点发射了光子，从而留下远程节点态的叠加——但这个叠加系数取决于 $\langle \psi_A|\psi_B\rangle$，也就是这两个单光子波包的**模式重叠**。这就是那个 $\gamma$.

- 若 $\gamma=1$（波包完全相同），则$\lvert \psi_A\rangle$ 和 $\lvert \psi_B\rangle$不可区分，于是 $\lvert W_A\rangle$ 与 $\lvert W_B\rangle$就**对称**地加起来。
- 若 $\gamma<1$，二者只部分重叠（或者有相对时延/频移等），就出现一个小于 1 的幅度系数乘在 $\lvert W_B\rangle$，表现为“从光子探测角度看，B 发的光子不完全和 A 发的光子叠加”。

所以，看起来“$\lvert W_A\rangle + \gamma e^{i\phi}\lvert W_B\rangle$”不对称，实际上**是反映光子在探测器端的可区分度**；并不是节点 A、B 本身有什么先天不对等。要是实验条件对称到让 $\gamma=1$，那就得到$\lvert W_A\rangle + e^{i\phi}\lvert W_B\rangle$完美对称形式。

------

# 2. “B=0 是真空，与 A=1 光子怎么干涉？” —— 何谓“单激发子空间”里的$\gamma$

在 DLCZ 或单光子干涉类协议里，一次“成功”的情形往往是：**系统只产生 1 份光子**（要么是 A 产生了，要么是 B 产生了，但不知道是哪一个），并最终在分束器检测到“单击”。我们将这称为“单激发事件”或“单光子事件”。相应地，“\lvert W_A\rangle\otimes\lvert \psi_A\rangle + \lvert W_B\rangle\otimes\lvert \psi_B\rangle)”即是此一子空间的振幅描述。

### 2.1 “没产生光子”=真空态，不与“1光子”发生量子干涉

- 如果 B **没有**产生光子，那就对应状态 $\lvert W_B=0\rangle \otimes \lvert 0_\text{photon}\rangle$。和 A 那边的“有光子”态 $\lvert W_A=1\rangle \otimes \lvert 1_\text{photon}\rangle$ 并不是在同一个“单光子”子空间里——它基本不会出现量子相长或相消的干涉。
- 真空和单光子态叠加虽可以想象（$\alpha\lvert 0\rangle + \beta\lvert 1\rangle$），但**在这里**我们只说**“若最终探测到1次点击”**，那就后选到“确实存在1光子”这条道上（不可能是$\lvert 0\rangle$）。因此，B=0 (真空) 的振幅在这个测量结果中**被排除**。

换言之，真正导致“单击”并留下远程纠缠的过程，是“要么由 A 发光子 + 探测到；要么由 B 发光子 + 探测到”。而**不是**“A 发光子 + B 不发光子”之间的什么相干——后者只是从**多次实验**的(概率)角度看“B 不发光子”更可能罢了，但在具体一次**成功**的后选条件下，我们只关心**单激发子空间**($\lvert W_A\rangle,\lvert W_B\rangle$)与对应的**单光子**($\lvert \psi_A\rangle,\lvert \psi_B\rangle$)。

### 2.2 “$\gamma$ 来自哪两个态的内积”？

- 并不是 “两个光子” 的内积；而是 “节点 A 发射的那一个光子波包” 与 “节点 B 发射的那一个光子波包” 之间的波包重叠。
- 在一次实验里，“只有 A 发射”或“只有 B 发射”，不会真的同时各有 1 光子并在 BS 上碰撞（那是“双光子”事件，概率 $\propto p^2$，若 $p\ll1$ 可以暂时不谈）。
- 但为了描述**量子干涉**，我们在幅度层面考虑“若光子来自 A”与“若光子来自 B”这两种振幅的相加，这时就要知道$\langle \psi_A|\psi_B\rangle = \gamma$。它衡量这两种单光子波包在探测器里是多大程度不可区分。

所以结论是：**$\gamma$** 确实是用来衡量**“单光子”态**的波包可区分度，而不是 “2 光子波函数” 的什么内积，也不是“真空 vs 单光子”的重叠。它正好适用于**主导的“一端出光子、另一端没出光子”**的情景，因为在振幅层面我们要把“A 出”与“B 出”叠加起来。

------

# 小结

1. **$\lvert W_A\rangle + \gamma e^{i\phi}\lvert W_B\rangle$ 不会违反 A、B 对称性**：
   - $\gamma$ 是“光子波包重叠”这个客观量：若系统条件完全对称，$\gamma=1$，那就完美对称；若因为时序/频率/路径不完美匹配，$\gamma<1$，则只是说明“B 发的光子和 A 发的光子不完全重叠”，并不意味着“节点 B”本身更低等。
2. **“B=0”($=$真空) 不会和“A=1 光子”干涉**：
   - 真正发生在单击测量时的干涉，是“光子来自 A” 和 “光子来自 B” 那两个振幅的相加。它们都是“单光子态”，只是在源头 (A 或 B) 不同。
   - “$\gamma$”就是那两个“单光子模式”之间的模式重叠，而**不是**来自 “两个光子态的内积”，也不是 “(真空)与(单光子)” 的内积。
   - 在一次测量后选出“有点击”时，真空(无光子)情形被排除了，所以不进入那次成功事件的叠加描述。
3. **$\gamma$ 仍然适用主导的单光子过程**：
   - 在 $\mathrm{p^2}$ 很小的极低激发概率极限下，主要就是单光子事件($\propto p$)。此时我们关心的正是 $\langle \psi_A|\psi_B\rangle$，也就正是 $\gamma$。
   - 若真的出现“双光子”事件(A、B 同时各发一个)，那是另一套分析(会出现 Hong–Ou–Mandel 效应等)。但那并不影响我们在“单光子后选”时用 $\gamma$ 描述不可区分度。

**因此**，并不存在矛盾：

- **(对问题1)** “$\gamma e^{i\phi}$”并不意味着对 A、B 物理地不对称，而是对波包可区分性的量化；若一切对称则 $\gamma=1$。
- **(对问题2)** “B=0 态”不参加干涉；真正的单激发干涉在“(A 发 1 光子)”与“(B 发 1 光子)”之间，故需要“这两个单光子态”的重叠$\gamma$，而不是算“有光子 vs 无光子”的内积。

Q:“(A 发 1 光子)”与“(B 发 1 光子)”是指“仅A发1光子”和“仅B发1光子”这两个事件嘛？但这两个事件貌似不像双光子事件中的那两个事件（“A发一光子被D1接受，B发一光子被D2接受”和“A发一光子被D2接受，B发一光子被D1接受”）那样具有全同性所以干涉。难道说这两个事件也可以干涉嘛？但这是为什么
A:在量子光学或量子信息的语境里，“$\text{A发1光子}$” 和 “$\text{B发1光子}$” 这两个事件虽然在直觉上像是“不同物理过程”，但只要**最终的探测结果无法区分究竟光子来自哪端**，它们就会在**振幅层面**发生量子相干叠加，从而产生“干涉”效应。也就是说，“A 发光子” 与 “B 发光子”**确实**可以发生“单光子级别”的干涉。下面分几点来解释其中的原理和区别。

------

## 1. “两个事件”在量子幅度层面要相加

### 1.1 单光子干涉：幅度的相加

在量子力学里，如果一个测量结果 (如“探测器点击一次”) 可能由**多个**互斥的“量子路径”导致，且**无法**在最终测量中区分到底是哪条路径发生了，那么这些路径对应的**概率振幅**就要相加，再求模方。由此产生**相长或相消**的干涉。

- 在**单激发**(单光子)场景下，“A 发 1 光子”对应一条路径，**或者**“B 发 1 光子”是另一条路径。
- 如果探测器只知道“有 1 个光子来了”，却**测不出**它究竟来自 A 还是 B，那么就得将这两种**振幅**$\,( \lvert \psi_A\rangle$ vs. $\lvert \psi_B\rangle )$做量子叠加。
- 只要$\langle \psi_A|\psi_B\rangle \neq 0$（两种波包部分或全部重叠），就可能出现干涉效果：在有些输出条件下出现**相长**，在另一些条件下出现**相消**。

这便是**“单光子也能自己跟自己产生干涉”**的根源——或者换个说法：这里的“自己”指的是“无法区分的两条发射路径所对应的量子振幅相加”。

### 1.2 你看到的“两个事件”是对实验者可见的“事后描述”

从经典直觉说，“要么 A 发光子，要么 B 发光子”，二者似乎不能“同时发生”，就觉得“不像双光子情形可真正‘碰撞’到一起”。但在量子描述中，对**一次测量**来说，“A 发光子”和“B 发光子”不是在经验上‘谁发生就排斥另一个’，而是在**探测前**是一个“(A 发 + B 发) / √2” 的可能性叠加。只有当你**真的去辨别光子出处**时(比如能测出‘是A那条通道射来的’)，叠加才会坍缩成单一分支；若实验无法区分，就要在振幅层面叠加。

------

## 2. 与“双光子干涉” (HOM 效应) 的区别

- **双光子干涉 (Hong–Ou–Mandel)**：
   这里有“同时来自 A、B 的两个光子”，进入分束器后可能表现出**二阶干涉**(振幅叠加发生在**两光子**过程层面)，典型现象是“两个全同光子倾向于束缚到同一输出端口”。
- **单光子干涉 (两端可能发光)**：
   现在只有**一个**光子。这个光子在“源头”层面有两个可能：来自 A 或来自 B。只要最终探测**不能**区分它源自哪端，就会有**一阶**(振幅)干涉现象。

二者都有“振幅相加并产生干涉”，但**干涉的阶数**、**探测器点击的类型**等并不一样：

1. **单光子情形**：一次单击就代表“检测到光子”；测量结果要在幅度层面将“光子来自A”与“光子来自B”相加。
2. **双光子情形**：有时会看“两个探测器同时点击 (coincidence)”的概率如何因两光子全同而被抑制或增强。

------

## 3. 为什么能“干涉”？要点是“探测器无法区分光子来自 A 还是 B”

在你所说的“双光子事件中( HOM 效应 )”，“A发+ B发”的两条‘路径’可以互换而无可区分，故在振幅层面有**相加**，产生量子相消或相长。但是**单光子情形**并不需要“两个光子撞在一起”才能干涉；它是**“一个光子、两种来源路径”**的干涉。

- 若此光子波包 $\lvert \psi_A\rangle$ 与 $\lvert \psi_B\rangle$ 在频率、时间、空间模式上**完全相同**($\gamma=1$)，则你绝无可能判定“它到底谁发的”，从而在测量中就必须**叠加**这两种振幅，这就带来**单光子干涉**。
- 若二者很不相同($\gamma \approx 0$)，探测器(或后续处理)**可以**区分它来自 A 还是 B，干涉效果就消失。

> 这和熟知的“迈克尔孙干涉仪”里单光子在两臂“要么走臂1，要么走臂2”的情况很像。只要没做“哪条臂被走了”的标记信息，光子在检测屏上就显示干涉条纹。这儿则是“要么由 A 发， 要么由 B 发”，检测端不可区分，就会在合束处(分束器)表现干涉。

------

## 4. 小结

- **“(A 发 1 光子)”与“(B 发 1 光子)”这两条‘事件’并非不能干涉**，只要最终**不区分**哪端发射，就要**将两条路径的幅度相加**，这就是**单光子干涉**的标准情形。
- 在**双光子干涉**(如 HOM 效应)里，我们同时有两个光子，一个来自 A 一个来自 B，并在 BS 上碰撞；那是**二阶**(双光子)的干涉现象。
- 当前讨论的 DLCZ / 单激发协议里，多数情况只有**一个**光子(成功 herald)，却可能来自 A 或 B。若它们在探测器处“不可区分”，那就出现“单光子级别”的相干叠加。
- **原理**：只要无法测定“光子究竟源自哪端”，并且两端发射的光子波包$\lvert\psi_A\rangle$、$\lvert\psi_B\rangle$有足够重叠($\gamma>0$)，就会产生一阶干涉。数学上就是把“来自A”的概率振幅与“来自B”的概率振幅**相加**，再求模方，出现正干涉或负干涉项。

> 因此，**这两个事件也是可以“干涉”的**，只是干涉的方式不同于“双光子碰撞”那种二阶干涉——它属于**“单光子、两路径”**的一阶干涉。实验上若调好时序/频谱，确能观测到由于$\gamma\neq 0$带来的量子相干效应。

下面给出一个**较为系统、细致**的思路描述，力求帮助你在实现基于**Monte Carlo Wave Function（MCWF）\**的量子轨迹模拟时，清楚地把握每一个步骤的\**具体操作**。整体分为**“总体思路”**与**“分步实现细节”**两大部分，篇幅较长，但希望能让你在真正动手写程序前，先有一个“从头到尾”的清晰蓝图。

------

## 一、总体思路概览

1. **目标/物理背景**
   - 你有两个远程的原子或原子系综（节点 A 和节点 B），每个节点都可能产生斯托克斯光子。它们的发射概率、发射时刻、波包形状等均受量子动力学和噪声影响。
   - 你希望**不忽略双光子或更多光子事件**，并且要考虑真实时域/频域波包的动态变化、腔衰减、振动、温度等各种扰动因素。
   - 最终想通过分束器上的干涉和探测（或某种光学测量）来判断纠缠生成的成功率、保真度，或量子隐形传态等指标。
2. **为什么用 MCWF**
   - MCWF（也称量子轨迹或量子跳法）能够把原本的“主方程演化”（对密度矩阵）转化为一系列**随机演化**（对纯态矢量）的计算；在每条轨迹中，系统会随着随机跳跃（量子跃迁、光子发射、探测点击等）一步步演化。
   - 一条轨迹可以被自然理解为**一次具体的实验测量过程**的量子结果。
   - 通过重复采样大量轨迹，就能统计出与真实实验相符的概率分布、平均值、相关函数等。
3. **核心流程**
   - **初始化**：设定两个节点 A、B 的初态（可能都在基态，也可能有一定激发概率），以及光场/谐振腔/环境等的状态。
   - **单次轨迹随机演化**：
     1. 按照主方程中定义的哈密顿量和 Lindblad 路径（自发辐射、损耗、退相干等），每个时间步或事件驱动下，系统态发生无跳跃演化或随机跃迁；
     2. 记录在该轨迹里，什么时候节点 A 发了光子，什么时候节点 B 发了光子，光子以何种形状输出……
   - **轨迹结束**：得到本次模拟的“最终测量记录”——比如说“A 共发射了 k 个光子，B 发射了 m 个”，乃至“哪个时刻跳跃发生”等。
   - **重复许多条轨迹**，并在每条轨迹结束后，将那些输出的光子波包数据或者探测器点击信息进行统计或后处理。
   - **后处理**：例如在每条轨迹中，根据“（A 发射的光子波包）和（B 发射的光子波包）”的重叠程度 $\gamma$ 来计算分束器干涉效率，再统计所有轨迹的平均干涉可见度、纠缠保真度等。
4. **两种关键数据：**
   - **系统态随时间的演化**：主要是指 A、B 原子（或腔）内部的量子态。
   - **光子波包**：当发生一次跃迁（量子跳）代表“系统向外场放射了一个光子”，你需要对该光子在时域或频域上的包络做记录，并在最终（或中途）进行合并、干涉、探测建模。
5. **最终结果**
   - 每条轨迹可视为一次完整实验；你要统计上千甚至上万条轨迹，得到“光子检测率”“保真度分布”“双光子污染”等宏观指标。
   - 若需要更精细的分析（如时域相关函数 g(2)），也能通过轨迹中的跃迁时序来推算。

------

## 二、分步实现细节

下面分成**模型构建**、**MCWF 轨迹过程**、**光子波包记录/处理**、**后处理与统计**、**一些技术要点**等几大部分，按逻辑顺序展开。

------

### 1. 模型构建

1. **定义系统哈密顿量**
   - 写下两个节点 A、B 的内部能级结构（例如，两能级原子或三能级 $\Lambda$ 系统），以及与泵浦激光/腔场的耦合项。
   - 如果你有光纤腔，记得包含“原子-腔耦合 $\hat{H}_{\mathrm{int}}$”以及“腔模频率、失谐”之类。
   - 对远程耦合可以先不显式，或者只当作每个节点向独立的“输出通道”中辐射（反正它们在大距离情况下不会直接耦合，只是光子最后在分束器上相遇）。
2. **定义 Lindblad（散射）算符**
   - 主方程中的耗散、退相干路径：
     - **自发辐射**：节点 A 或 B 的自发衰减算符 $\hat{L}_{A},\hat{L}_{B}$；
     - **腔衰减**：若有腔模，需要腔泄露算符 $\hat{L}_{\kappa}$；
     - **退相干**：如原子相位散逸、跃迁间解耦等。
   - 每个 Lindblad 项都包含相应的跃迁几率、衰减率 $\Gamma$ 或 $\kappa$，以及相应的跳跃对系统态的作用。
3. **光场模式表征**
   - 若你要显式跟踪“输出光子波包”，可以在MCWF的“量子跳”里做一个标记：当原子从 $\ket{e}$ 跳到 $\ket{g}$ 时，就生成一个光子（对该跳跃路径来说）。
   - 也可用输入-输出理论：腔/原子向外场释放一个波包。
   - 重要的是，你需要一种**方法**来把“每次跃迁”跟“输出光子在时域/频域的包络”对应起来，并记录它。
4. **初始条件**
   - 一般假设 A、B 处在基态（或少量混合态），腔场在真空态，无外部光子。
   - 也可能已为 A、B 准备好某种初始纠缠（具体看你的物理场景）。

此阶段主要是搭建好**系统的微观动力学**：哈密顿量 + Lindblad 路径。

------

### 2. MCWF 轨迹过程

MCWF 在数值上一般有两种实现思路：**(a) 步进式时间离散**，或 **(b) 事件驱动/下一次跳跃时刻的随机抽样**。以下给出一种常用的**时间步进式**介绍，事件驱动也类似：

1. **时间步循环**

   - 设定一个总模拟时长 $T_{\mathrm{max}}$，以及一个时间步长 $\Delta t$。每一时刻 $t_n = n \cdot \Delta t$，你计算系统在这一小步内的无跳演化 + 可能的跳跃事件。
   - $\Delta t$ 应该远小于主要动力学时间尺度（比如自发辐射寿命、腔衰减时间）；过大会损失精确度，过小又会导致计算量暴涨。

2. **无跳演化（non-jump evolution）**

   - 在每个时步，用有效哈密顿量（H - i/2 $\sum L_j^\dagger L_j$）对纯态做一次**短时演化**。可以用龙格库塔、指数欧拉等方法解决。
   - 这一步会给你一个“暂时的新态矢量”，记为 $\ket{\psi_{\mathrm{temp}}(t_n)}$。

3. **随机跃迁**

   - 计算各个 Lindblad 路径的跃迁概率。例如，如果你有 Lindblad 算符 $\hat{L}_j$，在本时间步的概率大致是

     pj  ≈  Δt ⟨ψtemp∣L^j†L^j∣ψtemp⟩.  p_j \;\approx\; \Delta t \,\langle \psi_{\mathrm{temp}} | \hat{L}_j^\dagger \hat{L}_j | \psi_{\mathrm{temp}} \rangle.

   - 用随机数决定：在这个时间步，是否跳跃？跳到哪条路径 j？

     - 若发生跳跃，系统态就 $\ket{\psi_{\mathrm{temp}}} \to \hat{L}_j \ket{\psi_{\mathrm{temp}}}$，再归一化。
     - 记下“哪条路径 j 在何时刻发生跃迁”。假如 j 代表“节点 A 发光子”，那你就把这一次光子产生记录下来。

4. **更新系统态**

   - 如果在这时步无跳跃发生，就把 $\ket{\psi_{\mathrm{temp}}}$ 作为本时步结束态 $\ket{\psi(t_n+\Delta t)}$。
   - 如果发生跳跃，就把 “跳后态” 作为本时步结束态。
   - 进入下一个时步 $t_{n+1}$ 继续循环。

5. **轨迹结束判定**

   - 当 $t$ 超过 $T_{\mathrm{max}}$ 或系统达到某个稳定态，你就可以停止本次轨迹。
   - 将轨迹过程中发生的所有“跃迁事件”（例如多少次 A→B？多少次腔光子泄露？……）存储下来。

> **这一套走下来**，就得到**一条轨迹**的完整时域记录：包括系统态随时间的演化曲线、每一次量子跳的时刻与类型。

------

### 3. 光子波包的记录与处理

在上面第 2.3 步中，只知道“某个时刻 t，某条 Lindblad 路径 $\hat{L}_j$ 发射了一个光子”，但你想进一步**获得“光子在时域/频域的波包形状”**，通常可做以下处理：

1. **小步逼近**
   - 在量子光学输入-输出理论中，“单光子发射”可以对应一段函数形状。例如若系统在$\ket{e}$ 状态，以速率 $\Gamma$ 辐射一个光子，则其幅度在理想单指数情况下是 $\psi(t) \sim e^{-\Gamma(t-t_0)/2}$.
   - 但是在MCWF中，跃迁往往发生在随机时刻 $t_0$，且受腔失谐、Rabi 震荡等影响形状不一定简单。
   - 一种思路是：**将发射过程的动态演化（从上一次跳到这一次跳）视为塑造光子包络的阶段**。可结合解析或数值来近似得到该光子的包络函数。
2. **事件驱动写法（更自然）**
   - 另一种更自然做法：在“下一次跃迁时刻”被抽中时，可以从系统态的微分方程解出“输出场”随时间演化的映射关系，得到一段“发射波包”。
   - 这需要对输入-输出方程比较熟悉：$\hat{a}_{\mathrm{out}}(t)= \sqrt{\kappa}\,\hat{a}(t) - \dots$ 之类公式，结合系统态，就能得到外场的幅度。
   - 这样，每当发生一次“发射跃迁”，你就把对应时段的场振幅数据存入一个列表，称为本光子的波包。
3. **多光子**
   - 当你不忽略双光子或多光子事件，就意味着**在同一条轨迹里**，可能先后（甚至同时）出现多个跃迁。你要分别给每个跃迁贴上一个“光子 ID”，并记录它的时域包络（或是幅度）。
   - 如果某些跃迁近乎同时，就要在**后处理**时区分“是同一端发了两个光子”还是“一端各发一个”等，以便在分束器干涉时做正确区分。
4. **简化记录**
   - 如果你关心最终只要光子到达分束器时的“不可区分度 $\gamma$”，也许只需要在轨迹里把每个光子最后得到一个简化表征，如中心时刻、中心频率、脉冲宽度、相对相位等。
   - 也可以用离散采样：对波包离散成若干时间点（或频率点），存成向量 $\{\psi(t_k)\}$，最后和 B 端光子向量做内积就得 $\gamma$.

------

### 4. 后处理：干涉与探测统计

1. **合并 A、B 两端光子**
   - 每条轨迹结束后，你会知道：该轨迹下，A 端发了多少光子、在什么时刻发射、波包是啥样；B 端同理。
   - 如果**两端各发光子**发生的概率并不小，你就需要把这些光子送到**分束器**做线性光学变换，然后再看探测器点击的概率或发生时刻。
2. **分束器干涉**
   - 可用解析的线性光学公式：对两个光子波包 $\ket{\psi_A}, \ket{\psi_B}$ 进行 50:50 BS 变换，并然后计算“单击 / 双击”探测器事件的幅度。
   - 若探测器是桶式，“无法区分多光子”，则发生多光子束缚 (bunching) 事件时，你要相应地看哪些轨迹最后会在检测器看到1次点击却有2个光子的叠加，这会影响纠缠保真度。
   - 也可以**在 MCWF 中直接包含分束器 + 检测器**(不过数值量会更大)，更常见是**后处理**。
3. **量子态投影**
   - 若你的目标是“herald 远程纠缠”，就需要看**探测器点击**是否出现，以及出现在哪个组合（D1 / D2 / 双击 / 单击等）。
   - 你可把光子场和探测器测量算符写成一个投影 $\hat{M}$，对“(A 发光子) + (B 发光子)”态做投影得到远程自旋(原子)态，并计算保真度。
   - 这可在每条轨迹的光子输出后进行一个**概率计算**：看本条轨迹最终有没有成功 herald？保真度是多少？
4. **统计大量轨迹**
   - 把上面的测量结果(点击或不点击、成功或失败、保真度多少)收集起来，最终输出**成功率**、**纠缠保真度分布**、**g(2)函数**等。
   - 如果你要时间分辨，也可以看在多少轨迹中，光子在 2~3µs 时间窗内出现发射等等。

------

### 5. 一些技术要点/建议

1. **数据结构**
   - 你可能需要一个**轨迹记录对象**，里面存：
     - `list_of_jumps = [(t1, channel1), (t2, channel2), ...]`
     - `wavepackets_info = [(photonID, times, amplitudes), ...]`
     - 这样在轨迹结束后，你就能对这些跳跃/光子数据做后处理。
2. **效率与截断**
   - MCWF 对大的希尔伯特空间依然耗时：你要确定原子/腔/光子数的**可行截断**。
   - 如果$p$ 不太大，其实多光子事件不会很多；如果真的很多，你要想办法优化数据结构或用 GPU 并行。
3. **轨迹数**
   - 你要采样多少条轨迹才足以收敛？通常**数千到数万**不等，看系统规模和所需精度。可以做先期测试看标准差是否收敛。
4. **时间步长**
   - 要兼顾动力学精度和数值开销。可考虑自适应步长 or 事件驱动法（即一次 jump 出现后直接跳到 jump 时刻）。事件驱动 often 更快更精确，因为不会在大量无事可做的时段浪费时间步。
5. **如何区分同一端多光子 vs. A、B 各发光子**
   - 这是后处理里要做的逻辑：如果轨迹里出现了 2 次“同一个节点 A 的发射跃迁”，就说明**A 端发了2个光子**。
   - 若轨迹同时出现 A 端 1 次跃迁 + B 端 1 次跃迁，则说明**两端各发了1个**。
   - 结合到分束器时，需要看**是哪个光子在什么时刻到达**，做叠加。
   - 这样就可以真实地反映多光子事件对保真度或探测率的影响。
6. **排错**
   - MCWF 路径有许多随机要素，编程调试时建议先做一些简单极限例子：
     - 如仅有一个原子 + 无腔 + 单自发衰减，看发射光子的时序是否跟解析的指数分布吻合。
     - 先不考虑双光子，测试结果与传统解析近似p$\ll1$时相符。
   - 逐步再加上腔、加上多光子、加上分束器后处理，以免一次全部上阵难以排错。
7. **统计输出**
   - 你最终需要什么结果？
     - 例如：“分束器单击率 $\to$ 量子纠缠保真度 $\to$ 传态极限”。
   - 规划好**在每条轨迹结束时**如何把信息**累加**到一个全局统计器，然后在“所有轨迹都跑完”时一次性做平均/做分布。

------

## 三、一个示范性的小例子串联

为了让思路更形象，这里给出一段“示范性”的简化流程，串联前面所有关键点（不涉及具体算符，仅展示逻辑）：

1. **初始化**

   - `system_state = ket([A_g, B_g], no_photon_in_cavity)` （两个节点都在基态，无光子）
   - `time = 0.0; dt = (some small step); T_max = something`
   - `trajectory_data = []` (空列表，存放jump信息)

2. **时间步循环**（或事件驱动）

   - while (time < T_max):

     1. 计算无跳演化：

        ∣ψtemp⟩←exp⁡[−i(Heff)dt]∣ψ(time)⟩  \ket{\psi_{\mathrm{temp}}} \leftarrow \exp\bigl[-i(H_{\mathrm{eff}}) dt \bigr]\ket{\psi(time)}

        并归一化或保持到足够精度。

     2. 对每个Lindblad算符$L_j$，算 $\Delta p_j = dt * \langle \psi_{\mathrm{temp}} | L_j^\dagger L_j | \psi_{\mathrm{temp}} \rangle$。

     3. 用随机数r~Uniform(0,1)决定是否发生跳跃：

        - if r < sum($\Delta p_j$)，找出对应的 j，执行：

          ∣ψafter⟩=Lj∣ψtemp⟩∥⋅∥  \ket{\psi_{\mathrm{after}}} = \frac{L_j \ket{\psi_{\mathrm{temp}}}}{\|\cdot\|}

          并记录 `trajectory_data.append( (time, j) )`
           这意味着在时刻time发生了 j 类型的“光子发射”或“损耗”过程。

        - else 无跳。

     4. `system_state = \ket{\psi_{\mathrm{after}}}`

     5. `time += dt`

3. **轨迹结束**

   - 解析 `trajectory_data`，看看 A 端发射了几次（j 对应A自发通道），B 端发射了几次（对应B自发通道）。
   - 若模拟腔情况，就查看腔泄露通道等；若要输出光子波包，可在每次jump后根据系统态 / input-output 关系写出一段脉冲形状。
   - 形成 `(list_of_photons_A, list_of_photons_B)` 以及其波包信息。

4. **后处理：**

   - 根据该轨迹中的光子数据：
     - 如果A,B各只发了1个光子，算出这两个光子到达分束器时的 overlap $\gamma$，再算出探测器点击概率 / EPR保真度等。
     - 如果A发了2个光子+ B没发，则那就是“同端多光子事件”。
     - …重复统计各种情形。
   - 把这些结果累计到全局计数器/分布里。

5. **重复N条轨迹**

   - 每条轨迹都可能出现不同的跳跃序列、不同发射时刻、不同$\gamma$。
   - N条跑完后，输出“(A发1,B发1) 占比多少”、“(A发2,B发0) 占比多少”、“最终纠缠保真度平均值多少” 等等。

------

## 四、总结

- **MCWF/量子轨迹方法**：一条轨迹=一次实验，通过随机跳决定何时哪条Lindblad通道发生，从而非常自然地还原了量子测量中的不确定性与各种概率性。
- **不忽略双光子**：在这种模拟里，只要你对系统可容纳的激发/光子数不做苛刻截断，并把所有相关 Lindblad 路径(包括多次激发)都纳入，就能在轨迹里自然而然地产生多光子事件。你只需在轨迹记录中识别即可。
- **干涉与探测**：大多数情况下把分束器/探测器的过程当作**后处理**(线性光学 + 投影测量)即可，免得在MCWF主方程中还要再把探测器纳入量子系统，会极其庞大。
- **统计分析**：由于一条轨迹只能代表一次“实验结果”，要对外可观测的概率分布做统计，需要上千乃至上万条轨迹才能收敛。你就把所有轨迹的后处理结果汇总平均，得到最终模拟预测值。

这样，你就能把**各种噪声**（腔振动、时延、退相干）融入系统主方程/Lindblad描述，用MCWF逐条轨迹“真实地”生成光子发射与探测事件。整个流程会比简单解析公式更繁琐，但一旦实现，能在**复杂或强耦合、多光子**场景下给出非常逼真的模拟结果。

------

**希望上述思路能为你在实现前提供**从理论框架、数据结构、算法流程到后处理的**“千字级”全景指引**。具体程序代码如何组织，会依赖你所用的编程语言、数值库（Python/C++/Julia等）以及你对哈密顿量和跃迁算符的矩阵形式设置。但只要抓住上述“大结构”，你就能分步骤拆解、验证，逐渐完成这套MCWF+光子干涉的全量子数值模拟。祝你研究与实现顺利!





在**大多数“DLCZ 式”或“单激发编码”\**的场景下，我们\**确实常常只关心“每个节点一次只发射至多一个光子”**，比如节点 A 发射 1 个光子、或者节点 B 发射 1 个光子（也可能都没发射）；一旦出现多光子事件，大多会被当作杂质或者被忽略（若概率够低）。因此，**在理想、低激发概率 ($p\ll1$) 的极简模型**中，常用一对简单记号就能描述这个过程，例如“$\ket{W_A}\ket{\psi_A}$ + \ket{W_B}\ket{\psi_B})”，不需要再额外对光子做什么编号。

不过，这取决于你的**具体物理需求**和**模拟精度**，主要分两种情况：

------

## 1. 如果你“严格只想保留一次只发 1 个光子”的理想简化

- 在许多基础文献中，或者在实际实验里把激发概率 $p$ 调得非常低 ($p \approx 0.01$ 或更小)，就足以确保“多光子概率 $p^2$ 微乎其微”，从而**可以**把每个节点“每次只产生 0 个或 1 个光子”作为**近似**。
- 这时，对整个过程只需区分“光子来自 A”还是“光子来自 B”就行；若题目设定“(A,B)都只发一次”，那更是显而易见：**A 不会连发两次**，B 也不会。
- 在这样的假设下，你当然不需要另用 $k,m$ 这类下标去描述光子数：因为**最多**就是“一端 1 光子”，写成“$ \ket{\psi_A}$”或“$ \ket{\psi_B}$”就够了。并且在探测器看到的单击，也只可能是“来自 A 还是来自 B”两条路径的干涉。

**结论**：

> 如果你明确知道或假设“每端一次只发射一个光子”，那就不必用 $k,m$ 来标记额外的多光子。**不需要**区分“第 1 个光子”和“第 2 个光子”，因为根本不会出现多个光子。

------

## 2. 如果你“要允许多光子事件或多次发射”

在更一般、或更精细的数值模拟中，有时要考虑：

1. **节点 A（或 B）在同一次激发脉冲中可能意外地产生 2 个甚至更多光子**
   - 当激发概率 $p$ 并不极小（例如 $p\approx0.1$），或者原子在某个时间内可以反复被激发、再自发回到基态后再次激发，都会导致同一端**多次光子发射**的可能性。
   - 例如在 MCWF（量子轨迹）模拟里，如果系统在一条轨迹中发生了多次“原子→基态”跃迁，那就相当于发射了多份光子。
2. **你不想把这些多光子当作噪声彻底忽略**
   - 可能多光子事件对你的纠缠保真度或探测统计有显著影响(例如桶式探测器分辨不出双光子，与单光子事件混淆)。
   - 这就要求在**记录或模拟**时，确切知道**哪一次跃迁**产生了**第几**个光子、它的时域波包是哪一个，等等。

在这种情况下，如果**单个节点**(A 或 B)会在一轮实验里产生**不止 1 个**光子，就自然需要一些记号 (例如 $k=1,2$) 来标记这些光子。这样你才能在后处理时区分：

- “光子 1 (A 端) 与 光子 1 (B 端) 的干涉”
- “光子 2 (A 端) 其实跟 B 端那边迟到的光子波包也可能重叠”
- ……

否则你就没法区分它们时域上的先后次序，也无法在分束器处正确合并。

**结论**：

> 如果要**保留多光子过程**（同一端重复发射），就必须给这些光子加编号 (k,m,...)，好让你在后处理干涉或探测时区分“第 k 个光子”与“第 (k+1) 个光子”。

------

### 小结

- **若你明确只想要一次只发一个光子**（典型的低 $p$ DLCZ 场景），那么对每个节点给光子编指数 $k,m$ 就没有必要。因为一次事件里“A” 最多发 1 个，“B” 也最多发 1 个，合起来就俩光子(或者更少)，你可以直接称“光子来自 A”与“光子来自 B”了。
- **若你允许并模拟多光子** (同一节点可能发多次) 或多回合发射，那么就需要在数值/概念上对**每个光子的“身份”\**做某种标记 (k,m)，这样你才能后续做\**分束器干涉**或**光子计数**等解析。

**简言之**：

> - $\boxed{\text{在一次只发一个光子的极简模式下，无需对光子编号。}}$
> - $\boxed{\text{如果要模拟多光子，多次发射场景，就需要标记光子序号以区分。}}$

看你自己对**物理模型**和**模拟精度**的设定来决定。通常在文献里，$p\ll 1$ 时都不显式编号，多光子当作极小概率；想深入研究多光子杂质影响时才会给光子编号并在数值里详细追踪。



下面给出一个“从头到尾”的**详细算法与公式**说明，展示如何在“两个仅截断到一阶光子的腔”中制备并后选出EPR纠缠对，同时在中性原子量子计算体系（如铷 Rb 或铯 Cs 原子）中实现所需的量子门与隐形传态操作。为兼顾可读性与“公式越多越好”的需求，文档分为若干步骤，每一步都给出必要的符号、算符及近似关系；在最后也加入如何“保留并计算噪声”“评估单光子激发概率 $p$、波包重叠 $\gamma$”等扩展性细节。**不输出具体代码**，而是以偏数学、偏流程的方式呈现。

------

# 目录

1. **物理体系与能级结构**
2. **腔场与原子状态的截断：$\lvert 0\rangle,\lvert 1\rangle$**
3. **EPR 对制备方案（两腔 + 单光子干涉 / DLCZ 类思路）**
4. **中性原子量子计算门实现（含 Rydberg 态）**
5. **隐形传态流程与门序列**
6. **概率扩展：$p$、$\gamma$ 的计算与后选**
7. **噪声与退相干仿真（主方程 / Lindblad）**
8. **综合模拟算法步骤（Monte Carlo Wave Function / 或事件驱动）**

------

## 1. 物理体系与能级结构

选择以铷（$^{87}\mathrm{Rb}$）或铯（$^{133}\mathrm{Cs}$）为例。其原子内部典型包含下述能级，用于可编程的量子比特操作：

- **两个基态**：$\lvert g_0\rangle, \lvert g_1\rangle$ —— 可以是不同的超精细态，例如 $\lvert F=1,m_F=0\rangle$ 与 $\lvert F=2,m_F=0\rangle$ （以 Rb 为例）。在量子计算中通常用它们承载量子比特。
- **两个激发态**：$\lvert e_1\rangle, \lvert e_2\rangle$ —— 分别对应不同的光学跃迁（如 D2 线的两个特定超精细态 $F'=1$ 和 $F'=2$，或者铯的 $6P_{3/2}$ 不同 $F'$）。可在光学上耦合到基态，用于发射 / 吸收腔光子。
- **一个里德堡态**：$\lvert r\rangle$ —— 在中性原子量子计算中常用 Rydberg Blockade / Rabi 机制来实现速率较快的受控门（CNOT、CZ 等）。

> **注**：在下文门操作部分，会用到 $\lvert r\rangle$ 来执行受控相位操作。对 EPR 对的制备，也可能需要原子和腔的拉曼过程。

------

## 2. 腔场与原子状态的截断：$\lvert 0\rangle,\lvert 1\rangle$

**设有两个光学腔**：记它们为 **腔 A** 与 **腔 B**。每个腔仅保留 **0 或 1 个光子** 的子空间：

$\lvert 0\rangle_{\text{cav}_i} \quad(\text{空腔}),  \quad  \lvert 1\rangle_{\text{cav}_i} \quad(\text{单光子}).$

对于每个腔 $i\in\{A,B\}$，可将希尔伯特空间截断为 $\mathrm{span}\{\lvert0\rangle,\lvert1\rangle\}$.

将腔与各自原子相耦合：若节点 A（含原子 A 与腔 A）处于某个激发态 $\lvert e\rangle$ 并与腔模式共振或近似共振，则可能**发射 1 个光子**到腔中，态变为 $\lvert g\rangle\otimes\lvert1\rangle_{\text{cav}_A}$；反之也可吸收。
 为简洁，记原子 A 与其腔的合成态如：

$\lvert g,\,0\rangle_A,\;\lvert e,\,0\rangle_A,\;\lvert g,\,1\rangle_A,\;\lvert e,\,1\rangle_A,$

并类似定义 B 端。

------

## 3. EPR 对制备方案（两腔 + 单光子干涉 / DLCZ 类思路）

### 3.1 典型过程概述

1. **各自以小概率 $p$ 激发**：在一次激光脉冲下，节点 A 或 B 的原子分别以概率 $p \ll 1$ 跃迁并产生 **单个光子** 到腔模式中（或等效地：自旋激发 + Stokes 光子被引出）。
2. **光子输出 & 干涉**：把腔 A 与腔 B 的光子通过光纤或波导耦合到一个 **50:50 分束器(BS)** 上，若探测器在分束器输出端检测到“**单击**”，就宣称在远程原子间留下一对纠缠（EPR）——这是和 DLCZ 协议类似的“测量触发纠缠”。
3. **只保留单激发子空间**：若同时两端都发了光子，会出现“双光子”事件；在强干涉(对齐)下它们可能束缚跑同一端口，被误判成“单击”，导致纠缠纯度下降；若两光子部分可区分，则双击计数率变大。故需优化 $\gamma$（光子模式重叠）与 $p$ 来平衡成功率与保真度。

### 3.2 量子态表示

假设一次激发脉冲结束后，忽略多光子大于 1 的事件，可写成（$\eta$等损耗先略去）：

$\lvert \Psi \rangle_{\text{AB}}  \simeq  \sqrt{1-p}\,\lvert 0\rangle_A \lvert 0\rangle_B \;+\; \sqrt{p}\,\lvert 1\rangle_A \lvert 0\rangle_B \;+\; e^{i\phi}\sqrt{p}\,\lvert 0\rangle_A \lvert 1\rangle_B,$

其中 $\lvert 1\rangle_A\equiv \lvert g,1\rangle_A$ 表示节点 A 发了光子（或自旋激发 + 腔光子），$\phi$ 是相对相位。若探测器只看到一次点击，则状态坍缩到

$\lvert \psi_{\text{EPR}}\rangle  \;\propto\; \lvert 1\rangle_A \lvert 0\rangle_B \;+\; \gamma\, e^{i\phi}\,\lvert 0\rangle_A \lvert 1\rangle_B,$

这里 $\gamma$ 表示两光子波包的不可分辨性因子（对齐度）；$\gamma=1$ 时是理想对称 Bell 态。

### 3.3 腔 A、B 各截断到 $\lvert 0\rangle,\lvert 1\rangle$ 的海森堡或主方程

若要数值求解，可写出类似的主方程

$\frac{d\rho}{dt} = -i\bigl[H_{\text{sys}},\,\rho\bigr] \;+\; \kappa\,\mathcal{D}[a_A]\rho \;+\; \kappa\,\mathcal{D}[a_B]\rho \;+\;\dots$

其中 $\kappa$ 是腔衰减率，$a_A$ 与 $a_B$ 为腔场的光子湮灭算符（在$\lvert0\rangle,\lvert1\rangle$子空间可视为保利矩阵类似的作用），$\mathcal{D}[L]\rho = L\rho L^\dagger-\tfrac12\{L^\dagger L,\rho\}$.
 再配合抽运脉冲或拉曼耦合实现单光子产生过程，最后在输出端相干叠加。

------

## 4. 中性原子量子计算门实现（含 Rydberg 态）

### 4.1 基态比特 $\lvert g_0\rangle,\lvert g_1\rangle$

将原子的量子比特编码在两个基态：

$\lvert 0 \rangle_q := \lvert g_0\rangle,\quad \lvert 1 \rangle_q := \lvert g_1\rangle.$

若需要在同一个节点内做单比特门，可用两光子拉曼耦合或微波跃迁实现

$U_{\text{single-qubit}}(\theta,\varphi)  = \begin{pmatrix} \cos(\theta/2) & -e^{i\varphi}\sin(\theta/2) \\ e^{-i\varphi}\sin(\theta/2) & \cos(\theta/2) \end{pmatrix}.$

### 4.2 Rydberg 慕制的受控门（C$_Z$ 或 CNOT）

令 $\lvert r\rangle$ 是 Rydberg 态。对于两原子 $(1,2)$ 相距可实现 Rydberg Blockade：若任意一颗原子进入 $\lvert r\rangle$，另一颗原子不能被同时激发到 $\lvert r\rangle$（能级位移很大）。

- **典型 CZ 门协议**：
  1. 若控制量子比特 = $\lvert 1\rangle$，则用脉冲 $\lvert 1\rangle \leftrightarrow \lvert r\rangle$ 把其提到里德堡态 $\lvert r\rangle$。
  2. 对目标比特做一个 $\pi$脉冲尝试 $\lvert 0\rangle \to \lvert r\rangle$，但若控制已经在 $\lvert r\rangle$，则能级位移使该跃迁无法进行。
  3. 再把控制从 $\lvert r\rangle$ 拉回 $\lvert 1\rangle$。
      整体效果：只有控制=$\lvert0\rangle$时，目标成功翻转 $\lvert 0\rangle \to \lvert r\rangle\to \lvert 0\rangle$ 并积攒一额外相位 $(-1)$；或若控制=$\lvert1\rangle$则阻塞；细节取决于具体脉冲设定。
- 若要做 CNOT，也可先加/减单比特旋转把 CZ 变换成 CNOT。

------

## 5. 隐形传态流程与门序列

假设我们已经在“两个腔 + 原子体系”里制备到一对远程 EPR 对 $\lvert \Phi^+\rangle_{AB}$（节点 A 与节点 B 各持一份），现在要执行**标准隐形传态**。其量子线路常见形式：

1. 令待传态的量子态在本地另一个比特 $\lvert \psi\rangle_{in}$。
2. 让 $\lvert \psi\rangle_{in}$ 与 EPR 对的 A 端做 Bell 基测量（需要做 CNOT + Hadamard + 2-qubit 测量），得到 2 比特经典输出 $(m_1,m_2)$。
3. 将 $(m_1,m_2)$ 发送到 B 端，对 B 的量子比特做相应的 Pauli 校正 $X^{m_1}Z^{m_2}$。
4. 完成隐形传态。

在具体中性原子体系里，这些**单比特门**(Hadamard、Pauli) 与 **两比特门**(CNOT) 都可用上节之 Rydberg 块特性做。

- **Hadamard** = R$_y$($\pi/2$) + 相位移
- **CNOT(A->B)** = 用 CZ + 单比特变换拼出。

------

## 6. 概率扩展：$p$、$\gamma$ 的计算与后选

### 6.1 单光子发射概率 $p$

若每个节点抽运脉冲幅度很弱，造成“单激发”概率为 $p\ll1$。常用以下近似：

$p \approx \int_0^\tau \Gamma_{\mathrm{eff}}(t)\, dt \quad (\text{若发射速率是 }\Gamma_{\mathrm{eff}})$

或可以视为激光诱导拉曼跃迁概率。“$\tau$”是脉冲时间尺度；调节激光强度就能使 $p\approx 0.01\sim 0.1$ 不等。

### 6.2 光子波包重叠 $\gamma$

假设两个单光子脉冲在到达分束器时的包络分别为 $\psi_A(t)$ 与 $\psi_B(t)$，其归一化满足 $\int |\psi_A(t)|^2 dt=1$ 等，则

$\gamma = \langle \psi_A \mid \psi_B\rangle = \int \psi_A^*(t)\,\psi_B(t)\,dt.$

- $\gamma=1$ 表示两脉冲完美对齐（时间、频率、偏振都不可区分）。
- $\gamma=0$ 表示两脉冲完全可区分。

若只后选“单击”事件，不分光子数，则 $\gamma$ 影响误判率及纠缠保真度：

$F(\text{EPR})  \approx  \frac{ \alpha(\gamma)\,(1+|\gamma|)^2 }{ 2\,\bigl(1 + |\gamma|^2\bigr) } \quad\text{(见先前推导)},$

其中 $\alpha(\gamma)$ 代表单、双光子事件在“单击”中所占比例。

### 6.3 Herald 成功后选

实验上只当探测到**有且仅有一个探测器点击**时，才认为EPR成功。多光子事件要么导致双击，要么束缚在同一端口被误报，会降低保真度。可用

$P_{\text{SC}}(\gamma)  = p(2-p)  + \frac{p^2}{2}[1+|\gamma|^2]$

之类公式（简化了损耗与探测效率）估算成功率；再从中得到后选态保真度。

------

## 7. 噪声与退相干仿真（主方程 / Lindblad）

若要考虑**现实噪声**，包括：

1. **原子自发衰减**：$\Gamma_e$ 从激发态 $\lvert e\rangle \to \lvert g\rangle$
2. **腔衰减**：$\kappa$
3. **里德堡态有限寿命**：$\Gamma_r$
4. **失谐 / 抖动**：$\Delta\omega$ 分布；相位噪声
5. **退相干**：如基态 $\lvert g_0\rangle$ 与 $\lvert g_1\rangle$ 之间的相位去相干率 $\Gamma_{2}$

可在**主方程**（LME）或**量子跳**（MCWF）里加上对应的散射项 $\mathcal{D}[L_i]$. 例如：

$\frac{d\rho}{dt} = -i\bigl[H_{\mathrm{full}},\,\rho\bigr] \;+\; \sum_j \Gamma_j \,\mathcal{D}[L_j]\rho,$

各 $L_j$ 对应不同的耗散通道。

- 举例：$\mathcal{D}[\sigma^-_e]$ 代表原子从 $\lvert e\rangle$ 到 $\lvert g\rangle$ 的自发跃迁，$\mathcal{D}[a]$ 代表腔的光子泄漏等。
- 这样就能在数值或解析近似中体现**噪声对 EPR 对制备、隐形传态保真度的影响**。

------

## 8. 综合模拟算法步骤（Monte Carlo Wave Function / 或事件驱动）

最后给出一个完整的**详细步骤**，将前述所有要点结合到一个可执行的数值/理论流程中。以 MCWF（量子轨迹）为例，过程如下：

------

### **8.1 建立系统与模型**

1. **定义截断空间**：

   - 腔 A、B 各用 $\{\lvert0\rangle,\lvert1\rangle\}$
   - 原子各能级 $\{\lvert g_0\rangle,\lvert g_1\rangle,\lvert e_1\rangle,\lvert e_2\rangle,\lvert r\rangle\}$
   - 对每个节点，组合形成 $\dim = 2_{\text{cav}}\times 5_{\text{atom}}$ 的子空间(若要再截断则另行减少)。
   - 对两个节点 + 腔 全局空间再做张量积。

2. **写出哈密顿量**:

   Hfull=HA+HB+Hint+Hdrive,H_{\mathrm{full}} = H_{A} + H_{B} + H_{\text{int}} + H_{\text{drive}},

   其中 $H_{A}$ 包含(原子能级 + 腔)在 A 端，$H_{\text{int}}$ 表示腔-原子或激光-原子偶极耦合等。

3. **列出 Lindblad 路径**:

   {L^j}={κ aA,  κ aB,  Γe σe,A−,  Γe σe,B−,  … }\{\hat{L}_j\} = \bigl\{  \sqrt{\kappa}\,a_A,\; \sqrt{\kappa}\,a_B,\; \sqrt{\Gamma_e}\,\sigma^-_{e,A},\; \sqrt{\Gamma_e}\,\sigma^-_{e,B},\; \dots \bigr\}

   还包括基态去相干等，如 $\sqrt{\Gamma_2}\,\lvert g_0\rangle\langle g_0| - \lvert g_1\rangle\langle g_1|$ 之类的算符。

------

### **8.2 生成 EPR 对（单光子干涉）**

1. **从初态 $\lvert g_0,0\rangle_{A}\otimes \lvert g_0,0\rangle_{B}$** 出发。
2. **施加一次弱激发脉冲**(时长 $\tau$)：在主方程或 MCWF 中，把拉曼/共振抽运项 $H_{\text{drive}}$ 打开，使得每个节点以小概率 $p$ 产生 1 光子。
3. **演化到 $t=\tau$**:
   - 在 MCWF 里，每条轨迹可能：
     - 无跳(未发光子)；
     - A 端发了一个光子(时间$t_A$)；
     - B 端发了一个光子(时间$t_B$)；
     - 或者两端都发(概率 $\sim p^2$).
4. **输出光子到分束器**:
   - 记录/模拟光子波包$\psi_A(t),\psi_B(t)$，计算 $\gamma=\int\psi_A^*(t)\psi_B(t)dt$。
   - 在分束器后加两个探测器(桶式)
   - 发生“单击 / 双击”
   - **后选**只要“单击” => 认为制备到远程 EPR，对应原子态被投影到 $\lvert \psi_{\text{EPR}}\rangle$.
5. **统计保真度**: 对多条轨迹做平均；或者在理论上用 $\alpha(\gamma)$ + “双光子束缚”来算保真度。

------

### **8.3 在各节点上做中性原子门操作**

1. **对每个节点**，我们已经有一个量子比特 $\lvert g_0\rangle,\lvert g_1\rangle$（或在 EPR 对制备成功后变成某个纠缠态）。
2. 需要做：单比特旋转 / CNOT / 测量 … 全部可以用“Rydberg 阻塞 + 光学脉冲”实现，如上节 4 所述。
3. 若要执行**隐形传态**：
   - 在 A 端把待传态态 $\lvert \psi\rangle$ 与 EPR(A) 做 Bell 测量：CNOT(A->in) + Hadamard(in) +测量。
   - 将测量到 $(m_1,m_2)$ 经典比特送往 B 端，对 B 端 EPR 量子比特做 $(X^{m_1}Z^{m_2})$ 校正。
   - MCWF 中可直接在纯态上实现这些门算符；或者在主方程里“硬编码”相应的哈密顿序列。
4. 最后得到传输到 B 端的 $\lvert \psi\rangle$ 并可统计保真度。

------

### **8.4 噪声与误差**

- 在每个时间段，每次激光脉冲或等待过程中，主方程 $\dot\rho=\dots$ 都包含前述 $\{\hat{L}_j\}$ 耗散算符。
- 在量子轨迹(跳跃)模拟中，任何时刻都可能随机触发一个 $\hat{L}_j$ 导致衰减或相位破坏，必须将该轨迹的系统态更新。
- 周而复始，对大量轨迹做统计，即可得 EPR 对或隐形传态在噪声下的成功率、保真度分布。

------

### **8.5 结束 & 输出指标**

- **EPR 保真度** $F_{\mathrm{EPR}}$ vs. 各参数($p,\gamma,\kappa,\Gamma_e,\dots$)
- **隐形传态保真度** $F_{\mathrm{tele}}$
- **成功率** $P_{\mathrm{SC}}$
- **平均光子数 / 多光子污染**
- **门操作保真度**(受里德堡衰减、激光相位噪声等影响)

在实验或更大规模数值仿真中，会根据以上流程反复扫描不同激光功率、腔失谐、原子-腔耦合强度 $g$ 等，找到最优工作点。

------

## （附）简要公式概览

为便于阅读，将前文用到的重要公式列表化：

1. **(单光子发射概率)**

   p=∫0τΓeff(t) dt.p = \int_0^\tau \Gamma_{\mathrm{eff}}(t)\,dt.

2. **(波包重叠)**

   γ=⟨ψA∣ψB⟩=∫ψA∗(t)ψB(t) dt.\gamma = \langle \psi_A|\psi_B\rangle = \int \psi_A^*(t)\psi_B(t)\,dt.

3. **(分束器后一阶干涉，单击后 EPR 保真度近似)**

   F(γ)≈(1+∣γ∣)22 (1+∣γ∣2)×α(γ),α(γ)=2p(1−p)2p(1−p)+12 p2 (1+∣γ∣2).F(\gamma)  \approx \frac{ (1+|\gamma|)^2 }{2\,(1+|\gamma|^2)}\times \alpha(\gamma), \quad \alpha(\gamma) = \frac{2p(1-p)}{2p(1-p)+\tfrac12\,p^2\,\bigl(1+|\gamma|^2\bigr)}.

4. **(腔 + 原子 + 噪声 主方程)**

   dρdt=− i [Hsys, ρ]  +  ∑jΓj D[Lj]ρ.\frac{d\rho}{dt} = -\,i\,[H_{\mathrm{sys}},\,\rho] \;+\; \sum_j \Gamma_j\,\mathcal{D}[L_j]\rho.

5. **(Ryberg 受控相 门)**

   CZ:∣11⟩↦eiϕ∣11⟩,(其他不变)\mathrm{CZ} : \lvert 11\rangle \mapsto e^{i\phi}\lvert 11\rangle,\quad \text{(其他不变)}

   具体由脉冲序列 $\lvert1\rangle \leftrightarrow \lvert r\rangle$ + Blockade 实现。

以上数学关系就构成了**本方案**里最核心的理论支柱。

------

# 总结

通过以上分步骤的“偏数学”流程，可以：

1. **在两个仅截断到单光子的腔**中，利用弱抽运 + 分束器干涉 + 单击探测的机制制备 EPR 纠缠对；
2. **在中性原子（Rb 或 Cs）系统**中，通过 Rydberg Blockade 完成所需的量子门（如单比特旋转、CNOT/CZ），进而执行隐形传态；
3. 通过**公式**($p,\gamma$) 控制单光子事件的成功率与保真度，并用**Lindblad / 主方程**或**MCWF**量子轨迹方法来包含各种噪声效应。

此一完整流程就构成**“两腔 EPR + 原子门 + 噪声仿真 + 扩展到隐形传态”**的详细算法模型。若需要数值实现，可将该流程翻译为具体的 Python/C++/Julia 等程序，但从原理上，以上数学表达已经足以指导如何逐步搭建与运行整套模拟。



Q：
"""
├── main.py                      # 主入口点，协调DLCZ模拟流程和UI启动
├── config.py                    # 全局配置和物理参数设置
├── requirements.txt             # 项目依赖包列表
├── core/                        # 核心量子系统和求解引擎
│   ├── quantum_state.py         # 量子态表示与希尔伯特空间管理
│   ├── system_state.py          # 系统状态类定义与管理
│   ├── cavity.py                # 腔系统和光场表示
│   ├── lindblad_solver.py       # Lindblad主方程求解器
│   ├── time_evolution.py        # 时间演化控制器
│   ├── noise_models.py          # 噪声模型实现
│   └── entanglement.py          # 纠缠度量和分析
├── physics/                     # 物理过程模型
│   ├── atomic_process.py        # 原子系统过程与计算
│   ├── laser_field.py           # 激光场计算
│   ├── fiber_coupling.py        # 光纤耦合计算
│   ├── photon_process.py        # 光子发射与探测模型
│   └── detectors.py             # 光子探测器与探测事件模拟
├── protocols/                   # 量子协议实现
│   ├── two_cavity_epr.py         # 双腔epr制备协议主实现 
│   ├── initialization.py        # 量子态初始化
│   ├── quantum_teleport.py      # 量子隐形传态协议实现
│   ├── write_read.py            # 写入与读取过程
│   └── storage.py               # 量子存储过程
├── utils/                       # 工具函数和辅助模块
│   ├── run_simulation.py        # 仿真流程控制与整合器
│   ├── visualization.py         # 数据可视化工具
│   ├── ui.py                    # 用户界面组件
│   └── metrics.py               # 性能指标计算
├── docs/                        # 文档和调试信息
│   └── ...                      # 各种文档和说明
└── results/                     # 结果存储目录
"""
所以帮我想想这个和光子有关的单次计算γ值以便得到本次两系统耦合程度的仿真（而且还要和MCWF过程的“产生1光子”事件完美对接的）该在哪个文件里实现，文件里有几个函数，函数名都是什么（这次同样不是写代码而是尽可能在函数要实现的功能的介绍里详细地阐述公式）


A:下面给出一个**推荐的实现方案**，用于在**单光子产生（MCWF量子跳）\**的过程中，计算并返回“\*\*单次计算的 $\gamma$ 值\*\*”——也即我们往往称为“\*\*两路单光子波包（或模式）之间的重叠程度\*\*”。本方案着眼于与您现有的文件结构相适配，并且给出\**函数的名称、所在文件**以及**它们要做什么、用到哪些公式**的较为详细说明。我们**不**编写具体代码，而是说明函数的数学功能和接口设计。

------

# 1. 文件位置与整体思路

在您给出的架构里，**最合适放置**这类“**单光子波包与重叠积分**”的逻辑，往往是

- **`photon_process.py`**（因为该文件就是“光子发射与探测模型”的核心），
- 以及**和 MCWF 跳跃事件对接**时需要在 **`time_evolution.py`** 或 **`lindblad_solver.py`** 里安排相应的“时刻调用”或“回调函数”。

因此，**推荐做法**是：在 **`photon_process.py`** 里定义几个主要函数，比如：

1. **`retrieve_single_photon_wavefunction(...)`**

   - 负责从“MCWF轨迹”或“薛定谔态演化”中提取单光子在自由场/输出通道中的时域波函数 $\psi(t)$。
   - 如果您有**离散时间步**的模拟，也会在此函数中把离散数据转换为可积分的序列。

2. **`compute_mode_overlap(waveA, waveB, ...)`**

   - 给定两条**时间离散或函数式**的单光子波包 $\psi_A(t)$ 和 $\psi_B(t)$，做

     γ  =  ∫ψA∗(t) ψB(t) dt\gamma \;=\; \int \psi_A^*(t)\,\psi_B(t)\,dt

     的计算（可以是离散求和逼近积分）。

   - 这样就能返回本次事件/本次轨迹下所得到的“不可区分度”$\gamma$。

3. **（可选）`update_results_with_gamma(gamma_value, event_time, ...)`**

   - 在**同一文件**或**另一个辅助工具**中，把算出的$\gamma$存入 **`results/`** 目录下某个数据文件，以便后续 `metrics.py` 或 `visualization.py` 调用。
   - 您也可以直接在 `time_evolution.py` / `run_simulation.py` 中执行写入操作——根据喜好决定。

在**与 MCWF** 的衔接上，常见做法是在**某次量子跳（检测到“单光子出射”）**发生时，您就调用 `retrieve_single_photon_wavefunction(...)` 来获取那次跳跃对应的波包信息，再与另一端波包做 `compute_mode_overlap(...)`，最终得到 $\gamma$ 并保存或做协议判断。

------

# 2. 在 `photon_process.py` 中添加的函数

下面罗列**函数名称**及其**核心功能**说明，并穿插**公式**，以达到“文档式”说明的效果。

------

## 2.1 `retrieve_single_photon_wavefunction(mcwf_trajectory, time_array, ...) -> np.ndarray`

**功能概述**

- 从一次 MCWF 量子跳模拟（`mcwf_trajectory`）中，提取**在输出通道**（或自由光场模式）里的单光子时域振幅数据。
- 假设在模拟中，我们对输出场算符（如 `b(k)` 或时域模式 `b_out(t)`) 有一段**记录**，或在跳跃发生后我们重构出“该次光子事件的波函数”。
- 返回一个与 `time_array` 对应的复数数组 `wavefunction[]`，表示 $\psi(t)$ 的离散化值。

**数学细节**

1. 在论文如 Utsugi 等人的(7)式中，单光子对输出模式的幅度可以记为

   αk  =  κexπ∫−∞tαg(t′)e− i k (t−t′) dt′,\alpha_k \;=\; \sqrt{\frac{\kappa_{\mathrm{ex}}}{\pi}}   \int_{-\infty}^{t} \alpha_g(t^\prime) e^{-\,i\,k\,(t - t^\prime)} \, dt^\prime,

   但在MCWF数值中，常常是**时域**直接采样 $\psi(t)$。

2. 若时域离散为 $\{t_i\}$，我们可以在**跳跃**(单光子发射)后提取 “$\alpha_{\mathrm{out}}(t_i)$” 或“ $\alpha_g(t_i)$ 与耦合公式” 得到输出波包。

3. 函数返回：

   ```python
   # 伪定义
   return wavefunction  # shape = (len(time_array), ) of complex
   ```

**关键公式**（离散化场景）

$\psi_{\mathrm{out}}(t_j) \;\approx\; \sum_i \Bigl[\text{some MCWF amplitude at step } i\Bigr] \times \delta_{j,i},$

或以更细致的方式进行卷积/积分，还可能因探测器效率等做修正。

------

## 2.2 `compute_mode_overlap(waveA, waveB, time_array, ...) -> float`

**功能概述**

- 给定两条同样在 `time_array` 上离散的波包 `waveA[]`、`waveB[]`，计算它们的内积

  γoverlap  =  ∫ψA∗(t) ψB(t) dt\gamma_{\text{overlap}} \;=\; \int \psi_A^*(t)\,\psi_B(t)\, dt

  或在离散中做

  γ≈∑j Δt  ψA∗(tj) ψB(tj),  \gamma  \approx  \sum_{j}\,\Delta t\;\psi_A^*(t_j)\,\psi_B(t_j),

  其中 $\Delta t$ 是 `time_array` 连续点之间的时间步长。

**核心公式**

- 连续情况下：

  γoverlap  =  ∫tstarttendψA∗(t) ψB(t) dt.\gamma_{\text{overlap}} \;=\; \int_{t_{\mathrm{start}}}^{t_{\mathrm{end}}} \psi_A^*(t)\,\psi_B(t)\,dt.

- 离散化：

  γoverlap  ≈  ∑j=0N−1ψA∗(tj) ψB(tj) Δt.\gamma_{\text{overlap}} \;\approx\; \sum_{j=0}^{N-1}  \psi_A^*(t_j)\,\psi_B(t_j)\,\Delta t.

  需保证二者在**同一时间网格**或做插值。

**函数内具体说明**：

```python
def compute_mode_overlap(waveA, waveB, time_array):
    """
    计算两条离散波包 waveA(t) & waveB(t) 的内积 (overlap).
    输入:
      waveA, waveB: 1D复数数组,长度=len(time_array)
      time_array: 1D实数数组,表示t坐标
    输出:
      float类型的 overlap gamma
    公式:
       gamma = Sum_j [ waveA^*(j)*waveB(j)*dt ]
    """
    ...
    return gamma
```

------

## 2.3 （可选）`update_results_with_gamma(gamma_val, event_time, path="results/gamma_data.csv", ...) -> None`

**功能概述**

- 用于将本次$\gamma$的计算结果写入**外部文件**，例如 `results/gamma_data.csv`，或者 JSON / HDF5 格式。
- 里面可附带 `event_time` (MCWF 中量子跳发生的物理时间) 和 其它标识(如轨迹ID, photonID, nodeA/B标识等)。

**备注**

- 也可以放到 `utils/metrics.py` 里，不过如果是**与单光子发射过程强绑定**，放在 `photon_process.py` 也合情合理。
- 若你希望**统一由 `run_simulation.py`** 做文件写入，也可以在这里仅返回一个字典，然后 `run_simulation.py` 再写盘。

------

# 3. 与 MCWF 跳跃事件对接

典型地，您会在**`time_evolution.py`** 或 **`lindblad_solver.py`** 里管理 MCWF 过程。当发生一次“单光子发射”跳跃时（比如某个 Lindblad 通道 $\hat{L}_{\mathrm{photon}}$ 触发），就可以执行类似：

```python
# Pseudocode in time_evolution.py or lindblad_solver.py
if jump_channel == "photon_out":
    # 1. 提取本次单光子波函数
    wave = photon_process.retrieve_single_photon_wavefunction(
        mcwf_trajectory, time_array, ...
    )
    
    # 2. 如果要跟另一端波包 waveB 比对, 可以先 also get waveB
    waveB = photon_process.retrieve_single_photon_wavefunction(
        mcwf_trajectory_B, time_array, ...
    )

    # 3. 计算重叠
    gamma_val = photon_process.compute_mode_overlap(wave, waveB, time_array)

    # 4. 记录结果
    photon_process.update_results_with_gamma(gamma_val, current_time)
```

这样就**完成了单次$\gamma$值的计算**与记录。

------

# 4. 总体示例

因此，最后在 `photon_process.py` 里，就可以这样放：

```python
####################### photon_process.py #########################

def retrieve_single_photon_wavefunction(mcwf_trajectory, time_array, ...):
    """
    基于MCWF轨迹信息, 提取/重建本次(或最近一次)单光子发射的时域波函数.
    公式参考:
       alpha_g(t) 或输出场 b_out(t)
    返回 shape=(len(time_array),) 的 复数 numpy数组 wave(t).
    """
    ...

def compute_mode_overlap(waveA, waveB, time_array):
    """
    计算两单光子波包在 time_array 上的重叠积分:
       gamma = ∫ waveA^*(t) waveB(t) dt
    其中离散实现:
       gamma ~ sum_j waveA^*(t_j)*waveB(t_j)*Delta_t
    """
    ...

def update_results_with_gamma(gamma_val, event_time, file_path="results/gamma_record.csv"):
    """
    把算出的 gamma 值(以及本次跳跃时间)写进文件/数据库.
    或者只组装info dict后交给run_simulation.py写都可以.
    """
    ...
```

这样**在别的部分**(如 `time_evolution.py`)中只需：

1. 在**量子跳**(单光子发射)回调或检测时：先 `retrieve_single_photon_wavefunction(...)`
2. 若要与另一端的波包算重叠，就另外调一次 `retrieve_single_photon_wavefunction`(对另一端)
3. `compute_mode_overlap(...)` 得到$\gamma$
4. `update_results_with_gamma(gamma, ...)`

------

# 5. 公式写进函数注释的范例

如果您希望在函数DocString内**阐述公式**，可以如:

```python
def compute_mode_overlap(waveA, waveB, time_array):
    """
    计算两单光子波包 waveA(t), waveB(t) 的重叠积分 gamma:
    
      gamma = ∫ waveA^*(t) waveB(t) dt
    
    在离散 form 下, 记 time_array = {t_j}, 步长 dt = t_{j+1} - t_j, 则
    
      gamma ~ Σ_{j=0 to N-1} waveA^*(t_j) waveB(t_j) dt
    
    waveA, waveB : shape = (N,)
    time_array   : shape = (N,)
    
    返回:
      float, 表示 [0,1]内的重叠大小(若已归一化).
    """
    ...
    return gamma
```

------

## 6. 总结

- **放置文件**：`photon_process.py` 是最佳地点，因为它正是“光子发射与探测模型”模块。
- **关键函数**：
  1. `retrieve_single_photon_wavefunction(...)`：从MCWF或演化结果中获取(或重构)单光子波包。
  2. `compute_mode_overlap(...)`：实现核心公式 $\gamma=\int \psi_A^*(t)\psi_B(t)dt$。
  3. (可选)`update_results_with_gamma(...)`：将 $\gamma$ 写出到外部数据文件。
- **与MCWF过程对接**：在 `time_evolution.py` / `lindblad_solver.py` 监听**单光子发射**跳跃事件，调用上述函数完成**单次 $\gamma$ 计算**并存储。

这套方案就能**在一次次 MCWF 量子跳**发生时，**动态计算**该次发射的单光子波包重叠度 $\gamma$，评估系统耦合或不可区分性程度，并与后续协议（如 EPR制备、两腔干涉等）相结合。



# 程序运行逻辑概述

core核心文件概述

# 目录

1. [**`quantum_state.py`**](#quantum_statepy)  
   - 1.1 [\(\text{init_hilbert_space}(...)\)](#111-init_hilbert_space)  
   - 1.2 [\(\text{set_density_matrix}(...)\)](#112-set_density_matrix)  
   - 1.3 [\(\text{get_density_matrix}()\)](#113-get_density_matrix)  
   - 1.4 [\(\text{update_density_matrix_unitary}(...)\)](#114-update_density_matrix_unitary)  
   - 1.5 [\(\text{register_parameter}(...)\)](#115-register_parameter)  
   - 1.6 [\(\text{get_parameter}(...)\)](#116-get_parameter)

2. [**`system_state.py`**](#system_statepy)  
   - 2.1 [\(\text{record_frame}(...)\)](#21-record_frame)  
   - 2.2 [\(\text{dump_to_file}(...)\)](#22-dump_to_file)  
   - 2.3 [\(\text{load_from_file}(...)\)](#23-load_from_file)

3. [**`cavity.py`**](#cavitypy)  
   - 3.1 [\(\text{generate_single_photon_wavefunction}(...)\)](#31-generate_single_photon_wavefunction)  **← 在这里细化了波包建模**  
   - 3.2 [\(\text{compute_photon_overlap}(...)\)](#32-compute_photon_overlap)  
   - 3.3 [\(\text{get_cavity_operators}(...)\)](#33-get_cavity_operators)

4. [**`lindblad_solver.py`**](#lindblad_solverpy)  
   - 4.1 [\(\text{solve_master_equation}(...)\)](#41-solve_master_equation)  
   - 4.2 [\(\text{run_mcwf}(...)\)](#42-run_mcwf)  
   - 4.3 [\(\text{apply_quantum_jump}(...)\)](#43-apply_quantum_jump)

5. [**`time_evolution.py`**](#time_evolutionpy)  
   - 5.1 [\(\text{run_epr_generation_process}(...)\)](#51-run_epr_generation_process)  
   - 5.2 [\(\text{handle_photon_detection}(...)\)](#52-handle_photon_detection)  
   - 5.3 [\(\text{run_teleportation_protocol}(...)\)](#53-run_teleportation_protocol)

6. [**`noise_models.py`**](#noise_modelspy)  
   - 6.1 [\(\text{build_cavity_loss_operator}(...)\)](#61-build_cavity_loss_operator)  
   - 6.2 [\(\text{build_spontaneous_decay_operator}(...)\)](#62-build_spontaneous_decay_operator)  
   - 6.3 [\(\text{generate_random_detuning}(...)\)](#63-generate_random_detuning)

---

## `quantum_state.py`

### 1.1 `init_hilbert_space(dims: List[int]) -> None`
**目的**：初始化一个或多个子系统的Hilbert空间维度，并内部记录它们的直积结构。  
**公式/流程**：

1. 假设有各子系统维度：\(\{d_1, d_2, \dots, d_n\}\)。  
2. 总维数： 
   \[
     D_{\mathrm{total}} = \prod_{j=1}^n d_j.
   \]
3. 在内部存储：  
   - `self.subsystem_dims = dims`,  
   - `self.total_dim = D_{\mathrm{total}}`.

----

### 1.2 `set_density_matrix(rho: np.ndarray) -> None`
**目的**：将当前全局密度矩阵设为\rho( \(D_{\text{total}}\times D_{\text{total}}\) )。  
**公式**：
\[
  \rho_{\mathrm{global}} \;\leftarrow\; \rho.
\]
要求\(\rho\)符合:  
\[
  \rho \succeq 0,\quad \mathrm{Tr}(\rho)=1,\quad \dim(\rho)=D_{\mathrm{total}}.
\]

----

### 1.3 `get_density_matrix() -> np.ndarray`
**目的**：读取并返回当前\(\rho_{\mathrm{global}}\)。  
**公式**：
\[
  \rho = \rho_{\mathrm{global}}.
\]
(无额外公式)

----

### 1.4 `update_density_matrix_unitary(U: np.ndarray) -> None`
**目的**：对\(\rho_{\mathrm{global}}\)施加幺正算符\(U\)，得到新的\(\rho\)。  
**公式**：
\[
  \rho_{\mathrm{global}} \;\leftarrow\; U\,\rho_{\mathrm{global}}\,U^\dagger.
\]
其中\(U\)大小为\(\dim(U)=D_{\mathrm{total}}\times D_{\mathrm{total}}\)。  
如果是对某子系统做操作，需要先构造\(\mathbb{I}\otimes U_{\mathrm{sub}}\otimes \dots\)等直积幺正。

----

### 1.5 `register_parameter(key: str, value: float) -> None`
**目的**：允许存储一些关键物理/仿真参数，比如：  
\(\tau\)（波包长度）、\(p(t)\)（某时刻激发概率）、\(\gamma\)等。  

----

### 1.6 `get_parameter(key: str) -> float`
**目的**：读取先前登记的参数值，**常用于**在别处需要如 \(\gamma\) 时，能随时调用。  

---

## `system_state.py`

### 2.1 `record_frame(rho: np.ndarray, t: float, extras: dict) -> None`
**目的**：将\(\rho\)在时间\(t\)时的状态以及其他辅助数据(extras)记录下来。  
**公式/流程**：  
1. 先检查\(\dim(\rho)\)，应与当前 Hilbert space 一致。  
2. 在内部的 `frames` 列表中追加：  
   \[
     \text{frames}.append\Bigl(\{\rho, t, \text{extras}\}\Bigr).
   \]

----

### 2.2 `dump_to_file(filename: str) -> None`
**目的**：把 `frames` 所包含的 `(rho, t, extras)` 等信息序列化存到外部文件。例如 JSON/HDF5/pickle。  
（无显式公式，主要是IO操作）

----

### 2.3 `load_from_file(filename: str) -> None`
**目的**：从文件中读回先前的 `frames`，恢复历史演化记录。  
（同样是IO，没更多公式）

---

## `cavity.py`

### 3.1 `generate_single_photon_wavefunction(kappa: float, t_range: np.ndarray, drive_profile: Callable, tau: float, shape='exponential', ...) -> np.ndarray`
**目的**：  
1. 在给定衰减率 \(\kappa\)、时间网格 `t_range`（如从 0 到若干倍 \(\tau\)）、以及激光驱动/抽运参数(通过 `drive_profile(t)` 表示)的情况下，生成一个**单光子时域波包** \(\psi(t)\)。  
2. 同时，允许**指定**或**自动计算**一个波包长度 \(\tau\)，以体现**在实验中调控**原子-腔耦合、腔衰减、或者激光脉冲形状等后得到的出射光波包宽度。

-----

**更详细的“波包长度 \(\tau\)” 模型示例**：

1. **指数衰减型**（常见于坏腔极限或者简化自发辐射到单模中）  
   \[
     \psi_{\mathrm{exp}}(t) = \Theta(t-t_0)\,\sqrt{\frac{2}{\tau}}\,\exp\Bigl[-\frac{(t-t_0)}{\tau}\Bigr],
   \]
   其中 \(\tau = \frac{1}{\kappa}\) 或与 \(\frac{1}{\Gamma}\) 相当，\(\Theta(\cdot)\)是Heaviside阶跃函数，保证 \(t<t_0\) 时波包为0。  
   - 归一化系数：\(\int_{t_0}^\infty \bigl|\psi(t)\bigr|^2 dt =1\) 需要 \(\sqrt{2/\tau}\)。  
   - 物理解释：\(\tau\) 即典型衰减时间，与\(\kappa\)成反比。

2. **高斯型**（可通过外部整形激光或严格的 STIRAP 设计做对称波包）  
   \[
     \psi_{\mathrm{gauss}}(t) = \frac{1}{(2\pi\sigma^2)^{1/4}} \exp\Bigl[-\frac{(t - t_0)^2}{4\sigma^2}\Bigr].
   \]
   一般令**波包长度** \(\tau \approx \mathrm{FWHM}\) 或 \(\mathrm{FWHM} \approx 2\sqrt{2\ln2}\,\sigma\)。也可令 \(\tau = 2\sigma\sqrt{2}\), 视定义而定。  

3. **由驱动方程计算**（考虑腔衰减 + 拉曼泵浦）  
   \[
     \frac{d}{dt}\psi(t) \;=\; -\frac{\kappa}{2}\psi(t)\;+\; \Omega(t).
   \]
   若 \(\Omega(t)\)本身有高斯脉冲形状(半宽度\(\tau\))，则解出来的\(\psi(t)\)亦呈近似高斯或稍有不对称上/下沿；可通过数值积分在 `t_range` 上离散求解。

-----

**在函数内部**大致实现流程（示例）：  
1. 从 `shape` 参数判断选择**指数**/ **高斯**/ **自定义**；  
2. 若 `shape='exponential'`, 则  
   \[
     \tau = 1/\kappa\quad (\text{或手动指定}),
     \quad
     \psi(t)= \sqrt{\tfrac{2}{\tau}}\exp[-(t-t_0)/\tau]\,\Theta(t-t_0).
   \]
3. 若 `shape='gaussian'`, 则  
   \[
     \psi(t)= \frac{1}{(2\pi\sigma^2)^{1/4}} \exp\Bigl[-\frac{(t - t_0)^2}{4\sigma^2}\Bigr],
     \quad \text{其中 }\tau\approx \text{FWHM or }2\sigma\sqrt2 \text{等}.
   \]
4. 若 `shape='driven_equation'`, 则调用类似  
   \[
     \psi(0)=0,\quad
     \frac{d}{dt}\psi(t)=-\frac{\kappa}{2}\psi(t)+\Omega(t),
   \]
   数值解得\(\psi(t)\)，其中 \(\tau\) 可能在 \(\Omega(t)\) 的脉冲长度中起作用。

**返回**：`np.ndarray` 的 wave(t_array)，其中 \(\sum_j |\psi(t_j)|^2\Delta t_j =1\) 保证归一化。

-----

### 3.2 `compute_photon_overlap(waveA: np.ndarray, waveB: np.ndarray, t_array: np.ndarray) -> float`
**目的**：计算两条离散波包 \(\psi_A(t)\) 和 \(\psi_B(t)\) 的重叠度 \(\gamma\)。  
**公式**:
\[
  \gamma \;=\; \int \psi_A^*(t)\,\psi_B(t)\,dt \;\;\approx\;\sum_{j=0}^{N-1} \psi_A^*(t_j)\,\psi_B(t_j)\,\Delta t.
\]
其中 \(\Delta t = t_{j+1}-t_j\)。  
**返回**: 实数 \(\gamma\) (或复数，若包含相对相位)。

----

### 3.3 `get_cavity_operators(cavity_dim: int) -> (np.ndarray, np.ndarray)`
**目的**：返回截断到\(\{ |0\rangle, |1\rangle\}\)子空间的 \(a\) 和 \(a^\dagger\) 矩阵。  
**公式**: 在\(\{|0\rangle,|1\rangle\}\)基下：  
\[
  a = \begin{pmatrix} 0 & 1 \\ 0 & 0 \end{pmatrix},\quad a^\dagger=\begin{pmatrix}0 & 0\\ 1 & 0\end{pmatrix}.
\]
若要扩展更高光子数也可更大维度。

---

## `lindblad_solver.py`

### 4.1 `solve_master_equation(rho0: np.ndarray, H_of_t: Callable, L_list: List[np.ndarray], t_span: tuple, dt: float) -> np.ndarray`
**目的**：用**密度矩阵形式**的Lindblad方程  
\[
  \frac{d\rho}{dt} = -i[H(t),\rho] \;+\; \sum_i \Bigl( L_i\rho L_i^\dagger - \tfrac12 \{L_i^\dagger L_i,\rho\}\Bigr)
\]
做数值积分(如RK4、Expokit等)。  
**流程**：  
1. 在每个子步 \(\Delta t\) 上计算 
   \[
     \rho(t+\Delta t) \approx \rho(t) + \Delta t\, f(\rho(t),H(t),L_i).
   \]
2. \(f(\rho)\) 表示 Lindblad RHS。  
**返回**: \(\rho(T)\) 终态 或时间序列。

----

### 4.2 `run_mcwf(rho0: np.ndarray, H: Callable, L_list: List[np.ndarray], t_span: tuple, dt: float, n_traj: int, on_measurement_event: Callable=None) -> np.ndarray`
**目的**：用**MCWF**(量子轨迹)方法，从\rho0(若是纯态也可以)得到演化终态(或轨迹均值)。  
**方程**(对纯态 \(|\psi\rangle\)):
1. 有效哈密顿
   \[
     H_{\mathrm{eff}} \;=\; H \;-\;\frac{i}{2}\sum_i L_i^\dagger L_i.
   \]
2. 无跳演化：
   \[
     |\psi(t+\Delta t)\rangle \approx e^{-iH_{\mathrm{eff}}\Delta t}|\psi(t)\rangle.
   \]
3. 跳跃概率：
   \[
     p_i(t) = \Delta t \;\langle\psi(t)| L_i^\dagger L_i |\psi(t)\rangle.
   \]
4. 若发生第 i 条跃迁:
   \[
     |\psi\rangle \;\;\leftarrow\;\; \frac{L_i|\psi\rangle}{\|L_i|\psi\rangle\|}.
   \]
   **on_measurement_event**: 若本次跳跃意义上是一次光子探测(或别的测量)，则回调 `on_measurement_event(jump_info, |\psi\rangle,t)`.

----

### 4.3 `apply_quantum_jump(psi: np.ndarray, L: np.ndarray) -> np.ndarray`
**目的**：将指定\(|\psi\rangle\)向量经算符\(L\) 归一化后得到新的态。  
**公式**:
\[
  |\psi'\rangle = \frac{ L\,|\psi\rangle}{\sqrt{\langle\psi|L^\dagger L|\psi\rangle}}.
\]
可用于MCWF内部。

---

## `time_evolution.py`

### 5.1 `run_epr_generation_process(...) -> np.ndarray`
**目的**：让节点 B、C + 各自腔 (B×腔1 & C×腔2) 产生EPR纠缠。(或者“TMS”之类，也可DLCZ式)  
**流程**:

1. 初始化 \(\rho\in \mathbb{C}^{15\times15}\otimes\mathbb{C}^{15\times15} = \mathbb{C}^{225\times225}\)  
2. 调用 `lindblad_solver.run_mcwf(...)` 在短时间内演化, 可能在**on_measurement_event** 里进行单击判断  
3. 当检测到一次单光子干涉成功(仅一次点击)时, 计算\(\gamma\), 并投影到 B×C(25维).  
4. 返回得到的 \(\rho_{BC}\in\mathbb{C}^{25\times25}\)  (EPR对).

### 5.2 `handle_photon_detection(jump_info, psi, t) -> None`
**目的**：当发生一次“光子探测”跳跃时, 进行**半经典**\(\gamma\)计算 + 投影。  
**公式**：
1. 令 waveA, waveB 为**cavity.py**生成/缓存的波包  
2. \(\gamma = \int \psi_A^*(t')\psi_B(t') dt'\)  
3. 结合测量结果(单击/双击)决定**后选**：投影 \(\rho\)或\(|\psi\rangle\)到“B×C纠缠态”子空间  
4. \(\rho_{\mathrm{final}} = \frac{P_{BC}\,\rho\,P_{BC}}{\mathrm{Tr}(P_{BC}\,\rho)}\) 其中 \(P_{BC}\) 表示相应的投影算符(可能要先对腔做 partial trace等).

### 5.3 `run_teleportation_protocol(rhoA: np.ndarray, rhoBC: np.ndarray, ...) -> np.ndarray`
**目的**：对**A**和**(B,C)**的系统进行隐形传态操作(CNOT,Hadamard,测量,经典通信,X^mZ^n校正C等)。  
**公式**(标准隐形传态):

1. 令 \(\rho_{\text{ABC}} = \rhoA\otimes \rhoBC\). 维度= 5×25=125  
2. CNOT(A->B):  
   \[
     \rho_{\mathrm{ABC}} \leftarrow U_{\mathrm{CNOT}}\,\rho_{\mathrm{ABC}}\,U_{\mathrm{CNOT}}^\dagger
   \]
3. Hadamard(A): 
   \[
     \rho_{\mathrm{ABC}} \leftarrow (H_A\otimes I_{B}\otimes I_{C})\,\rho_{\mathrm{ABC}}\,(H_A^\dagger\otimes I_B\otimes I_C)
   \]
4. 测量(A,B):  
   - 记 \(\Pi_{m_1,m_2}\) 为测量投影, \(m_1,m_2\in\{0,1\}\).  
   - 概率 \(p_{m_1,m_2} = \mathrm{Tr}(\Pi_{m_1,m_2}\,\rho_{\mathrm{ABC}})\).  
   - 测量后子状态 \(\rho_{C}^{(m_1,m_2)} = \frac{\mathrm{Tr}_{A,B}[\Pi_{m_1,m_2}\,\rho_{\mathrm{ABC}}]}{p_{m_1,m_2}}\).  
5. 经典通信 + 校正: 
   \[
     \rho_C^{(m_1,m_2)} \;\leftarrow\; X^{m_2} Z^{m_1}\,\rho_C^{(m_1,m_2)}\, Z^{m_1}X^{m_2}.
   \]
6. 返回 \(\rho_C\).

---

## `noise_models.py`

### 6.1 `build_cavity_loss_operator(kappa: float, a: np.ndarray) -> np.ndarray`
**目的**：返回\(\sqrt{\kappa}\,a\)，用于腔的光子耗散 Lindblad项。  
**公式**：
\[
  L_{\mathrm{cav\_loss}} = \sqrt{\kappa}\;a.
\]
其中\(a\)来自**cavity.py**`get_cavity_operators()`。

----

### 6.2 `build_spontaneous_decay_operator(Gamma: float, \ket{g}\bra{e}: np.ndarray) -> np.ndarray`
**目的**：返回\(\sqrt{\Gamma}|g\rangle\langle e|\)，表示原子从激发态\(|e\rangle\)到基态\(|g\rangle\)的自发辐射过程。  
**公式**：
\[
  L_{\mathrm{sp}} = \sqrt{\Gamma}\,|g\rangle\langle e|.
\]
(实际中也可多通道衰减)

----

### 6.3 `generate_random_detuning(t_array: np.ndarray, noise_level: float) -> np.ndarray`
**目的**：生成\(\Delta(t)\)在每个\(t\_i\)上的值，用于时变失谐(如腔频率飘移)。  
**公式**(示例):
\[
  \Delta(t) = \Delta_0 + \xi(t),
\]
其中\(\xi(t)\)可为Gaussian过程, \(\langle \xi(t)\xi(t')\rangle = \sigma^2 \delta(t-t')\)等。  
**返回**: \(\{\Delta(t_i)\}_{i=0\ldots N-1}\)。

---

# 总结
通过上述**面向公式**的函数设计，每个文件都能**明确**地说明其要做什么：

- **`quantum_state.py`** 管理整体态与Hilbert结构
- **`system_state.py`** 保存过程中的\rho(t)等帧数据
- **`cavity.py`** 提供半经典波包、计算$\gamma$、以及腔算符
- **`lindblad_solver.py`** 实现Lindblad主方程、MCWF的**数学**要点(跳跃概率、幺正无跳演化等)
- **`time_evolution.py`** 编排高层流程(如EPR制备、测量投影、隐形传态操作)
- **`noise_models.py`** 则是各种噪声/失谐的**Lindblad算符**或**随机分布**构造

在**铷原子** + **腔** + **隐形传态**的上下文中，可看到大多数物理过程都能用这些**公式**描述并逐步实现。这样既能保证灵活性，又能将**半经典波包**($\gamma$计算)和**投影**过程嵌进**Lindblad / MCWF**的求解流程之中。

## 一、两个主要进程

1. **进程A：仿真进程**  
   入口在 `utils/run_simulation.py`。主要负责调用 `protocols` 文件夹中的各种高层协议（如 `two_cavity_epr.py`, `quantum_teleport.py` 等），并依赖 `core` 中更底层的 Lindblad 求解（`lindblad_solver.py`）、时间演化管理（`time_evolution.py`）、以及量子态存取（`quantum_state.py`, `system_state.py`）来进行**核心数值模拟**。  
   - 在此过程中产生的各帧仿真结果，会被**按一定格式写入** `results/` 文件夹下，可能是多文件增量保存，以便**另一进程**读取。  

2. **进程B：UI + 可视化 + 性能分析进程**  
   入口在 `utils/ui.py`。它启动一个图形界面或命令行UI，进而：  
   - 通过 `utils/visualization.py`、`utils/metrics.py` 从 `results/` 目录读取已有的仿真数据文件（比如仿真完的帧、最终态、纠缠度等）进行**实时或离线的**可视化、统计分析。  
   - 也可以通过少量共享变量或网络通信，与仿真进程做简单交互（如让仿真进程启动/停止/调整某些参数），但主要依赖**结果文件**来做可视化或性能度量。  

> 二者并**不会**直接深度耦合：仿真进程全速计算并把结果写到 `results/`；UI进程定时或手动刷新读取，进行更丰富的数据图表和指标展示。

---

## 二、仿真进程（主入口：`run_simulation.py`）

此进程**最核心**的工作：  
1. **初始化** （通过 `protocols/initialization.py` + `core/quantum_state.py`）  
2. **EPR制备** （通过 `protocols/two_cavity_epr.py`）  
3. **纠缠度量** （`core/entanglement.py` 或由 `protocols` 里辅助调用）  
4. **后续操作**（`protocols/quantum_teleport.py`, `protocols/write_read.py`, `protocols/storage.py` 等）  
5. **在演化过程中**使用 `time_evolution.py` + `lindblad_solver.py` 来执行实际的**Lindblad**数值模拟，每帧输出写入 `results/`.  

### 2.1 初始化阶段
- **入口**: `run_simulation.py` 中，比如 `main()` 函数  
- **调用**: `protocols/initialization.py`  
  - 里面使用 `core/quantum_state.py` 的函数，创建**A, B, C**三原子的状态空间以及**腔1、腔2**(各保留0,1,2光子态)。  
  - 结果是一个符合“B直积腔1”和“C直积腔2”格式的**大维度密度矩阵**/或态矢量，初始在基态上。  
  - 还会配置一些全局参数(如原子能级、腔衰减、噪声类型)存进 `quantum_state.register_parameter(...)`。

### 2.2 EPR 制备阶段
- **调用**: `protocols/two_cavity_epr.py`  
  - 具体过程：  
    1. 定义**DLCZ**或类似“双腔”产生单光子干涉的协议逻辑。  
    2. 多次尝试： 由 `time_evolution.py` 读取**时间演化指示**（如演化多长时间、什么哈密顿量），并调用 `lindblad_solver.py` 迭代/MCWF 以模拟“光子产生、探测器点击”过程。  
    3. 在单光子探测到时：  
       - 通过 `physics/photon_process.py`、`physics/atomic_process.py` 等，进行“单光子事件确证”、计算波包重叠 \(\gamma\) 并**投影**到EPR对的子空间。  
    4. 在**成功**herald后，写出**制备好的** B×C 纠缠态(并将腔的多余维度清空或做 partial trace)。  
  - 过程中可能用 `core/entanglement.py` 里的函数来评估纠缠度(\(C, F\)等)。  
  - 每一帧演化后的\(\rho\)或MCWF轨迹都经 `system_state.py` & `time_evolution.py` 写到 `results/` 文件夹，供后续可视化使用。

### 2.3 存储与写读
- 当 EPR 制备完成后，**协议层**可能调用 `protocols/storage.py` + `protocols/write_read.py`：  
  - 通过**施加脉冲**(可能由 `physics/laser_field.py`)来把 B、C 原子态转移到**超精细态**做长时存储(比如 `|g1>, |g2>` 里)。  
  - 这些操作仍然离不开**time_evolution**(对Lindblad+哈密顿)进行有限时演化。  

### 2.4 随后量子隐形传态
- **入口**: `protocols/quantum_teleport.py`  
  - 里面描述“原子 A 上存有已知态 → 与 B 做CNOT/H门测量 → 发送经典信息 → 在C上执行X^mZ^n”。  
  - 同样: 用 `time_evolution.py` 做门操作(通过**哈密顿**或**一阶幺正近似**)，再**测量**(由 `lindblad_solver.py` + MCWF投影 或者**projective measurement**方式)。  
- 传态完成后，可能**记录**C的最终态在 `system_state.py` 并**写入**`results/`.

### 2.5 收尾
- 模拟结束后，`run_simulation.py` 会**关闭**或**等待**(看需求)，结果大量地保存在 `results/` 目录下的文件中。  
- 其中包括**演化过程**(多帧)与**最终态**(C成功接收态)等信息。

---

## 三、UI + 可视化进程（主入口：`ui.py`）

该进程主要关注**用户交互**与**数据展示**:

1. **初始化**：`ui.py` 内部创建主界面(可能用 PyQt / Tkinter / Web-based??)  
2. **读取**: 由 `results/` 文件夹获取某些文件(最新或指定序列)。  
3. **调用**:
   - `utils/visualization.py`: 绘制各种曲线(如纠缠随时间, 不同噪声强度下的保真度比较等).  
   - `utils/metrics.py`: 计算性能指标(成功率, 保真度平均值, EPR纠缠度等).  
4. **展示**: UI中图形化呈现, 或导出 PDF / SVG.  
5. **可选**: UI 也能发送启动/停止指令给仿真进程(通过命令行调用`shell`或socket)来动态调节. 大多数情况下只需**轮询**文件即可.

> **注**: 该进程基本不直接访问“core/”与“protocols/”功能，只需要**结果数据**(i.e. `*.json`, `*.h5` or `*.npy`) 并把它转化为图表或表格给用户看。

---

## 四、文件级别概览（更新版）

### 4.1 `core/quantum_state.py`
- 负责**全局/局部量子态**(密度矩阵or纯态) + Hilbert空间管理 + 关键参数登记(\(\tau, p(t), \gamma\), etc.)

### 4.2 `core/system_state.py`
- 负责**帧**概念：每次演化后存储**(\rho, t, extras)** 进**内存**  
- 可dump到 `results/`，被 UI 读取

### 4.3 `core/cavity.py`
- 有关**光子场**(0,1,2态) + “半经典波包”建模(对**\(\tau\)**做调节)  
- 计算光子波包重叠(\(\gamma\))等

### 4.4 `core/lindblad_solver.py`
- Lindblad方程 + MCWF 算法  
- 提供**step** 或 **run** 级别调用

### 4.5 `core/time_evolution.py`
- 时间演化控制器, 由“协议层”指示  
- 结合**noise_models.py** + “哈密顿量” + “lindblad_solver”做**真实演化**  
- 每步/每帧调用**system_state**的记录接口

### 4.6 `core/noise_models.py`
- 各类噪声(Lindblad项) + 随机失谐  
- “做or不做” 由协议层/上层参数确定

### 4.7 `core/entanglement.py`
- EPR对纠缠度(\(C\))、保真度\(F\)等分析函数

---

### 4.8 `physics/atomic_process.py`, `physics/laser_field.py`, `physics/photon_process.py`
- 更细粒度的**物理过程**建模(原子内部跃迁、激光与原子耦合、光子探测器响应...)  
- 被 “protocols” 和 “time_evolution” 层**调用**，提供具体算符/速率/波包

### 4.9 `protocols/*`
- **高层协议**:
  - **`two_cavity_epr.py`**: EPR制备过程  
  - **`quantum_teleport.py`**: 隐形传态过程  
  - **`initialization.py`**: 系统初始化(含“B直积腔1, C直积腔2”结构的\rho)  
  - **`write_read.py`**, **`storage.py`**: 把原子态写入/读出到超精细态，长时存储  
- 这些模块均通过**`time_evolution.py`**驱动数值演化，对**`core/quantum_state.py`**读/写全局态；并用**`system_state.py`**存储帧。

---

### 4.10 `utils/run_simulation.py`
- 仿真流程主控：  
  1. 调用**`protocols/initialization.py`** → 初始化  
  2. 调用**`protocols/two_cavity_epr.py`** → 生成EPR  
  3. [可选] `protocols/storage.py` → B,C原子态存储  
  4. [可选] `protocols/quantum_teleport.py` → 将A态隐形传输到C  
  5. 结束时把结果写到 `results/`, 退出或等待

### 4.11 `utils/ui.py`
- 图形/命令行UI入口  
- 通过**`utils/visualization.py`**(画图) 与 **`utils/metrics.py`**(性能指标计算)  
- 读取 `results/`中文件，呈现给用户

### 4.12 `utils/visualization.py`
- 把已有数据(如一系列纠缠度对时间的曲线)画成MatPlotLib/PyQtGraph或其它图表

### 4.13 `utils/metrics.py`
- 把 `results/` 中结果读出后**计算**成功率、保真度均值、速度指标等

---

## 五、总结

1. **仿真进程**(入口 `utils/run_simulation.py`) 主要通过**`protocols`** -> **`time_evolution`** / **`lindblad_solver`** + **`core/*`** 来**数值模拟**量子态演化，写结果到 `results/`.  
2. **UI进程**(入口 `utils/ui.py`) 用**`visualization.py`** / **`metrics.py`** 读取 `results/` 做**可视化**与**指标统计**。  
3. `physics/` 文件夹中包含**更贴近物理原理**(原子跃迁、光子探测等)的小过程模块。  
4. 整个工程**通过**这种分工，保证了**协议层**(EPR/Teleport)逻辑与**核心数值演化**(Lindblad)的解耦，也使**UI**和**仿真**彼此独立、各司其职。





